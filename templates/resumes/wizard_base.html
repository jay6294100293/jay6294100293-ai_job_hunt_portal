{# templates/resumes/wizard_base.html #}
{% extends 'base_authenticated.html' %}
{% load static resume_extras %} {# Ensure 'resume_extras' is loaded #}

{% block title %}{{ resume.title|default:"Create Resume" }} - Step: {{ current_step_display|default:"Current Step" }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/globals.css' %}"> {# Ensure this file exists if used #}
<script src="{% static 'js/resume_wizard.js' %}" defer></script> {# Ensure this file exists if used #}
<style>
    /* Styles for step indicators (same as previously provided) */
    .step-item {
        @apply flex items-center text-slate-500 dark:text-slate-400 relative;
    }
    .step-item .step-connector {
        @apply flex-auto border-t-2 transition duration-500 ease-in-out;
    }
    .step-item .step-circle {
        @apply relative flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full text-xs sm:text-sm font-semibold transition duration-500 ease-in-out;
    }
    .step-item .step-text {
        @apply absolute top-0 -ml-10 text-center mt-12 w-32 text-xs font-medium uppercase hidden md:block;
    }

    /* Completed Step */
    .step-item.completed .step-connector { /* Connector before the circle */
        @apply border-green-500 dark:border-green-400;
    }
    .step-item.completed .step-circle {
        @apply bg-green-500 text-white dark:bg-green-400 dark:text-slate-900 border-green-500 dark:border-green-400;
    }
    .step-item.completed .step-text {
        @apply text-green-600 dark:text-green-300;
    }
    /* Connector after a completed step's circle should also be green if the next step is also completed or active */
    .step-item.completed + .step-item-connector-wrapper .step-connector {
        @apply border-green-500 dark:border-green-400;
    }


    /* Active Step */
    .step-item.active .step-connector { /* Connector before the active circle */
         @apply border-primary-500 dark:border-primary-400; /* Can be gray if previous is not completed */
    }
    .step-item.active .step-circle {
        @apply bg-primary-500 text-white ring-2 ring-offset-2 ring-primary-300 dark:bg-primary-400 dark:text-slate-900 dark:ring-primary-500 dark:ring-offset-slate-800 border-primary-500 dark:border-primary-400;
    }
    .step-item.active .step-text {
        @apply text-primary-600 dark:text-primary-300 font-semibold;
    }
    /* Connector after an active step's circle should be gray (default) */
    .step-item.active + .step-item-connector-wrapper .step-connector {
        @apply border-slate-300 dark:border-slate-600;
    }
    /* If previous step was completed, the connector leading to active should be green */
    .step-item.completed + .step-item-connector-wrapper.points-to-active .step-connector {
        @apply border-green-500 dark:border-green-400;
    }


    /* Default/Upcoming Step */
    .step-item.default .step-connector { /* Connector before a default circle */
        @apply border-slate-300 dark:border-slate-600;
    }
    .step-item.default .step-circle {
        @apply bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 border-slate-300 dark:border-slate-600;
    }
    .step-item.default .step-text {
        @apply text-slate-500 dark:text-slate-400;
    }
    /* Connector after a default step's circle should also be gray */
     .step-item.default + .step-item-connector-wrapper .step-connector {
        @apply border-slate-300 dark:border-slate-600;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <div class="bg-white dark:bg-slate-800 shadow-xl rounded-lg">
        <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700">
            <h1 class="text-xl font-semibold text-slate-800 dark:text-slate-100">
                Editing Resume: <span class="text-primary-600 dark:text-primary-400">{{ resume.title }}</span>
            </h1>
            <p class="text-sm text-slate-500 dark:text-slate-400">
                Currently on step: <span class="font-medium">{{ current_step_display }}</span>
            </p>
        </div>

        <div class="px-4 sm:px-6 py-6">
            <div class="flex items-center">
                {% for step_key, step_config in wizard_steps.items %}
                    {% step_status resume step_key current_step wizard_steps as step_class %}
                    <div class="step-item flex-1 {{ step_class }}">
                        {# Connector leading to the circle (only if not the first item) #}
                        {% if not forloop.first %}
                        <div class="step-connector"></div>
                        {% else %}
                        <div class="step-connector border-transparent"></div> {# Invisible connector for layout consistency #}
                        {% endif %}

                        <a href="{% if resume.id %}{% url 'job_portal:resume_wizard' resume_id=resume.id step=step_key %}{% else %}javascript:void(0);{% endif %}"
                           class="step-circle group"
                           title="{{ step_config.name }}">
                            <i class="fas {{ step_config.icon }} group-hover:scale-110 transition-transform"></i>
                            <span class="step-text">{{ step_config.name }}</span>
                        </a>
                    </div>
                    {# Trailing connector after the circle (only if not the last item) #}
                    {% if not forloop.last %}
                    <div class="step-item-connector-wrapper flex-1 {% if wizard_steps|get_item:forloop.counter0|get_item:'key' == current_step %}points-to-active{% endif %}">
                         <div class="step-connector
                            {% if step_class == 'completed' and wizard_steps|get_item:forloop.counter|get_item:'status' != 'default' %} border-green-500 dark:border-green-400
                            {% elif step_class == 'active' %} border-slate-300 dark:border-slate-600
                            {% else %} border-slate-300 dark:border-slate-600
                            {% endif %}"></div>
                    </div>
                    {% else %}
                     <div class="step-item-connector-wrapper flex-1"><div class="step-connector border-transparent"></div></div> {# Invisible for layout #}
                    {% endif %}
                {% endfor %}
            </div>
        </div>


        <div class="p-6">
            {% block wizard_content %}
                {# Specific step content will go here, extending this base #}
            {% endblock wizard_content %}
        </div>

        </div>

    <div class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-4">
        <a href="{% url 'job_portal:resume_list' %}" class="text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 hover:underline">
            <i class="fas fa-list-ul mr-1.5"></i> Back to All Resumes
        </a>
        {% if resume.id %}
        <div class="flex items-center space-x-3">
            <a href="{% url 'job_portal:preview_current_resume' resume_id=resume.id %}" target="_blank" class="btn-neutral text-sm">
                <i class="fas fa-eye mr-1.5"></i> Preview Resume
            </a>
            <a href="{% url 'job_portal:select_template' resume_id=resume.id %}" class="btn-neutral text-sm">
                 <i class="fas fa-palette mr-1.5"></i> Change Template
            </a>
             <a href="{% url 'job_portal:finalize_resume' resume_id=resume.id %}" class="btn-success text-sm">
                <i class="fas fa-check-circle mr-1.5"></i> View & Finalize
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
{# Include formset management script if needed, e.g., for experience, education steps #}
{# <script src="{% static 'js/formset_management.js' %}" defer></script> #}
{% endblock %}

{#{% extends 'base_authenticated.html' %}#}
{#{% load resume_extras %}#}
{#{% load static %}#}
{#{% load widget_tweaks %}#}
{##}
{#{% block title %}Resume Builder - Step {{ step }} of {{ total_steps }}{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mx-auto px-4 py-8 sm:py-10">#}
{#    <div class="mb-8 sm:mb-10">#}
{#        <div class="flex justify-between items-center mb-4">#}
{#            <h1 class="text-xl sm:text-2xl font-bold text-gray-800">Create Your Professional Resume</h1>#}
{#            <span class="text-sm font-medium text-gray-600">Step {{ step }} of {{ total_steps }}</span>#}
{#        </div>#}
{##}
{#        <!-- Progress bar -->#}
{#        <div class="w-full bg-gray-200 rounded-full h-2 mb-6">#}
{#            <div class="bg-indigo-600 h-2 rounded-full transition-all duration-500 ease-out"#}
{#                 style="width: {{ step|floatformat:0|mul:100|div:total_steps }}%"></div>#}
{#        </div>#}
{##}
{#        <!-- Step indicators - Improved alignment and spacing -->#}
{#        <div class="flex justify-between mb-8">#}
{#            {% for i in total_steps|get_range %}#}
{#                <div class="flex flex-col items-center w-full max-w-[60px]">#}
{#                    {% if i < step %}#}
{#                        <!-- Completed steps -->#}
{#                        <a href="{% url 'job_portal:resume_wizard' step=i %}"#}
{#                           class="group relative"#}
{#                           title="Go back to Step {{ i }}">#}
{#                            <div class="w-8 h-8 mx-auto rounded-full bg-gray-500 flex items-center justify-center mb-1#}
{#                                        group-hover:bg-indigo-600 transition-colors duration-200">#}
{#                                <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                            </div>#}
{#                            <span class="text-gray-500 group-hover:text-indigo-600 transition-colors duration-200#}
{#                                         text-center w-full block text-xs whitespace-nowrap overflow-hidden text-ellipsis">#}
{#                                {% if i == 1 %}Personal#}
{#                                {% elif i == 2 %}Summary#}
{#                                {% elif i == 3 %}Skills#}
{#                                {% elif i == 4 %}Experience#}
{#                                {% elif i == 5 %}Education#}
{#                                {% elif i == 6 %}Projects#}
{#                                {% elif i == 7 %}Certifications#}
{#                                {% elif i == 8 %}Languages#}
{#                                {% elif i == 9 %}Additional#}
{#                                {% endif %}#}
{#                            </span>#}
{#                        </a>#}
{#                    {% elif i == step %}#}
{#                        <!-- Current step -->#}
{#                        <div class="w-8 h-8 mx-auto rounded-full bg-indigo-600 flex items-center justify-center mb-1#}
{#                                    ring-2 ring-offset-2 ring-indigo-500">#}
{#                            <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                        </div>#}
{#                        <span class="text-indigo-700 font-semibold text-center w-full block text-xs#}
{#                                     whitespace-nowrap overflow-hidden text-ellipsis">#}
{#                            {% if i == 1 %}Personal#}
{#                            {% elif i == 2 %}Summary#}
{#                            {% elif i == 3 %}Skills#}
{#                            {% elif i == 4 %}Experience#}
{#                            {% elif i == 5 %}Education#}
{#                            {% elif i == 6 %}Projects#}
{#                            {% elif i == 7 %}Certifications#}
{#                            {% elif i == 8 %}Languages#}
{#                            {% elif i == 9 %}Additional#}
{#                            {% endif %}#}
{#                        </span>#}
{#                    {% else %}#}
{#                        <!-- Future steps -->#}
{#                        <div class="w-8 h-8 mx-auto rounded-full bg-gray-300 flex items-center justify-center mb-1">#}
{#                            <span class="text-gray-600 text-sm font-medium">{{ i }}</span>#}
{#                        </div>#}
{#                        <span class="text-gray-400 text-center w-full block text-xs#}
{#                                     whitespace-nowrap overflow-hidden text-ellipsis">#}
{#                            {% if i == 1 %}Personal#}
{#                            {% elif i == 2 %}Summary#}
{#                            {% elif i == 3 %}Skills#}
{#                            {% elif i == 4 %}Experience#}
{#                            {% elif i == 5 %}Education#}
{#                            {% elif i == 6 %}Projects#}
{#                            {% elif i == 7 %}Certifications#}
{#                            {% elif i == 8 %}Languages#}
{#                            {% elif i == 9 %}Additional#}
{#                            {% endif %}#}
{#                        </span>#}
{#                    {% endif %}#}
{#                </div>#}
{#            {% endfor %}#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Form card -->#}
{#    <div class="bg-white shadow-xl rounded-xl border border-gray-200 overflow-hidden">#}
{#        <form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}" hx-boost="false">#}
{#            {% csrf_token %}#}
{#            <div class="p-6 sm:p-8">#}
{#                <h2 class="text-xl md:text-2xl font-semibold text-gray-900 mb-6 pb-4 border-b border-gray-200 flex items-center">#}
{#                    <span class="mr-3 text-indigo-600 text-xl w-6 text-center flex-shrink-0">#}
{#                        {% block step_icon %}#}
{#                            {% if step == 1 %}<i class="fa-solid fa-user-circle"></i>#}
{#                            {% elif step == 2 %}<i class="fa-solid fa-file-lines"></i>#}
{#                            {% elif step == 3 %}<i class="fa-solid fa-lightbulb"></i>#}
{#                            {% elif step == 4 %}<i class="fa-solid fa-briefcase"></i>#}
{#                            {% elif step == 5 %}<i class="fa-solid fa-graduation-cap"></i>#}
{#                            {% elif step == 6 %}<i class="fa-solid fa-diagram-project"></i>#}
{#                            {% elif step == 7 %}<i class="fa-solid fa-certificate"></i>#}
{#                            {% elif step == 8 %}<i class="fa-solid fa-language"></i>#}
{#                            {% elif step == 9 %}<i class="fa-solid fa-puzzle-piece"></i>#}
{#                            {% else %}<i class="fa-solid fa-clipboard-list"></i>#}
{#                            {% endif %}#}
{#                        {% endblock step_icon %}#}
{#                    </span>#}
{#                    <span>{% block step_title %}{% endblock step_title %}</span>#}
{#                </h2>#}
{##}
{#                <div class="space-y-6">#}
{#                    {% block step_content %}{% endblock step_content %}#}
{#                </div>#}
{#            </div>#}
{##}
{#            <!-- Navigation buttons with consistent spacing -->#}
{#            <div class="px-6 sm:px-8 py-4 border-t border-gray-200 bg-gray-50">#}
{#                <div class="flex justify-between items-center">#}
{#                    {% if step > 1 %}#}
{#                    <a href="{% url 'job_portal:resume_wizard' step=step|add:'-1' %}"#}
{#                       class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"#}
{#                       id="prev-step-btn">#}
{#                        <i class="fa-solid fa-chevron-left mr-2 -ml-1 h-5 w-5" aria-hidden="true"></i> Previous Step#}
{#                    </a>#}
{#                    {% else %}#}
{#                    <div></div> <!-- Empty div for spacing -->#}
{#                    {% endif %}#}
{##}
{#                    {% if step < total_steps %}#}
{#                    <button type="submit" form="resume-form"#}
{#                            class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out"#}
{#                            id="next-step-btn">#}
{#                        Save & Continue <i class="fa-solid fa-chevron-right ml-2 -mr-1 h-5 w-5" aria-hidden="true"></i>#}
{#                    </button>#}
{#                    {% else %}#}
{#                    <button type="submit" form="resume-form"#}
{#                            class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition duration-150 ease-in-out"#}
{#                            id="complete-resume-btn">#}
{#                        <i class="fa-solid fa-check mr-2"></i> Complete Resume#}
{#                    </button>#}
{#                    {% endif %}#}
{#                </div>#}
{#            </div>#}
{#        </form>#}
{#    </div>#}
{##}
{#    <!-- Preview button -->#}
{#    <div class="mt-8 text-center">#}
{#        <button id="open-preview-modal" type="button"#}
{#                class="inline-flex items-center justify-center px-4 py-2 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">#}
{#            <i class="fa-solid fa-eye mr-2"></i> Preview Resume#}
{#        </button>#}
{#    </div>#}
{##}
{#    <!-- Resume Preview Modal -->#}
{#    <div id="resumePreviewModal" class="fixed inset-0 z-50 overflow-y-auto hidden items-center justify-center p-4"#}
{#         aria-labelledby="resume-modal-title" role="dialog" aria-modal="true">#}
{#        <div class="fixed inset-0 bg-gray-900/80 transition-opacity"#}
{#             aria-hidden="true" onclick="closeResumePreviewModal()"></div>#}
{##}
{#        <div class="relative bg-white rounded-xl shadow-xl overflow-hidden w-11/12 max-w-4xl mx-auto my-8 transform transition-all">#}
{#            <div class="bg-indigo-700 p-4 px-6 text-white flex justify-between items-center">#}
{#                <h3 class="font-semibold text-lg flex items-center" id="resume-modal-title">#}
{#                    <i class="fa-solid fa-file-invoice mr-3"></i>#}
{#                    <span>Resume Preview</span>#}
{#                </h3>#}
{#                <button class="inline-flex items-center justify-center h-8 w-8 rounded-full transition duration-150 ease-in-out bg-transparent text-indigo-100 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-indigo-700 focus:ring-white"#}
{#                        onclick="closeResumePreviewModal()">#}
{#                    <span class="sr-only">Close</span> <i class="fa-solid fa-times text-lg"></i>#}
{#                </button>#}
{#            </div>#}
{##}
{#            <div id="resume-preview" class="h-[75vh] overflow-y-auto p-0 bg-gray-100">#}
{#                <div class="flex flex-col justify-center items-center h-full text-gray-500 p-4 text-center">#}
{#                    <i class="fa-solid fa-spinner fa-spin text-4xl text-indigo-600 mb-4 animate-spin"></i>#}
{#                    <p>Loading preview...</p>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="border-t border-gray-200 p-4 px-6 flex justify-between items-center bg-gray-50">#}
{#                <button id="refresh-preview"#}
{#                        class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">#}
{#                    <i class="fa-solid fa-sync-alt mr-2"></i> Refresh Preview#}
{#                </button>#}
{#                <button class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"#}
{#                        onclick="closeResumePreviewModal()">#}
{#                    Close#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{#{% endblock content %}#}
{##}
{#{% block extra_js %}#}
{#<script>#}
{#    // Function to toggle end date based on "is current" checkbox#}
{#    function toggleEndDate(checkbox) {#}
{#        try {#}
{#            const fieldWrapper = checkbox.closest('.field-wrapper') || checkbox.closest('div[class*="space-y-"] > div') || checkbox.closest('.form-group');#}
{#            if (!fieldWrapper) return;#}
{##}
{#            const endDateField = fieldWrapper.querySelector('input[name$="end_date"], select[name$="end_date"]');#}
{#            const endDateLabel = fieldWrapper.querySelector('label[for$="end_date"]');#}
{##}
{#            if (endDateField) {#}
{#                const container = endDateField.closest('.relative') || endDateField.parentElement;#}
{#                if (checkbox.checked) {#}
{#                    endDateField.disabled = true;#}
{#                    endDateField.value = '';#}
{#                    container?.classList.add('opacity-50', 'pointer-events-none');#}
{#                    endDateLabel?.classList.add('opacity-50');#}
{#                    endDateField.required = false;#}
{#                } else {#}
{#                    endDateField.disabled = false;#}
{#                    container?.classList.remove('opacity-50', 'pointer-events-none');#}
{#                    endDateLabel?.classList.remove('opacity-50');#}
{#                }#}
{#            }#}
{#        } catch (e) { console.error("Error in toggleEndDate:", e); }#}
{#    }#}
{##}
{#    // Resume Preview Modal Functions#}
{#    const resumePreviewModal = document.getElementById('resumePreviewModal');#}
{#    const resumePreviewContainer = document.getElementById('resume-preview');#}
{#    const resumeFormForPreview = document.getElementById('resume-form');#}
{#    const currentStep = {{ step|default:0 }};#}
{##}
{#    function openResumePreviewModal() {#}
{#        if (!resumePreviewModal || !resumePreviewContainer) {#}
{#            console.error("Resume Preview Modal or container element not found!");#}
{#            return;#}
{#        }#}
{#        // Always open the modal#}
{#        resumePreviewModal.classList.remove('hidden');#}
{#        resumePreviewModal.classList.add('flex');#}
{#        document.body.style.overflow = 'hidden';#}
{##}
{#        // Check if it's the first step to show message OR fetch preview#}
{#        if (currentStep === 1) {#}
{#            // Show message on step 1#}
{#            resumePreviewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full p-8 text-center">#}
{#                    <i class="fa-solid fa-info-circle text-4xl text-blue-500 mb-4"></i>#}
{#                    <p class="text-gray-800 mb-2 font-semibold">Preview Available Soon</p>#}
{#                    <p class="text-sm text-gray-600 max-w-md">#}
{#                        The full resume preview requires information from later steps. Please complete this step and continue.#}
{#                        The preview will be available from Step 2 onwards.#}
{#                    </p>#}
{#                </div>`;#}
{#        } else {#}
{#            // Fetch the actual preview for steps > 1#}
{#            refreshResumePreview();#}
{#        }#}
{#    }#}
{##}
{#    function closeResumePreviewModal() {#}
{#        if (resumePreviewModal) {#}
{#            resumePreviewModal.classList.add('hidden');#}
{#            resumePreviewModal.classList.remove('flex');#}
{#            document.body.style.overflow = 'auto';#}
{#        }#}
{#    }#}
{##}
{#    function refreshResumePreview() {#}
{#        // Prevent refresh attempt on step 1 (keep message displayed)#}
{#        if (currentStep === 1) {#}
{#            console.log("Preview refresh skipped on step 1.");#}
{#            // Ensure the message is still there if modal was somehow cleared#}
{#            if(resumePreviewContainer && resumePreviewContainer.querySelector('.fa-info-circle') == null){#}
{#                 openResumePreviewModal(); // Re-call to reset content to the message#}
{#            }#}
{#            return;#}
{#        }#}
{##}
{#        if (!resumePreviewContainer || !resumeFormForPreview) {#}
{#            console.error("Preview container or form element not found for refresh.");#}
{#            return;#}
{#        }#}
{#        // Indicate loading#}
{#        resumePreviewContainer.innerHTML = `#}
{#            <div class="flex flex-col items-center justify-center h-full p-4 text-gray-600">#}
{#                <i class="fas fa-spinner fa-spin text-3xl text-indigo-600 mb-4 animate-spin"></i>#}
{#                <p>Generating preview...</p>#}
{#            </div>`;#}
{##}
{#        const formData = new FormData(resumeFormForPreview);#}
{##}
{#        // Add dynamic form data processing for formsets#}
{#        try {#}
{#            // Process skill fields#}
{#            const skillRows = document.querySelectorAll('#skills-container .form-row');#}
{#            if (skillRows.length > 0) {#}
{#                formData.append('skill_count', skillRows.length);#}
{#            }#}
{##}
{#            // Process experience fields#}
{#            const expRows = document.querySelectorAll('#experience-container .form-row');#}
{#            if (expRows.length > 0) {#}
{#                formData.append('experience_count', expRows.length);#}
{#                expRows.forEach((row, index) => {#}
{#                    // Process bullet points for each experience#}
{#                    const bulletRows = row.querySelectorAll('.bullet-point-row');#}
{#                    if (bulletRows.length > 0) {#}
{#                        formData.append(`bullet_count_${index}`, bulletRows.length);#}
{#                    }#}
{#                });#}
{#            }#}
{##}
{#            // Process education fields#}
{#            const eduRows = document.querySelectorAll('#education-container .form-row');#}
{#            if (eduRows.length > 0) {#}
{#                formData.append('education_count', eduRows.length);#}
{#            }#}
{##}
{#            // Process project fields#}
{#            const projRows = document.querySelectorAll('#projects-container .form-row');#}
{#            if (projRows.length > 0) {#}
{#                formData.append('projects_count', projRows.length);#}
{#                projRows.forEach((row, index) => {#}
{#                    // Process bullet points for each project#}
{#                    const bulletRows = row.querySelectorAll('.bullet-point-row');#}
{#                    if (bulletRows.length > 0) {#}
{#                        formData.append(`project_${index}_bullet_count`, bulletRows.length);#}
{#                    }#}
{#                });#}
{#            }#}
{#        } catch (e) {#}
{#            console.error("Error preparing form data:", e);#}
{#        }#}
{##}
{#        fetch("{% url 'job_portal:preview_current_resume' %}", {#}
{#            method: 'POST',#}
{#            body: formData,#}
{#            headers: {#}
{#                'X-Requested-With': 'XMLHttpRequest',#}
{#                'X-CSRFToken': formData.get('csrfmiddlewaretoken')#}
{#            }#}
{#        })#}
{#        .then(response => {#}
{#            if (!response.ok) {#}
{#                 return response.text().then(text => { throw new Error(`Preview Error (${response.status}): ${text.substring(0, 200)}`); });#}
{#            }#}
{#            return response.text();#}
{#        })#}
{#        .then(html => {#}
{#            // Inject response HTML with a light background wrapper#}
{#            resumePreviewContainer.innerHTML = `<div class="bg-white shadow-lg m-2 p-4">${html}</div>`;#}
{#        })#}
{#        .catch(error => {#}
{#            console.error("Resume Preview fetch/processing error:", error);#}
{#            resumePreviewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full p-8 text-center">#}
{#                    <i class="fa-solid fa-circle-exclamation text-4xl text-red-500 mb-4"></i>#}
{#                    <p class="text-red-600 mb-2 font-semibold">Failed to Load Preview</p>#}
{#                    <p class="text-sm text-gray-600 mb-4 max-w-md">${error.message || 'An unknown error occurred.'}</p>#}
{#                    <button class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" onclick="refreshResumePreview()">#}
{#                        <i class="fa-solid fa-sync-alt mr-2"></i> Try Again#}
{#                    </button>#}
{#                </div>`;#}
{#        });#}
{#    }#}
{##}
{#    // Initial setup on page load#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#        // Setup 'is_current' checkboxes#}
{#        document.querySelectorAll('input[type="checkbox"][name$="is_current"]').forEach(function(checkbox) {#}
{#            toggleEndDate(checkbox);#}
{#            checkbox.addEventListener('change', function() { toggleEndDate(this); });#}
{#        });#}
{##}
{#        // Setup preview button listeners#}
{#        const openModalBtn = document.getElementById('open-preview-modal');#}
{#        if (openModalBtn) openModalBtn.addEventListener('click', openResumePreviewModal);#}
{##}
{#        const refreshBtn = document.getElementById('refresh-preview');#}
{#        if (refreshBtn) refreshBtn.addEventListener('click', refreshResumePreview);#}
{##}
{#        // Ensure the Previous Step button causes a full page reload#}
{#        const prevStepBtn = document.getElementById('prev-step-btn');#}
{#        if (prevStepBtn) {#}
{#            prevStepBtn.addEventListener('click', function(e) {#}
{#                e.preventDefault();#}
{#                const href = this.getAttribute('href');#}
{#                window.location.href = href;#}
{#            });#}
{#        }#}
{##}
{#        // Ensure the resume form submission causes a full page reload#}
{#        const resumeForm = document.getElementById('resume-form');#}
{#        if (resumeForm) {#}
{#            // We need to ensure HTMX doesn't interfere with form submission#}
{#            resumeForm.setAttribute('hx-boost', 'false');#}
{##}
{#            // For the next/save button, let's add a direct handler#}
{#            const nextButton = document.getElementById('next-step-btn');#}
{#            if (nextButton) {#}
{#                nextButton.addEventListener('click', function(e) {#}
{#                    // Prevent the default button behavior#}
{#                    e.preventDefault();#}
{##}
{#                    // Disable any HTMX features#}
{#                    if (typeof htmx !== 'undefined') {#}
{#                        htmx.config.globalViewTransitions = false;#}
{#                        resumeForm.setAttribute('hx-boost', 'false');#}
{#                        resumeForm.setAttribute('data-no-ajax', 'true');#}
{#                    }#}
{##}
{#                    // Ensure form is submitted with page reload#}
{#                    resumeForm.setAttribute('onsubmit', '');#}
{##}
{#                    // Submit the form to cause a full page reload#}
{#                    resumeForm.submit();#}
{#                });#}
{#            }#}
{##}
{#            // Handle the complete resume button similarly#}
{#            const completeButton = document.getElementById('complete-resume-btn');#}
{#            if (completeButton) {#}
{#                completeButton.addEventListener('click', function(e) {#}
{#                    e.preventDefault();#}
{##}
{#                    if (typeof htmx !== 'undefined') {#}
{#                        htmx.config.globalViewTransitions = false;#}
{#                        resumeForm.setAttribute('hx-boost', 'false');#}
{#                        resumeForm.setAttribute('data-no-ajax', 'true');#}
{#                    }#}
{##}
{#                    resumeForm.setAttribute('onsubmit', '');#}
{#                    resumeForm.submit();#}
{#                });#}
{#            }#}
{#        }#}
{#    });#}
{#</script>#}
{##}
{#<style>#}
{#    /* Highlight animation for new elements */#}
{#    .highlight-new { animation: highlight-pulse 1.0s ease-out; }#}
{#    @keyframes highlight-pulse { 0%, 100% { background-color: transparent; } 50% { background-color: rgba(96, 165, 250, 0.15); } }#}
{##}
{#    /* Fade out animation for removed elements */#}
{#    .fade-out { opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0; margin-top: 0; margin-bottom: 0; border: none; overflow: hidden; transition: all 0.3s ease-out; }#}
{##}
{#    /* Optional: Style the wrapper for the injected preview HTML */#}
{#    .resume-preview-content { line-height: 1.6; }#}
{##}
{#    /* Responsive grid adjustments */#}
{#    @media screen and (max-width: 640px) {#}
{#        /* Smaller step indicators on mobile */#}
{#        .step-indicator { font-size: 0.7rem; }#}
{#    }#}
{##}
{#    /* Improve focus visibility for accessibility */#}
{#    button:focus, a:focus {#}
{#        outline: 2px solid rgba(99, 102, 241, 0.5);#}
{#        outline-offset: 2px;#}
{#    }#}
{#</style>#}
{#{% endblock %}#}
{##}
{#{% extends 'base_authenticated.html' %}#}
{#{% load resume_extras %}#}
{#{% load static %}#}
{#{% load widget_tweaks %}#}
{##}
{#{% block title %}Resume Builder - Step {{ step }} of {{ total_steps }}{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mx-auto px-4 py-8 sm:py-10">#}
{#    <div class="mb-8 sm:mb-10">#}
{#        <div class="flex justify-between items-center mb-2">#}
{#            <h1 class="text-xl sm:text-2xl font-bold font-heading text-gray-800 dark:text-gray-100">Create Your Professional Resume</h1>#}
{#            <span class="text-sm font-medium text-gray-600 dark:text-gray-400">Step {{ step }} of {{ total_steps }}</span>#}
{#        </div>#}
{##}
{#        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-6">#}
{#            <div class="bg-indigo-600 h-2 rounded-full transition-all duration-500 ease-out" style="width: {{ step|floatformat:0|mul:100|div:total_steps }}%"></div>#}
{#        </div>#}
{#       <div class="grid grid-cols-3 gap-x-2 gap-y-3 text-xs text-center sm:grid-cols-5 md:grid-cols-9 lg:grid-cols-{{ total_steps }}">#}
{#    {% for i in total_steps|get_range %}#}
{#        <div class="flex flex-col items-center">#}
{#            {% if i < step %}#}
{#                <a href="{% url 'job_portal:resume_wizard' step=i %}" class="group text-center relative w-full" title="Go back to Step {{ i }}">#}
{#                    <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-500 dark:bg-gray-600 flex items-center justify-center mb-1 group-hover:bg-indigo-600 transition-colors duration-200">#}
{#                        <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                    </div>#}
{#                    <span class="pt-1 text-gray-500 dark:text-gray-400 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors duration-200 text-center w-full block text-[10px] sm:text-xs leading-tight px-1 min-h-[2.5rem]">#}
{#                        {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                    </span>#}
{#                </a>#}
{#            {% elif i == step %}#}
{#                <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-indigo-600 flex items-center justify-center mb-1 ring-2 ring-offset-2 ring-indigo-500 dark:ring-offset-gray-900">#}
{#                    <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                </div>#}
{#                <span class="pt-1 text-indigo-700 dark:text-indigo-300 font-semibold text-center w-full block text-[10px] sm:text-xs leading-tight px-1 min-h-[2.5rem]">#}
{#                    {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                </span>#}
{#            {% else %}#}
{#                <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-400 dark:bg-gray-700 flex items-center justify-center mb-1">#}
{#                    <span class="text-gray-700 dark:text-gray-400 text-sm font-medium">{{ i }}</span>#}
{#                </div>#}
{#                <span class="pt-1 text-gray-600 dark:text-gray-500 text-center w-full block text-[10px] sm:text-xs leading-tight px-1 min-h-[2.5rem]">#}
{#                    {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                </span>#}
{#            {% endif %}#}
{#        </div>#}
{#    {% endfor %}#}
{#</div>#}
{#    </div>#}
{#<div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">#}
{#        <form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}" hx-boost="false">#}
{#            {% csrf_token %}#}
{#            <div class="p-6 sm:p-8">#}
{#                <h2 class="text-xl md:text-2xl font-semibold font-heading text-gray-900 dark:text-gray-100 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700 flex items-center">#}
{#                    <span class="mr-3 text-indigo-600 dark:text-indigo-400 opacity-90 text-xl w-6 text-center flex-shrink-0">#}
{#                        {% block step_icon %}#}
{#                            {% if step == 1 %}<i class="fa-solid fa-user-circle"></i>#}
{#                            {% elif step == 2 %}<i class="fa-solid fa-file-lines"></i>#}
{#                            {% elif step == 3 %}<i class="fa-solid fa-lightbulb"></i>#}
{#                            {% elif step == 4 %}<i class="fa-solid fa-briefcase"></i>#}
{#                            {% elif step == 5 %}<i class="fa-solid fa-graduation-cap"></i>#}
{#                            {% elif step == 6 %}<i class="fa-solid fa-diagram-project"></i>#}
{#                            {% elif step == 7 %}<i class="fa-solid fa-certificate"></i>#}
{#                            {% elif step == 8 %}<i class="fa-solid fa-language"></i>#}
{#                            {% elif step == 9 %}<i class="fa-solid fa-puzzle-piece"></i>#}
{#                            {% else %}<i class="fa-solid fa-clipboard-list"></i>#}
{#                            {% endif %}#}
{#                        {% endblock step_icon %}#}
{#                    </span>#}
{#                    <span>{% block step_title %}{% endblock step_title %}</span>#}
{#                </h2>#}
{##}
{#                <div class="space-y-6">#}
{#                    {% block step_content %}{% endblock step_content %}#}
{#                </div>#}
{#            </div>#}
{#        <div class="px-6 sm:px-8 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">#}
{#                {% block wizard_navigation %}#}
{#                    {% with primary_button_classes="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out dark:focus:ring-offset-gray-900 disabled:opacity-50" success_button_classes="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition duration-150 ease-in-out dark:focus:ring-offset-gray-900" secondary_button_classes="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900" %}#}
{#                    <div class="flex justify-between items-center">#}
{#                        {% if step > 1 %}#}
{#                        <a href="{% url 'job_portal:resume_wizard' step=step|add:'-1' %}" class="{{ secondary_button_classes }}" id="prev-step-btn">#}
{#                            <i class="fa-solid fa-chevron-left mr-2 -ml-1 h-5 w-5" aria-hidden="true"></i> Previous Step#}
{#                        </a>#}
{#                        {% else %}#}
{#                        <div></div>#}
{#                        {% endif %}#}
{##}
{#                        {% if step < total_steps %}#}
{#                        <button type="submit" form="resume-form" class="{{ primary_button_classes }}" id="next-step-btn">#}
{#                            Save & Continue <i class="fa-solid fa-chevron-right ml-2 -mr-1 h-5 w-5" aria-hidden="true"></i>#}
{#                        </button>#}
{#                        {% else %}#}
{#                        <button type="submit" form="resume-form" class="{{ success_button_classes }}" id="complete-resume-btn">#}
{#                            <i class="fa-solid fa-check mr-2"></i> Complete Resume#}
{#                        </button>#}
{#                        {% endif %}#}
{#                    </div>#}
{#                    {% endwith %}#}
{#                {% endblock wizard_navigation %}#}
{#            </div>#}
{#        </form>#}
{#    </div>#}
{#<div class="mt-8 text-center">#}
{#        <button id="open-preview-modal" type="button" class="inline-flex items-center justify-center px-4 py-2 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900">#}
{#            <i class="fa-solid fa-eye mr-2"></i> Preview Resume#}
{#        </button>#}
{#    </div>#}
{##}
{#    <div id="resumePreviewModal" class="fixed inset-0 z-[60] overflow-y-auto hidden items-center justify-center p-4" aria-labelledby="resume-modal-title" role="dialog" aria-modal="true">#}
{#        <div class="fixed inset-0 bg-gray-900/80 transition-opacity" aria-hidden="true" onclick="closeResumePreviewModal()"></div>#}
{##}
{#        <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-xl overflow-hidden w-11/12 max-w-4xl mx-auto my-8 transform transition-all">#}
{#            <div class="bg-indigo-700 p-4 px-6 text-white flex justify-between items-center">#}
{#                <h3 class="font-semibold text-lg flex items-center font-heading" id="resume-modal-title">#}
{#                    <i class="fa-solid fa-file-invoice mr-3"></i>#}
{#                    <span>Resume Preview</span>#}
{#                </h3>#}
{#                <button class="inline-flex items-center justify-center h-8 w-8 rounded-full transition duration-150 ease-in-out bg-transparent text-indigo-100 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-indigo-700 focus:ring-white" onclick="closeResumePreviewModal()">#}
{#                    <span class="sr-only">Close</span> <i class="fa-solid fa-times text-lg"></i>#}
{#                </button>#}
{#            </div>#}
{##}
{#            <div id="resume-preview" class="h-[75vh] overflow-y-auto p-0 bg-gray-200 dark:bg-gray-700">#}
{#                <div class="flex flex-col justify-center items-center h-full text-gray-500 dark:text-gray-400 p-4 text-center">#}
{#                    <i class="fa-solid fa-spinner fa-spin text-4xl text-indigo-600 dark:text-indigo-400 mb-4 animate-spin"></i>#}
{#                    <p>Loading initial preview...</p>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="border-t border-gray-200 dark:border-gray-700 p-4 px-6 flex justify-between items-center bg-gray-50 dark:bg-gray-900">#}
{#                <button id="refresh-preview" class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-700 dark:focus:ring-offset-gray-900">#}
{#                    <i class="fa-solid fa-sync-alt mr-2"></i> Refresh Preview#}
{#                </button>#}
{#                <button class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900" onclick="closeResumePreviewModal()">#}
{#                    Close#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{#{% endblock content %}#}
{#{% block extra_js %}#}
{#<script>#}
{#    // Function to toggle end date#}
{#    function toggleEndDate(checkbox) {#}
{#        try {#}
{#            const fieldWrapper = checkbox.closest('.field-wrapper') || checkbox.closest('div[class*="space-y-"] > div') || checkbox.closest('.form-group');#}
{#            if (!fieldWrapper) return;#}
{##}
{#            const endDateField = fieldWrapper.querySelector('input[name$="end_date"], select[name$="end_date"]');#}
{#            const endDateLabel = fieldWrapper.querySelector('label[for$="end_date"]');#}
{##}
{#            if (endDateField) {#}
{#                const container = endDateField.closest('.relative') || endDateField.parentElement;#}
{#                if (checkbox.checked) {#}
{#                    endDateField.disabled = true;#}
{#                    endDateField.value = '';#}
{#                    container?.classList.add('opacity-50', 'pointer-events-none');#}
{#                    endDateLabel?.classList.add('opacity-50');#}
{#                    endDateField.required = false;#}
{#                } else {#}
{#                    endDateField.disabled = false;#}
{#                    container?.classList.remove('opacity-50', 'pointer-events-none');#}
{#                    endDateLabel?.classList.remove('opacity-50');#}
{#                }#}
{#            }#}
{#        } catch (e) { console.error("Error in toggleEndDate:", e); }#}
{#    }#}
{##}
{#    // Resume Preview Modal Functions#}
{#    const resumePreviewModal = document.getElementById('resumePreviewModal');#}
{#    const resumePreviewContainer = document.getElementById('resume-preview');#}
{#    const resumeFormForPreview = document.getElementById('resume-form');#}
{#    const currentStep = {{ step|default:0 }};#}
{##}
{#    function openResumePreviewModal() {#}
{#        if (!resumePreviewModal || !resumePreviewContainer) {#}
{#            console.error("Resume Preview Modal or container element not found!");#}
{#            return;#}
{#        }#}
{#        // Always open the modal#}
{#        resumePreviewModal.classList.remove('hidden');#}
{#        resumePreviewModal.classList.add('flex');#}
{#        document.body.style.overflow = 'hidden';#}
{##}
{#        // Check if it's the first step to show message OR fetch preview#}
{#        if (currentStep === 1) {#}
{#            // Show message on step 1#}
{#            resumePreviewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full p-8 text-center">#}
{#                    <i class="fa-solid fa-info-circle text-4xl text-sky-500 dark:text-sky-400 mb-4"></i>#}
{#                    <p class="text-gray-800 dark:text-gray-200 mb-2 font-semibold">Preview Available Soon</p>#}
{#                    <p class="text-sm text-gray-600 dark:text-gray-400 max-w-md">#}
{#                        The full resume preview requires information from later steps. Please complete this step and continue. The preview will be available from Step 2 onwards.#}
{#                    </p>#}
{#                </div>`;#}
{#        } else {#}
{#            // Fetch the actual preview for steps > 1#}
{#            refreshResumePreview();#}
{#        }#}
{#    }#}
{##}
{#    function closeResumePreviewModal() {#}
{#        if (resumePreviewModal) {#}
{#            resumePreviewModal.classList.add('hidden');#}
{#            resumePreviewModal.classList.remove('flex');#}
{#            document.body.style.overflow = 'auto';#}
{#        }#}
{#    }#}
{##}
{#    function refreshResumePreview() {#}
{#        // Prevent refresh attempt on step 1 (keep message displayed)#}
{#        if (currentStep === 1) {#}
{#            console.log("Preview refresh skipped on step 1.");#}
{#            // Ensure the message is still there if modal was somehow cleared#}
{#            if(resumePreviewContainer && resumePreviewContainer.querySelector('.fa-info-circle') == null){#}
{#                 openResumePreviewModal(); // Re-call to reset content to the message#}
{#            }#}
{#            return;#}
{#        }#}
{##}
{#        if (!resumePreviewContainer || !resumeFormForPreview) {#}
{#            console.error("Preview container or form element not found for refresh.");#}
{#            return;#}
{#        }#}
{#        // Indicate loading#}
{#        resumePreviewContainer.innerHTML = `#}
{#            <div class="flex flex-col items-center justify-center h-full p-4 text-gray-600 dark:text-gray-400">#}
{#                <i class="fas fa-spinner fa-spin text-3xl text-indigo-600 dark:text-indigo-400 mb-4 animate-spin"></i>#}
{#                <p>Generating preview...</p>#}
{#            </div>`;#}
{##}
{#        const formData = new FormData(resumeFormForPreview);#}
{##}
{#        // Add dynamic form data processing for dynamic formsets#}
{#        try {#}
{#            // Process skill fields#}
{#            const skillRows = document.querySelectorAll('#skills-container .form-row');#}
{#            if (skillRows.length > 0) {#}
{#                formData.append('skill_count', skillRows.length);#}
{#            }#}
{##}
{#            // Process experience fields#}
{#            const expRows = document.querySelectorAll('#experience-container .form-row');#}
{#            if (expRows.length > 0) {#}
{#                formData.append('experience_count', expRows.length);#}
{#                expRows.forEach((row, index) => {#}
{#                    // Process bullet points for each experience#}
{#                    const bulletRows = row.querySelectorAll('.bullet-point-row');#}
{#                    if (bulletRows.length > 0) {#}
{#                        formData.append(`bullet_count_${index}`, bulletRows.length);#}
{#                    }#}
{#                });#}
{#            }#}
{##}
{#            // Process education fields#}
{#            const eduRows = document.querySelectorAll('#education-container .form-row');#}
{#            if (eduRows.length > 0) {#}
{#                formData.append('education_count', eduRows.length);#}
{#            }#}
{##}
{#            // Process project fields#}
{#            const projRows = document.querySelectorAll('#projects-container .form-row');#}
{#            if (projRows.length > 0) {#}
{#                formData.append('projects_count', projRows.length);#}
{#                projRows.forEach((row, index) => {#}
{#                    // Process bullet points for each project#}
{#                    const bulletRows = row.querySelectorAll('.bullet-point-row');#}
{#                    if (bulletRows.length > 0) {#}
{#                        formData.append(`project_${index}_bullet_count`, bulletRows.length);#}
{#                    }#}
{#                });#}
{#            }#}
{##}
{#            // Process certification fields#}
{#            const certRows = document.querySelectorAll('#certifications-container .form-row');#}
{#            if (certRows.length > 0) {#}
{#                formData.append('certification_count', certRows.length);#}
{#            }#}
{##}
{#            // Process language fields#}
{#            const langRows = document.querySelectorAll('#languages-container .form-row');#}
{#            if (langRows.length > 0) {#}
{#                formData.append('language_count', langRows.length);#}
{#            }#}
{##}
{#            // Process custom section fields#}
{#            const customRows = document.querySelectorAll('#custom-sections-container .form-row');#}
{#            if (customRows.length > 0) {#}
{#                formData.append('section_count', customRows.length);#}
{#            }#}
{#        } catch (e) {#}
{#            console.error("Error preparing form data:", e);#}
{#        }#}
{##}
{#        fetch("{% url 'job_portal:preview_current_resume' %}", {#}
{#            method: 'POST',#}
{#            body: formData,#}
{#            headers: {#}
{#                'X-Requested-With': 'XMLHttpRequest',#}
{#                'X-CSRFToken': formData.get('csrfmiddlewaretoken')#}
{#            }#}
{#        })#}
{#        .then(response => {#}
{#            if (!response.ok) {#}
{#                 return response.text().then(text => { throw new Error(`Preview Error (${response.status}): ${text.substring(0, 200)}`); });#}
{#            }#}
{#            return response.text();#}
{#        })#}
{#        .then(html => {#}
{#            // Inject response HTML. Added a light background wrapper.#}
{#            resumePreviewContainer.innerHTML = `<div class="resume-preview-content bg-white dark:bg-gray-50 shadow-lg m-1 sm:m-2 p-2 sm:p-4">${html}</div>`;#}
{#        })#}
{#        .catch(error => {#}
{#            console.error("Resume Preview fetch/processing error:", error);#}
{#            resumePreviewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full p-8 text-center">#}
{#                    <i class="fa-solid fa-circle-exclamation text-4xl text-red-500 mb-4"></i>#}
{#                    <p class="text-red-600 dark:text-red-400 mb-2 font-semibold">Failed to Load Preview</p>#}
{#                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 max-w-md">${error.message || 'An unknown error occurred.'}</p>#}
{#                    <button class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-800" onclick="refreshResumePreview()">#}
{#                        <i class="fa-solid fa-sync-alt mr-2"></i> Try Again#}
{#                    </button>#}
{#                </div>`;#}
{#        });#}
{#    }#}
{#    // Initial setup on page load#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#        // Setup 'is_current' checkboxes#}
{#        document.querySelectorAll('input[type="checkbox"][name$="is_current"]').forEach(function(checkbox) {#}
{#            toggleEndDate(checkbox);#}
{#            checkbox.addEventListener('change', function() { toggleEndDate(this); });#}
{#        });#}
{##}
{#        // Setup preview button listeners#}
{#        const openModalBtn = document.getElementById('open-preview-modal');#}
{#        if (openModalBtn) openModalBtn.addEventListener('click', openResumePreviewModal);#}
{##}
{#        const refreshBtn = document.getElementById('refresh-preview');#}
{#        if (refreshBtn) refreshBtn.addEventListener('click', refreshResumePreview);#}
{##}
{#        // Ensure the Previous Step button causes a full page reload#}
{#        const prevStepBtn = document.getElementById('prev-step-btn');#}
{#        if (prevStepBtn) {#}
{#            prevStepBtn.addEventListener('click', function(e) {#}
{#                e.preventDefault();#}
{#                const href = this.getAttribute('href');#}
{#                window.location.href = href;#}
{#            });#}
{#        }#}
{##}
{#        // Ensure the resume form submission causes a full page reload#}
{#        const resumeForm = document.getElementById('resume-form');#}
{#        if (resumeForm) {#}
{#            // We need to ensure HTMX doesn't interfere with form submission#}
{#            resumeForm.setAttribute('hx-boost', 'false');#}
{##}
{#            // For the next/save button, let's add a direct handler#}
{#            const nextButton = document.getElementById('next-step-btn');#}
{#            if (nextButton) {#}
{#                nextButton.addEventListener('click', function(e) {#}
{#                    // Prevent the default button behavior#}
{#                    e.preventDefault();#}
{##}
{#                    // Disable any HTMX features#}
{#                    if (typeof htmx !== 'undefined') {#}
{#                        htmx.config.globalViewTransitions = false;#}
{#                        resumeForm.setAttribute('hx-boost', 'false');#}
{#                        resumeForm.setAttribute('data-no-ajax', 'true');#}
{#                    }#}
{##}
{#                    // Ensure form is submitted with page reload#}
{#                    resumeForm.setAttribute('onsubmit', '');#}
{##}
{#                    // Submit the form to cause a full page reload#}
{#                    resumeForm.submit();#}
{#                });#}
{#            }#}
{##}
{#            // Handle the complete resume button similarly#}
{#            const completeButton = document.getElementById('complete-resume-btn');#}
{#            if (completeButton) {#}
{#                completeButton.addEventListener('click', function(e) {#}
{#                    e.preventDefault();#}
{##}
{#                    if (typeof htmx !== 'undefined') {#}
{#                        htmx.config.globalViewTransitions = false;#}
{#                        resumeForm.setAttribute('hx-boost', 'false');#}
{#                        resumeForm.setAttribute('data-no-ajax', 'true');#}
{#                    }#}
{##}
{#                    resumeForm.setAttribute('onsubmit', '');#}
{#                    resumeForm.submit();#}
{#                });#}
{#            }#}
{#        }#}
{#    });#}
{#    // Dynamic Form Row Functions#}
{#    function addFormRow(formType, container, countField) {#}
{#        const rows = document.querySelectorAll(`#${container} .form-row`);#}
{#        const index = rows.length;#}
{##}
{#        // Update the count field#}
{#        document.getElementById(countField).value = index + 1;#}
{##}
{#        // Show loading indicator#}
{#        const addButton = document.querySelector(`button[onclick="addFormRow('${formType}', '${container}', '${countField}')"]`);#}
{#        if (addButton) {#}
{#            const originalHTML = addButton.innerHTML;#}
{#            addButton.innerHTML = `<span class="loading loading-spinner loading-xs"></span> Adding...`;#}
{#            addButton.disabled = true;#}
{##}
{#            // Make HTMX request to add a new row#}
{#            htmx.ajax('GET', `/job/htmx/add-form-row/?form_type=${formType}&index=${index}`, {#}
{#                target: `#${container}`,#}
{#                swap: 'beforeend',#}
{#                complete: function() {#}
{#                    // Restore button#}
{#                    addButton.innerHTML = originalHTML;#}
{#                    addButton.disabled = false;#}
{##}
{#                    // Scroll to the new row with smooth animation#}
{#                    const newRow = document.querySelector(`#${container} .form-row:last-child`);#}
{#                    if (newRow) {#}
{#                        newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });#}
{#                        newRow.classList.add('highlight-new');#}
{#                        setTimeout(() => {#}
{#                            newRow.classList.remove('highlight-new');#}
{#                        }, 1500);#}
{#                    }#}
{#                }#}
{#            });#}
{#        }#}
{#    }#}
{##}
{#    function removeFormRow(button, container, countField) {#}
{#        const row = button.closest('.form-row');#}
{##}
{#        // Add fade-out animation#}
{#        row.classList.add('fade-out');#}
{##}
{#        // Remove after animation completes#}
{#        setTimeout(() => {#}
{#            row.remove();#}
{##}
{#            // Update indexes of remaining rows#}
{#            const rows = document.querySelectorAll(`#${container} .form-row`);#}
{#            document.getElementById(countField).value = rows.length;#}
{##}
{#            // Update the indexes in the form fields#}
{#            rows.forEach((row, index) => {#}
{#                updateFormRowIndex(row, index);#}
{#            });#}
{#        }, 300);#}
{#    }#}
{##}
{#    function updateFormRowIndex(row, newIndex) {#}
{#        row.querySelectorAll('input, select, textarea').forEach(field => {#}
{#            const name = field.getAttribute('name');#}
{#            if (name) {#}
{#                // Extract the field name pattern (e.g., skill_name_X)#}
{#                const pattern = name.replace(/\_\d+($|\_)/, '_INDEX$1');#}
{#                // Replace INDEX with the new index#}
{#                const newName = pattern.replace('INDEX', newIndex);#}
{#                field.setAttribute('name', newName);#}
{##}
{#                // Also update id if present#}
{#                const id = field.getAttribute('id');#}
{#                if (id) {#}
{#                    const idPattern = id.replace(/\_\d+($|\_)/, '_INDEX$1');#}
{#                    const newId = idPattern.replace('INDEX', newIndex);#}
{#                    field.setAttribute('id', newId);#}
{#                }#}
{##}
{#                // Update for labels#}
{#                const labels = row.querySelectorAll(`label[for="${id}"]`);#}
{#                labels.forEach(label => {#}
{#                    label.setAttribute('for', newId);#}
{#                });#}
{#            }#}
{#        });#}
{#    }#}
{#    // Function to add a bullet point to an experience or project#}
{#    function addBulletPoint(parentIndex) {#}
{#        const bulletContainer = document.querySelector(`#bullet_points_container_${parentIndex}`);#}
{#        const bulletCount = parseInt(document.getElementById(`bullet_count_${parentIndex}`).value);#}
{##}
{#        // Show loading indicator#}
{#        const addButton = document.querySelector(`button[onclick="addBulletPoint('${parentIndex}')"]`);#}
{#        if (addButton) {#}
{#            const originalHTML = addButton.innerHTML;#}
{#            addButton.innerHTML = `<span class="loading loading-spinner loading-xs"></span> Adding...`;#}
{#            addButton.disabled = true;#}
{##}
{#            // Make HTMX request to add a new bullet point#}
{#            htmx.ajax('GET', `/job/htmx/add-form-row/?form_type=bullet_point&parent_index=${parentIndex}&index=${bulletCount}`, {#}
{#                target: bulletContainer,#}
{#                swap: 'beforeend',#}
{#                complete: function() {#}
{#                    // Restore button#}
{#                    addButton.innerHTML = originalHTML;#}
{#                    addButton.disabled = false;#}
{##}
{#                    // Update the bullet count#}
{#                    document.getElementById(`bullet_count_${parentIndex}`).value = bulletCount + 1;#}
{##}
{#                    // Scroll to the new bullet point#}
{#                    const newBullet = bulletContainer.querySelector('.bullet-point-row:last-child');#}
{#                    if (newBullet) {#}
{#                        newBullet.scrollIntoView({ behavior: 'smooth', block: 'center' });#}
{#                        newBullet.classList.add('highlight-new');#}
{#                        setTimeout(() => {#}
{#                            newBullet.classList.remove('highlight-new');#}
{#                        }, 1500);#}
{#                    }#}
{#                }#}
{#            });#}
{#        }#}
{#    }#}
{##}
{#    // Function to remove a bullet point#}
{#    function removeBulletPoint(button, parentIndex) {#}
{#        const bulletRow = button.closest('.bullet-point-row');#}
{#        const bulletContainer = document.getElementById(`bullet_points_container_${parentIndex}`);#}
{##}
{#        // Add fade-out animation#}
{#        bulletRow.classList.add('fade-out');#}
{##}
{#        // Remove after animation completes#}
{#        setTimeout(() => {#}
{#            bulletRow.remove();#}
{##}
{#            // Update bullet count#}
{#            const remainingBullets = bulletContainer.querySelectorAll('.bullet-point-row');#}
{#            document.getElementById(`bullet_count_${parentIndex}`).value = remainingBullets.length;#}
{##}
{#            // Update the indexes of the remaining bullet points#}
{#            remainingBullets.forEach((row, index) => {#}
{#                row.querySelectorAll('textarea, input').forEach(field => {#}
{#                    const id = field.getAttribute('id');#}
{#                    const name = field.getAttribute('name');#}
{##}
{#                    if (id && id.match(new RegExp(`bullet_${parentIndex}_\\d+`))) {#}
{#                        field.setAttribute('id', `bullet_${parentIndex}_${index}`);#}
{#                    }#}
{##}
{#                    if (name && name.match(new RegExp(`bullet_${parentIndex}_\\d+`))) {#}
{#                        field.setAttribute('name', `bullet_${parentIndex}_${index}`);#}
{#                    }#}
{##}
{#                    // Update data-index attribute if it exists#}
{#                    if (field.hasAttribute('data-index')) {#}
{#                        field.setAttribute('data-index', index);#}
{#                    }#}
{#                });#}
{#            });#}
{#        }, 300);#}
{#    }#}
{#    // Function to remove an experience, education, project etc.#}
{#    function removeExperience(button, index) {#}
{#        const row = button.closest('.experience-entry');#}
{##}
{#        // Add fade-out animation#}
{#        row.classList.add('fade-out');#}
{##}
{#        // Remove after animation completes#}
{#        setTimeout(() => {#}
{#            row.remove();#}
{##}
{#            // Update experience count#}
{#            const remainingExperiences = document.querySelectorAll('.experience-entry');#}
{##}
{#            // Update the display numbers and indexes#}
{#            remainingExperiences.forEach((expRow, idx) => {#}
{#                // Update the experience number displayed#}
{#                const numberSpan = expRow.querySelector('.experience-number');#}
{#                if (numberSpan) {#}
{#                    numberSpan.textContent = idx + 1;#}
{#                }#}
{##}
{#                // Update data-index attribute#}
{#                expRow.setAttribute('data-index', idx);#}
{##}
{#                // Update all field IDs and names#}
{#                updateExperienceIndex(expRow, idx);#}
{#            });#}
{##}
{#            // Update the hidden count field if it exists#}
{#            const countField = document.querySelector('input[name="experience_count"]');#}
{#            if (countField) {#}
{#                countField.value = remainingExperiences.length;#}
{#            }#}
{#        }, 300);#}
{#    }#}
{##}
{#    // Helper function to update experience field indexes#}
{#    function updateExperienceIndex(row, newIndex) {#}
{#        // Update all input/select/textarea fields#}
{#        row.querySelectorAll('input, select, textarea').forEach(field => {#}
{#            const name = field.getAttribute('name');#}
{#            const id = field.getAttribute('id');#}
{##}
{#            if (name) {#}
{#                // Update name attribute - replace the index part#}
{#                const newName = name.replace(/^([^_]+_)\d+/, `$1${newIndex}`);#}
{#                field.setAttribute('name', newName);#}
{#            }#}
{##}
{#            if (id) {#}
{#                // Update id attribute - replace the index part#}
{#                const newId = id.replace(/^([^_]+_)\d+/, `$1${newIndex}`);#}
{#                field.setAttribute('id', newId);#}
{##}
{#                // Update any associated labels#}
{#                const labels = row.querySelectorAll(`label[for="${id}"]`);#}
{#                labels.forEach(label => {#}
{#                    label.setAttribute('for', newId);#}
{#                });#}
{#            }#}
{#        });#}
{##}
{#        // Update bullet points container and related elements#}
{#        const bulletContainer = row.querySelector(`[id^="bullet_points_container_"]`);#}
{#        if (bulletContainer) {#}
{#            bulletContainer.id = `bullet_points_container_${newIndex}`;#}
{#        }#}
{##}
{#        const bulletCount = row.querySelector(`[id^="bullet_count_"]`);#}
{#        if (bulletCount) {#}
{#            bulletCount.id = `bullet_count_${newIndex}`;#}
{#            bulletCount.name = `bullet_count_${newIndex}`;#}
{#        }#}
{##}
{#        // Update any bullet point fields#}
{#        row.querySelectorAll(`[id^="bullet_"][id$="_0"], [id^="bullet_"][id$="_1"], [id^="bullet_"][id$="_2"]`).forEach(bulletField => {#}
{#            const id = bulletField.getAttribute('id');#}
{#            const bulletIndex = id.split('_').pop();#}
{#            bulletField.id = `bullet_${newIndex}_${bulletIndex}`;#}
{#            bulletField.name = `bullet_${newIndex}_${bulletIndex}`;#}
{##}
{#            if (bulletField.hasAttribute('data-parent')) {#}
{#                bulletField.setAttribute('data-parent', newIndex);#}
{#            }#}
{#        });#}
{##}
{#        // Update any other elements with IDs containing the index#}
{#        row.querySelectorAll(`[id$="_${newIndex - 1}"], [id*="_${newIndex - 1}_"]`).forEach(element => {#}
{#            const id = element.getAttribute('id');#}
{#            element.id = id.replace(new RegExp(`_${newIndex - 1}(_|$)`), `_${newIndex}$1`);#}
{#        });#}
{#    }#}
{#    // Function to validate dates (e.g., start date before end date)#}
{#    function validateDates(experienceIndex) {#}
{#        const startDateField = document.getElementById(`start_date_${experienceIndex}`);#}
{#        const endDateField = document.getElementById(`end_date_${experienceIndex}`);#}
{#        const isCurrentField = document.getElementById(`is_current_${experienceIndex}`);#}
{#        const validationMessage = document.getElementById(`date_validation_${experienceIndex}`);#}
{##}
{#        // Skip validation if either field is empty or if current job#}
{#        if (!startDateField || !startDateField.value || !endDateField || !endDateField.value || (isCurrentField && isCurrentField.checked)) {#}
{#            if (validationMessage) validationMessage.textContent = "";#}
{#            return true;#}
{#        }#}
{##}
{#        const startDate = new Date(startDateField.value);#}
{#        const endDate = new Date(endDateField.value);#}
{##}
{#        if (startDate > endDate) {#}
{#            if (validationMessage) {#}
{#                validationMessage.textContent = "Start date cannot be after end date";#}
{#            }#}
{#            endDateField.classList.add('border-red-500');#}
{#            return false;#}
{#        } else {#}
{#            if (validationMessage) validationMessage.textContent = "";#}
{#            endDateField.classList.remove('border-red-500');#}
{#            return true;#}
{#        }#}
{#    }#}
{##}
{#    // Function to toggle remote location#}
{#    function toggleRemoteLocation(experienceIndex) {#}
{#        const checkbox = document.getElementById(`is_remote_${experienceIndex}`);#}
{#        const locationField = document.getElementById(`location_${experienceIndex}`);#}
{##}
{#        if (!checkbox || !locationField) return;#}
{##}
{#        if (checkbox.checked) {#}
{#            // Save current location if not remote#}
{#            if (locationField.getAttribute('data-previous-value') === null) {#}
{#                locationField.setAttribute('data-previous-value', locationField.value);#}
{#            }#}
{#            locationField.value = "Remote";#}
{#        } else {#}
{#            // Restore previous value if available#}
{#            const previousValue = locationField.getAttribute('data-previous-value');#}
{#            if (previousValue) {#}
{#                locationField.value = previousValue;#}
{#                locationField.removeAttribute('data-previous-value');#}
{#            } else {#}
{#                locationField.value = "";#}
{#            }#}
{#        }#}
{#    }#}
{#    // Function to check experience required fields and update status indicator#}
{#    function updateExperienceStatus(experienceIndex) {#}
{#        const requiredFields = [#}
{#            document.getElementById(`job_title_${experienceIndex}`),#}
{#            document.getElementById(`employer_${experienceIndex}`),#}
{#            document.getElementById(`location_${experienceIndex}`),#}
{#            document.getElementById(`start_date_${experienceIndex}`)#}
{#        ];#}
{##}
{#        // Find the status indicator#}
{#        const statusIndicator = document.querySelector(`.experience-entry[data-index="${experienceIndex}"] .experience-status`);#}
{#        if (!statusIndicator) return;#}
{##}
{#        // Check if all required fields have values#}
{#        const allFilled = requiredFields.every(field => field && field.value.trim() !== '');#}
{##}
{#        // Also check that we have at least one bullet point with content#}
{#        const bulletPoints = document.querySelectorAll(`#bullet_points_container_${experienceIndex} textarea`);#}
{#        const hasBulletContent = Array.from(bulletPoints).some(bullet => bullet && bullet.value.trim() !== '');#}
{##}
{#        // Update the status indicator#}
{#        if (allFilled && hasBulletContent) {#}
{#            statusIndicator.classList.remove('bg-error');#}
{#            statusIndicator.classList.add('bg-success');#}
{#        } else {#}
{#            statusIndicator.classList.remove('bg-success');#}
{#            statusIndicator.classList.add('bg-error');#}
{#        }#}
{#    }#}
{##}
{#    // Function to check bullet quality and provide feedback#}
{#    function checkBulletQuality(textarea) {#}
{#        const text = textarea.value;#}
{#        const charCounter = textarea.closest('.form-control').querySelector('.char-counter .current');#}
{#        const qualityIndicator = textarea.closest('.form-control').querySelector('.bullet-quality');#}
{##}
{#        // Update character count#}
{#        if (charCounter) {#}
{#            charCounter.textContent = text.length;#}
{##}
{#            // Apply color based on optimal length (100-150 chars)#}
{#            if (text.length >= 80 && text.length <= 150) {#}
{#                charCounter.classList.add('text-success');#}
{#                charCounter.classList.remove('text-warning', 'text-error');#}
{#            } else if (text.length >= 50) {#}
{#                charCounter.classList.add('text-warning');#}
{#                charCounter.classList.remove('text-success', 'text-error');#}
{#            } else {#}
{#                charCounter.classList.add('text-error');#}
{#                charCounter.classList.remove('text-success', 'text-warning');#}
{#            }#}
{#        }#}
{##}
{#        // Skip full quality check if text is too short#}
{#        if (text.length < 10) {#}
{#            if (qualityIndicator) {#}
{#                qualityIndicator.innerHTML = '';#}
{#            }#}
{#            return;#}
{#        }#}
{##}
{#        // If HTMX is available, make a request to check bullet strength#}
{#        if (typeof htmx !== 'undefined' && qualityIndicator) {#}
{#            // Get the parent index and bullet index from textarea data attributes#}
{#            const parentIndex = textarea.getAttribute('data-parent');#}
{#            const bulletIndex = textarea.getAttribute('data-index');#}
{##}
{#            htmx.ajax('GET', `/job/ai/check-bullet-strength/?bullet_text=${encodeURIComponent(text)}`, {#}
{#                target: qualityIndicator,#}
{#                swap: 'innerHTML'#}
{#            });#}
{#        }#}
{#    }#}
{##}
{#    // Function to enhance a bullet point using AI#}
{#    function enhanceBullet(button, parentIndex, bulletIndex) {#}
{#        const bulletTextarea = document.getElementById(`bullet_${parentIndex}_${bulletIndex}`);#}
{#        const bulletText = bulletTextarea?.value;#}
{##}
{#        if (!bulletText?.trim()) {#}
{#            alert("Please enter text in the bullet point before enhancing.");#}
{#            return;#}
{#        }#}
{##}
{#        // Show loading indicator#}
{#        const loadingIndicator = document.getElementById(`enhance_indicator_${parentIndex}_${bulletIndex}`);#}
{#        if (loadingIndicator) loadingIndicator.style.display = 'inline-block';#}
{##}
{#        // Disable the enhance button#}
{#        button.disabled = true;#}
{##}
{#        // Make API request to enhance the bullet#}
{#        const aiEngine = document.querySelector('input[name="ai_engine"]:checked')?.value || 'chatgpt';#}
{##}
{#        htmx.ajax('GET', `/job/ai/enhance-bullet/?bullet_text=${encodeURIComponent(bulletText)}&ai_engine=${aiEngine}`, {#}
{#            beforeSend: function() {#}
{#                if (loadingIndicator) loadingIndicator.style.display = 'inline-block';#}
{#            },#}
{#            complete: function() {#}
{#                if (loadingIndicator) loadingIndicator.style.display = 'none';#}
{#                button.disabled = false;#}
{#            },#}
{#            afterSwap: function(swapStyle, target) {#}
{#                // The response will be the enhanced bullet text#}
{#                if (bulletTextarea) {#}
{#                    bulletTextarea.value = target.innerText;#}
{#                    bulletTextarea.dispatchEvent(new Event('keyup')); // Trigger quality check#}
{#                    bulletTextarea.focus(); // Focus back on the textarea#}
{##}
{#                    // Add highlighting animation#}
{#                    bulletTextarea.classList.add('highlight-new');#}
{#                    setTimeout(() => {#}
{#                        bulletTextarea.classList.remove('highlight-new');#}
{#                    }, 1500);#}
{#                }#}
{#            }#}
{#        });#}
{#    }#}
{#</script>#}
{#<style>#}
{#    /* Highlight animation for new elements */#}
{#    .highlight-new { animation: highlight-pulse 1.0s ease-out; }#}
{#    @keyframes highlight-pulse { 0%, 100% { background-color: transparent; } 50% { background-color: rgba(96, 165, 250, 0.15); } }#}
{##}
{#    /* Fade out animation for removed elements */#}
{#    .fade-out { opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0; margin-top: 0; margin-bottom: 0; border: none; overflow: hidden; transition: all 0.3s ease-out; }#}
{##}
{#    /* Optional: Style the wrapper for the injected preview HTML */#}
{#    .resume-preview-content { line-height: 1.6; }#}
{##}
{#    /* Responsive grid for step indicators */#}
{#    @media screen and (max-width: 1024px) {#}
{#        .grid-cols-{{ total_steps }} {#}
{#            grid-template-columns: repeat(5, 1fr);#}
{#        }#}
{#    }#}
{##}
{#    @media screen and (max-width: 768px) {#}
{#        .grid-cols-{{ total_steps }} {#}
{#            grid-template-columns: repeat(3, 1fr);#}
{#        }#}
{#    }#}
{##}
{#    @media screen and (max-width: 640px) {#}
{#        .grid-cols-{{ total_steps }} {#}
{#            grid-template-columns: repeat(2, 1fr);#}
{#        }#}
{#    }#}
{##}
{#    /* Hide scrollbar for clean UI */#}
{#    .no-scrollbar::-webkit-scrollbar {#}
{#        display: none;#}
{#    }#}
{##}
{#    .no-scrollbar {#}
{#        -ms-overflow-style: none;#}
{#        scrollbar-width: none;#}
{#    }#}
{##}
{#    /* Additional styles for bullet point quality indicators */#}
{#    .bullet-quality {#}
{#        min-height: 1.25rem; /* Reserved space for quality indicator */#}
{#    }#}
{##}
{#    /* Progress bar animation */#}
{#    .animate-progress {#}
{#        transition: width 1s ease-in-out;#}
{#    }#}
{#</style>#}
{#{% endblock %}#}
{##}
{##}
{#{% extends 'base_authenticated.html' %}#}
{#{% load resume_extras %} {# Keep if get_range is needed by child templates #}
{#{% load static %}#}
{#{% load widget_tweaks %} {# Keep if child templates use it #}
{##}
{#{% block title %}Resume Builder - Step {{ step }} of {{ total_steps }}{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mx-auto px-4 py-8 sm:py-10"> {# Adjusted padding #}
{#    <div class="mb-8 sm:mb-10">#}
{#        <div class="flex justify-between items-center mb-2">#}
{#            <h1 class="text-xl sm:text-2xl font-bold font-heading text-gray-800 dark:text-gray-100">Create Your Professional Resume</h1>#}
{#            <span class="text-sm font-medium text-gray-600 dark:text-gray-400">Step {{ step }} of {{ total_steps }}</span>#}
{#        </div>#}
{##}
{#        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-6"> {# Slightly thinner bar #}
{#            <div class="bg-indigo-600 h-2 rounded-full transition-all duration-500 ease-out" style="width: {{ step|floatformat:0|mul:100|div:total_steps }}%"></div>#}
{#        </div>#}
{##}
{#        <div class="grid grid-cols-3 gap-x-2 gap-y-3 text-xs text-center sm:grid-cols-5 md:grid-cols-9 lg:grid-cols-{{ total_steps }}"> {# Adjusted grid classes #}
{#            {% for i in total_steps|get_range %}#}
{#                <div class="flex flex-col items-center"> {# This centers bubble and text span horizontally #}
{##}
{#                    {% comment %} --- COMPLETED STEP --- {% endcomment %}#}
{#                    {% if i < step %}#}
{#                        <a href="{% url 'job_portal:resume_wizard' step=i %}" class="group text-center relative w-full" title="Go back to Step {{ i }}">#}
{#                            <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-500 dark:bg-gray-600 flex items-center justify-center mb-1 group-hover:bg-indigo-600 transition-colors duration-200">#}
{#                                <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                            </div>#}
                            {# --- Using pt-1 for alignment --- #}
{#                            <span class="pt-1 text-gray-500 dark:text-gray-400 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors duration-200 text-center w-full block text-[10px] sm:text-xs leading-tight px-1">#}
{#                                {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                            </span>#}
{#                        </a>#}
{##}
{#                    {% comment %} --- CURRENT STEP --- {% endcomment %}#}
{#                    {% elif i == step %}#}
{#                        <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-indigo-600 flex items-center justify-center mb-1 ring-2 ring-offset-2 ring-indigo-500 dark:ring-offset-gray-900">#}
{#                            <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                        </div>#}
                         {# --- Using pt-1 for alignment --- #}
{#                        <span class="pt-1 text-indigo-700 dark:text-indigo-300 font-semibold text-center w-full block text-[10px] sm:text-xs leading-tight px-1">#}
{#                            {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                        </span>#}
{##}
{#                    {% comment %} --- FUTURE STEP --- {% endcomment %}#}
{#                    {% else %}#}
                         {# Using the more visible style option #}
{#                         <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-400 dark:bg-gray-700 flex items-center justify-center mb-1"> {# Removed opacity #}
{#                            <span class="text-gray-700 dark:text-gray-400 text-sm font-medium">{{ i }}</span> {# Darker number text #}
{#                         </div>#}
                         {# --- Using pt-1 for alignment --- #}
{#                         <span class="pt-1 text-gray-600 dark:text-gray-500 text-center w-full block text-[10px] sm:text-xs leading-tight px-1"> {# Darker label text, no opacity #}
{#                             {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                         </span>#}
{#                    {% endif %}#}
{#                </div>#}
{#            {% endfor %}#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">#}
        {# Moved form tag here to wrap content and navigation #}
{#        <form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}" hx-boost="false">#}
{#            {% csrf_token %}#}
{#            <div class="p-6 sm:p-8"> {# Main content padding #}
{#                <h2 class="text-xl md:text-2xl font-semibold font-heading text-gray-900 dark:text-gray-100 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700 flex items-center">#}
{#                    <span class="mr-3 text-indigo-600 dark:text-indigo-400 opacity-90 text-xl w-6 text-center flex-shrink-0">#}
{#                        {% block step_icon %}#}
                            {# Explicit Icons based on step variable #}
{#                            {% if step == 1 %}<i class="fa-solid fa-user-circle"></i>#}
{#                            {% elif step == 2 %}<i class="fa-solid fa-file-lines"></i>#}
{#                            {% elif step == 3 %}<i class="fa-solid fa-lightbulb"></i>#}
{#                            {% elif step == 4 %}<i class="fa-solid fa-briefcase"></i>#}
{#                            {% elif step == 5 %}<i class="fa-solid fa-graduation-cap"></i>#}
{#                            {% elif step == 6 %}<i class="fa-solid fa-diagram-project"></i>#}
{#                            {% elif step == 7 %}<i class="fa-solid fa-certificate"></i>#}
{#                            {% elif step == 8 %}<i class="fa-solid fa-language"></i>#}
{#                            {% elif step == 9 %}<i class="fa-solid fa-puzzle-piece"></i>#}
{#                            {% else %}<i class="fa-solid fa-clipboard-list"></i>#}
{#                            {% endif %}#}
{#                        {% endblock step_icon %}#}
{#                    </span>#}
{#                    <span>{% block step_title %}{% endblock %}</span> {# Title from child template #}
{#                </h2>#}
{##}
{#                <div class="space-y-6">#}
{#                    {% block step_content %}{% endblock %} {# personal_info.html content goes here #}
{#                </div>#}
{#            </div> {# End padding div #}
{##}
{#             <div class="px-6 sm:px-8 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">#}
{#                 {% block wizard_navigation %}#}
{#                    {% with primary_button_classes="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out dark:focus:ring-offset-gray-900 disabled:opacity-50" success_button_classes="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition duration-150 ease-in-out dark:focus:ring-offset-gray-900" secondary_button_classes="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900" %}#}
{#                    <div class="flex justify-between items-center">#}
{#                        {% if step > 1 %}#}
                        {# Use secondary style for previous button #}
{#                        <a href="{% url 'job_portal:resume_wizard' step=step|add:'-1' %}" class="{{ secondary_button_classes }}" id="prev-step-btn">#}
{#                            <i class="fa-solid fa-chevron-left mr-2 -ml-1 h-5 w-5" aria-hidden="true"></i> Previous Step#}
{#                        </a>#}
{#                        {% else %}#}
{#                        <div></div> {# Placeholder for spacing #}
{#                        {% endif %}#}
{##}
{#                        {% if step < total_steps %}#}
{#                        <button type="submit" form="resume-form" class="{{ primary_button_classes }}" id="next-step-btn">#}
{#                            Save & Continue <i class="fa-solid fa-chevron-right ml-2 -mr-1 h-5 w-5" aria-hidden="true"></i>#}
{#                        </button>#}
{#                        {% else %}#}
{#                        <button type="submit" form="resume-form" class="{{ success_button_classes }}" id="complete-resume-btn">#}
{#                            <i class="fa-solid fa-check mr-2"></i> Complete Resume#}
{#                        </button>#}
{#                        {% endif %}#}
{#                    </div>#}
{#                    {% endwith %}#}
{#                 {% endblock wizard_navigation %}#}
{#            </div>#}
{#        </form> {# End Form #}
{#    </div> {# End Card #}
{##}
{#    <div class="mt-8 text-center">#}
{#        <button id="open-preview-modal" type="button" class="inline-flex items-center justify-center px-4 py-2 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900">#}
{#            <i class="fa-solid fa-eye mr-2"></i> Preview Resume#}
{#        </button>#}
{#    </div>#}
{##}
{#    <div id="resumePreviewModal" class="fixed inset-0 z-[60] overflow-y-auto hidden items-center justify-center p-4" aria-labelledby="resume-modal-title" role="dialog" aria-modal="true">#}
{#        <div class="fixed inset-0 bg-gray-900/80 transition-opacity" aria-hidden="true" onclick="closeResumePreviewModal()"></div>#}
{##}
{#        <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-xl overflow-hidden w-11/12 max-w-4xl mx-auto my-8 transform transition-all">#}
{#            <div class="bg-indigo-700 p-4 px-6 text-white flex justify-between items-center">#}
{#                <h3 class="font-semibold text-lg flex items-center font-heading" id="resume-modal-title">#}
{#                    <i class="fa-solid fa-file-invoice mr-3"></i>#}
{#                    <span>Resume Preview</span>#}
{#                </h3>#}
{#                <button class="inline-flex items-center justify-center h-8 w-8 rounded-full transition duration-150 ease-in-out bg-transparent text-indigo-100 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-indigo-700 focus:ring-white" onclick="closeResumePreviewModal()">#}
{#                    <span class="sr-only">Close</span> <i class="fa-solid fa-times text-lg"></i>#}
{#                </button>#}
{#            </div>#}
{##}
{#            <div id="resume-preview" class="h-[75vh] overflow-y-auto p-0 bg-gray-200 dark:bg-gray-700">#}
                {# Content loaded via JS - Initial state handled in JS openResumePreviewModal #}
{#                <div class="flex flex-col justify-center items-center h-full text-gray-500 dark:text-gray-400 p-4 text-center">#}
{#                    <i class="fa-solid fa-spinner fa-spin text-4xl text-indigo-600 dark:text-indigo-400 mb-4 animate-spin"></i>#}
{#                    <p>Loading initial preview...</p>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="border-t border-gray-200 dark:border-gray-700 p-4 px-6 flex justify-between items-center bg-gray-50 dark:bg-gray-900">#}
{#                <button id="refresh-preview" class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-700 dark:focus:ring-offset-gray-900">#}
{#                    <i class="fa-solid fa-sync-alt mr-2"></i> Refresh Preview#}
{#                </button>#}
{#                <button class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900" onclick="closeResumePreviewModal()">#}
{#                    Close#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#</div> {# End Container #}
{#{% endblock content %}#}
{##}
{##}
{#{% block extra_js %}#}
{# Ensure HTMX is loaded in base_authenticated.html if dynamic form functions are used #}
{#<script>#}
{#    // Function to toggle end date (if used by child templates)#}
{#    function toggleEndDate(checkbox) {#}
{#        try {#}
{#            const fieldWrapper = checkbox.closest('.field-wrapper') || checkbox.closest('div[class*="space-y-"] > div') || checkbox.closest('.form-group');#}
{#            if (!fieldWrapper) return;#}
{##}
{#            const endDateField = fieldWrapper.querySelector('input[name$="end_date"], select[name$="end_date"]');#}
{#            const endDateLabel = fieldWrapper.querySelector('label[for$="end_date"]');#}
{##}
{#            if (endDateField) {#}
{#                const container = endDateField.closest('.relative') || endDateField.parentElement;#}
{#                if (checkbox.checked) {#}
{#                    endDateField.disabled = true;#}
{#                    endDateField.value = '';#}
{#                    container?.classList.add('opacity-50', 'pointer-events-none');#}
{#                    endDateLabel?.classList.add('opacity-50');#}
{#                    endDateField.required = false;#}
{#                } else {#}
{#                    endDateField.disabled = false;#}
{#                    container?.classList.remove('opacity-50', 'pointer-events-none');#}
{#                    endDateLabel?.classList.remove('opacity-50');#}
{#                    // if(endDateField.dataset.wasRequired === 'true') { endDateField.required = true; }#}
{#                }#}
{#            }#}
{#        } catch (e) { console.error("Error in toggleEndDate:", e); }#}
{#    }#}
{##}
{#    // --- Resume Preview Modal Functions ---#}
{#    const resumePreviewModal = document.getElementById('resumePreviewModal');#}
{#    const resumePreviewContainer = document.getElementById('resume-preview');#}
{#    const resumeFormForPreview = document.getElementById('resume-form');#}
{#    const currentStep = {{ step|default:0 }}; // Get current step from Django context#}
{##}
{#    function openResumePreviewModal() {#}
{#        if (!resumePreviewModal || !resumePreviewContainer) {#}
{#            console.error("Resume Preview Modal or container element not found!");#}
{#            return;#}
{#        }#}
{#        // Always open the modal#}
{#        resumePreviewModal.classList.remove('hidden');#}
{#        resumePreviewModal.classList.add('flex');#}
{#        document.body.style.overflow = 'hidden';#}
{##}
{#        // Check if it's the first step to show message OR fetch preview#}
{#        if (currentStep === 1) {#}
{#            // Show message on step 1#}
{#            resumePreviewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full p-8 text-center">#}
{#                    <i class="fa-solid fa-info-circle text-4xl text-sky-500 dark:text-sky-400 mb-4"></i>#}
{#                    <p class="text-gray-800 dark:text-gray-200 mb-2 font-semibold">Preview Available Soon</p>#}
{#                    <p class="text-sm text-gray-600 dark:text-gray-400 max-w-md">#}
{#                        The full resume preview requires information from later steps. Please complete this step and continue. The preview will be available from Step 2 onwards.#}
{#                    </p>#}
{#                </div>`;#}
{#        } else {#}
{#            // Fetch the actual preview for steps > 1#}
{#            refreshResumePreview();#}
{#        }#}
{#    }#}
{##}
{#    function closeResumePreviewModal() {#}
{#        if (resumePreviewModal) {#}
{#            resumePreviewModal.classList.add('hidden');#}
{#            resumePreviewModal.classList.remove('flex');#}
{#            document.body.style.overflow = 'auto';#}
{#        }#}
{#    }#}
{##}
{#    function refreshResumePreview() {#}
{#        // Prevent refresh attempt on step 1 (keep message displayed)#}
{#        if (currentStep === 1) {#}
{#            console.log("Preview refresh skipped on step 1.");#}
{#            // Ensure the message is still there if modal was somehow cleared#}
{#            if(resumePreviewContainer && resumePreviewContainer.querySelector('.fa-info-circle') == null){#}
{#                 openResumePreviewModal(); // Re-call to reset content to the message#}
{#            }#}
{#            return;#}
{#        }#}
{##}
{#        if (!resumePreviewContainer || !resumeFormForPreview) {#}
{#            console.error("Preview container or form element not found for refresh.");#}
{#            return;#}
{#        }#}
{#        // Indicate loading#}
{#        resumePreviewContainer.innerHTML = `#}
{#            <div class="flex flex-col items-center justify-center h-full p-4 text-gray-600 dark:text-gray-400">#}
{#                <i class="fas fa-spinner fa-spin text-3xl text-indigo-600 dark:text-indigo-400 mb-4 animate-spin"></i>#}
{#                <p>Generating preview...</p>#}
{#            </div>`;#}
{##}
{#        const formData = new FormData(resumeFormForPreview);#}
{#        // Add any necessary logic here to append data from dynamic formsets if your preview view needs it#}
{##}
{#        fetch("{% url 'job_portal:preview_current_resume' %}", { // ** VERIFY URL NAME **#}
{#            method: 'POST',#}
{#            body: formData,#}
{#            headers: {#}
{#                'X-Requested-With': 'XMLHttpRequest',#}
{#                'X-CSRFToken': formData.get('csrfmiddlewaretoken')#}
{#            }#}
{#        })#}
{#        .then(response => {#}
{#            if (!response.ok) {#}
{#                 return response.text().then(text => { throw new Error(`Preview Error (${response.status}): ${text.substring(0, 200)}`); });#}
{#            }#}
{#            return response.text();#}
{#        })#}
{#        .then(html => {#}
{#            // Inject response HTML. Added a light background wrapper.#}
{#            resumePreviewContainer.innerHTML = `<div class="resume-preview-content bg-white dark:bg-gray-50 shadow-lg m-1 sm:m-2 p-2 sm:p-4">${html}</div>`;#}
{#        })#}
{#        .catch(error => {#}
{#            console.error("Resume Preview fetch/processing error:", error);#}
{#            resumePreviewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full p-8 text-center">#}
{#                    <i class="fa-solid fa-circle-exclamation text-4xl text-red-500 mb-4"></i>#}
{#                    <p class="text-red-600 dark:text-red-400 mb-2 font-semibold">Failed to Load Preview</p>#}
{#                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 max-w-md">${error.message || 'An unknown error occurred.'}</p>#}
{#                    <button class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-800" onclick="refreshResumePreview()">#}
{#                        <i class="fa-solid fa-sync-alt mr-2"></i> Try Again#}
{#                    </button>#}
{#                </div>`;#}
{#        });#}
{#    }#}
{##}
{#    // Initial setup on page load#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#        // Setup 'is_current' checkboxes#}
{#        document.querySelectorAll('input[type="checkbox"][name$="is_current"]').forEach(function(checkbox) {#}
{#            toggleEndDate(checkbox);#}
{#            checkbox.addEventListener('change', function() { toggleEndDate(this); });#}
{#        });#}
{##}
{#        // Setup preview button listeners#}
{#        const openModalBtn = document.getElementById('open-preview-modal');#}
{#        if (openModalBtn) openModalBtn.addEventListener('click', openResumePreviewModal);#}
{##}
{#        const refreshBtn = document.getElementById('refresh-preview');#}
{#        if (refreshBtn) refreshBtn.addEventListener('click', refreshResumePreview);#}
{#    });#}
{##}
{#    // --- Dynamic Form Row Functions (Keep/Adapt ONLY if needed) ---#}
{#    /* function addFormRow(...) { ... } */#}
{#    /* function removeFormRow(...) { ... } */#}
{#    /* function updateFormRowIndex(...) { ... } */#}
{#    /* function addBulletPoint(...) { ... } */#}
{#    /* function removeBulletPoint(...) { ... } */#}
{##}
{#</script>#}
{##}
{# Keep specific styles if needed, e.g., animations #}
{#<style>#}
{#    .highlight-new { animation: highlight-pulse 1.0s ease-out; }#}
{#    @keyframes highlight-pulse { 0%, 100% { background-color: transparent; } 50% { background-color: rgba(96, 165, 250, 0.15); } }#}
{#    .fade-out { opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0; margin-top: 0; margin-bottom: 0; border: none; overflow: hidden; transition: all 0.3s ease-out; }#}
{#    /* Optional: Style the wrapper for the injected preview HTML */#}
{#    .resume-preview-content { /* Example: */ line-height: 1.6; }#}
{#</style>#}
{#{% endblock %}#}
{##}
{#{% extends 'base_authenticated.html' %}#}
{#{% load resume_extras %} {# Keep if get_range is needed by child templates #}
{#{% load static %}#}
{#{% load widget_tweaks %} {# Keep if child templates use it #}
{##}
{#{% block title %}Resume Builder - Step {{ step }} of {{ total_steps }}{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mx-auto px-4 py-8 sm:py-10"> {# Adjusted padding #}
{#    <div class="mb-8 sm:mb-10">#}
{#        <div class="flex justify-between items-center mb-2">#}
{#            <h1 class="text-xl sm:text-2xl font-bold font-heading text-gray-800 dark:text-gray-100">Create Your Professional Resume</h1>#}
{#            <span class="text-sm font-medium text-gray-600 dark:text-gray-400">Step {{ step }} of {{ total_steps }}</span>#}
{#        </div>#}
{##}
{#        <div class="w-full bg-gray-200 dark:bg-gray-300 rounded-full h-2 mb-6"> {# Slightly thinner bar #}
{#            <div class="bg-indigo-600 h-2 rounded-full transition-all duration-500 ease-out" style="width: {{ step|floatformat:0|mul:100|div:total_steps }}%"></div>#}
{#        </div>#}
{##}
{#        <div class="grid grid-cols-3 gap-x-2 gap-y-3 text-xs text-center sm:grid-cols-5 md:grid-cols-9 lg:grid-cols-{{ total_steps }}"> {# Adjusted grid classes #}
{#            {% for i in total_steps|get_range %}#}
{#                <div class="flex flex-col items-center">#}
{#                    {% if i < step %}#}
{#                        <a href="{% url 'job_portal:resume_wizard' step=i %}" class="group text-center relative w-full" title="Go back to Step {{ i }}">#}
{#                            <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-500 dark:bg-gray-600 flex items-center justify-center mb-1 group-hover:bg-indigo-600 transition-colors duration-200">#}
{#                                <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                            </div>#}
{#                            <span class="text-gray-500 dark:text-gray-400 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors duration-200 text-center w-full block text-[10px] sm:text-xs leading-tight px-1"> {# Smaller text, padding #}
{#                                {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                            </span>#}
{#                        </a>#}
{#                    {% elif i == step %}#}
{#                        <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-indigo-600 flex items-center justify-center mb-1 ring-2 ring-offset-2 ring-indigo-500 dark:ring-offset-gray-900">#}
{#                            <span class="text-white text-sm font-medium">{{ i }}</span>#}
{#                        </div>#}
{#                        <span class="text-indigo-700 dark:text-indigo-300 font-semibold text-center w-full block text-[10px] sm:text-xs leading-tight px-1">#}
{#                            {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                        </span>#}
{#                    {% else %}#}
{#                         <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center mb-1 opacity-60">#}
{#                            <span class="text-gray-500 dark:text-gray-400 text-sm font-medium">{{ i }}</span>#}
{#                        </div>#}
{#                         <span class="text-gray-400 dark:text-gray-500 text-center w-full block text-[10px] sm:text-xs leading-tight opacity-60 px-1">#}
{#                             {% if i == 1 %}Personal{% elif i == 2 %}Summary{% elif i == 3 %}Skills{% elif i == 4 %}Experience{% elif i == 5 %}Education{% elif i == 6 %}Projects{% elif i == 7 %}Certifications{% elif i == 8 %}Languages{% elif i == 9 %}Additional{% else %}Step {{ i }}{% endif %}#}
{#                        </span>#}
{#                    {% endif %}#}
{#                </div>#}
{#            {% endfor %}#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">#}
        {# Added form tag here, wrapping the content block #}
{#        <form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}" hx-boost="false">#}
{#            {% csrf_token %}#}
{#            <div class="p-6 sm:p-8">#}
{#                <h2 class="text-xl md:text-2xl font-semibold font-heading text-gray-900 dark:text-gray-100 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700 flex items-center">#}
{#                    <span class="mr-3 text-indigo-600 dark:text-indigo-400 opacity-90 text-xl w-6 text-center flex-shrink-0">#}
{#                        {% block step_icon %}#}
                            {# Explicit Icons based on step variable #}
{#                            {% if step == 1 %}<i class="fa-solid fa-user-circle"></i>#}
{#                            {% elif step == 2 %}<i class="fa-solid fa-file-lines"></i>#}
{#                            {% elif step == 3 %}<i class="fa-solid fa-lightbulb"></i>#}
{#                            {% elif step == 4 %}<i class="fa-solid fa-briefcase"></i>#}
{#                            {% elif step == 5 %}<i class="fa-solid fa-graduation-cap"></i>#}
{#                            {% elif step == 6 %}<i class="fa-solid fa-diagram-project"></i>#}
{#                            {% elif step == 7 %}<i class="fa-solid fa-certificate"></i>#}
{#                            {% elif step == 8 %}<i class="fa-solid fa-language"></i>#}
{#                            {% elif step == 9 %}<i class="fa-solid fa-puzzle-piece"></i>#}
{#                            {% else %}<i class="fa-solid fa-clipboard-list"></i>#}
{#                            {% endif %}#}
{#                        {% endblock step_icon %}#}
{#                    </span>#}
{#                    <span>{% block step_title %}{% endblock %}</span> {# Title from child template #}
{#                </h2>#}
{##}
{#                <div class="space-y-6">#}
{#                    {% block step_content %}{% endblock %}#}
{#                </div>#}
{#            </div> {# End padding div #}
{##}
{#             <div class="px-6 sm:px-8 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">#}
{#                 {% block wizard_navigation %}#}
{#                    {% with primary_button_classes="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out dark:focus:ring-offset-gray-900 disabled:opacity-50" success_button_classes="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition duration-150 ease-in-out dark:focus:ring-offset-gray-900" secondary_button_classes="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900" %}#}
{#                    <div class="flex justify-between items-center">#}
{#                        {% if step > 1 %}#}
                        {# Use secondary style for previous button #}
{#                        <a href="{% url 'job_portal:resume_wizard' step=step|add:'-1' %}" class="{{ secondary_button_classes }}" id="prev-step-btn">#}
{#                            <i class="fa-solid fa-chevron-left mr-2 -ml-1 h-5 w-5" aria-hidden="true"></i> Previous Step#}
{#                        </a>#}
{#                        {% else %}#}
{#                        <div></div> {% endif %}#}
{##}
{#                        {% if step < total_steps %}#}
{#                        <button type="submit" form="resume-form" class="{{ primary_button_classes }}" id="next-step-btn">#}
{#                            Save & Continue <i class="fa-solid fa-chevron-right ml-2 -mr-1 h-5 w-5" aria-hidden="true"></i>#}
{#                        </button>#}
{#                        {% else %}#}
{#                        <button type="submit" form="resume-form" class="{{ success_button_classes }}" id="complete-resume-btn">#}
{#                            <i class="fa-solid fa-check mr-2"></i> Complete Resume#}
{#                        </button>#}
{#                        {% endif %}#}
{#                    </div>#}
{#                    {% endwith %}#}
{#                 {% endblock wizard_navigation %}#}
{#            </div>#}
{#        </form> {# End Form #}
{#    </div> {# End Card #}
{##}
{#    <div class="mt-8 text-center">#}
{#        <button id="open-preview-modal" type="button" class="inline-flex items-center justify-center px-4 py-2 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900">#}
{#            <i class="fa-solid fa-eye mr-2"></i> Preview Resume#}
{#        </button>#}
{#    </div>#}
{##}
{#    <div id="resumePreviewModal" class="fixed inset-0 z-[60] overflow-y-auto hidden items-center justify-center p-4" aria-labelledby="resume-modal-title" role="dialog" aria-modal="true">#}
{#        <div class="fixed inset-0 bg-gray-900/80 transition-opacity" aria-hidden="true" onclick="closeResumePreviewModal()"></div>#}
{##}
{#        <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-xl overflow-hidden w-11/12 max-w-4xl mx-auto my-8 transform transition-all">#}
{#            <div class="bg-indigo-700 p-4 px-6 text-white flex justify-between items-center">#}
{#                <h3 class="font-semibold text-lg flex items-center font-heading" id="resume-modal-title">#}
{#                    <i class="fa-solid fa-file-invoice mr-3"></i> {# Changed Icon #}
{#                    <span>Resume Preview</span>#}
{#                </h3>#}
{#                <button class="inline-flex items-center justify-center h-8 w-8 rounded-full transition duration-150 ease-in-out bg-transparent text-indigo-100 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-indigo-700 focus:ring-white" onclick="closeResumePreviewModal()">#}
{#                    <span class="sr-only">Close</span> <i class="fa-solid fa-times text-lg"></i>#}
{#                </button>#}
{#            </div>#}
{##}
{#            <div id="resume-preview" class="h-[75vh] overflow-y-auto p-0 bg-gray-200 dark:bg-gray-700">#}
{#                <div class="flex flex-col justify-center items-center h-full text-gray-500 dark:text-gray-400 p-4 text-center">#}
{#                    <i class="fa-solid fa-spinner fa-spin text-4xl text-indigo-600 dark:text-indigo-400 mb-4"></i>#}
{#                    <p>Loading initial preview...</p>#}
{#                    <p class="text-xs mt-2">Click "Refresh Preview" button below if needed.</p>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="border-t border-gray-200 dark:border-gray-700 p-4 px-6 flex justify-between items-center bg-gray-50 dark:bg-gray-900">#}
{#                <button id="refresh-preview" class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-700 dark:focus:ring-offset-gray-900">#}
{#                    <i class="fa-solid fa-sync-alt mr-2"></i> Refresh Preview#}
{#                </button>#}
{#                <button class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-900" onclick="closeResumePreviewModal()">#}
{#                    Close#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#</div> {# End Container #}
{#{% endblock content %}#}
{##}
{#{% block extra_js %}#}
{# Ensure HTMX is loaded in base_authenticated.html if dynamic form functions are used #}
{#<script>#}
{#    // Function to toggle end date (if used by child templates)#}
{#    function toggleEndDate(checkbox) {#}
{#        try {#}
{#            // Adjust selector based on actual field wrappers used in child templates#}
{#            const fieldWrapper = checkbox.closest('.field-wrapper') || checkbox.closest('div[class*="space-y-"] > div');#}
{#            const endDateField = fieldWrapper?.querySelector('[name$="end_date"]');#}
{#            const endDateLabel = fieldWrapper?.querySelector('label[for$="end_date"]');#}
{##}
{#            if (endDateField) {#}
{#                const container = endDateField.closest('.relative') || endDateField.parentElement;#}
{#                if (checkbox.checked) {#}
{#                    endDateField.disabled = true;#}
{#                    endDateField.value = ''; // Clear value when disabling#}
{#                    container?.classList.add('opacity-50', 'cursor-not-allowed');#}
{#                    endDateLabel?.classList.add('opacity-50');#}
{#                    endDateField.required = false; // Might need to adjust requirement#}
{#                } else {#}
{#                    endDateField.disabled = false;#}
{#                    container?.classList.remove('opacity-50', 'cursor-not-allowed');#}
{#                    endDateLabel?.classList.remove('opacity-50');#}
{#                    // Re-set required if it was originally required (needs backend info or data attribute)#}
{#                    // endDateField.required = true;#}
{#                }#}
{#            }#}
{#        } catch (e) { console.error("Error in toggleEndDate:", e); }#}
{#    }#}
{##}
{#    // --- Resume Preview Modal Functions ---#}
{#    const resumePreviewModal = document.getElementById('resumePreviewModal');#}
{#    const resumePreviewContainer = document.getElementById('resume-preview');#}
{#    const resumeFormForPreview = document.getElementById('resume-form'); // Use the form ID#}
{##}
{#    function openResumePreviewModal() {#}
{#        if (resumePreviewModal) {#}
{#            resumePreviewModal.classList.remove('hidden');#}
{#            resumePreviewModal.classList.add('flex');#}
{#            document.body.style.overflow = 'hidden'; // Prevent background scroll#}
{#            refreshResumePreview(); // Fetch preview when opening#}
{#        } else {#}
{#             console.error("Resume Preview Modal element not found!");#}
{#        }#}
{#    }#}
{##}
{#    function closeResumePreviewModal() {#}
{#        if (resumePreviewModal) {#}
{#            resumePreviewModal.classList.add('hidden');#}
{#            resumePreviewModal.classList.remove('flex');#}
{#            document.body.style.overflow = 'auto'; // Restore background scroll#}
{#        }#}
{#    }#}
{##}
{#    function refreshResumePreview() {#}
{#        if (!resumePreviewContainer || !resumeFormForPreview) {#}
{#            console.error("Preview container or form element not found.");#}
{#            return; // Exit if elements are missing#}
{#        }#}
{#        // Indicate loading#}
{#        resumePreviewContainer.innerHTML = `#}
{#            <div class="flex flex-col items-center justify-center h-full p-4 text-gray-600 dark:text-gray-400">#}
{#                <i class="fas fa-spinner fa-spin text-3xl text-indigo-600 dark:text-indigo-400 mb-4 animate-spin"></i>#}
{#                <p>Generating preview...</p>#}
{#            </div>`;#}
{##}
{#        const formData = new FormData(resumeFormForPreview);#}
{#        // Append any extra data needed by the view (like dynamic counts if applicable)#}
{##}
{#        fetch("{% url 'job_portal:preview_current_resume' %}", { // ** VERIFY THIS URL NAME **#}
{#            method: 'POST',#}
{#            body: formData,#}
{#            headers: {#}
{#                'X-Requested-With': 'XMLHttpRequest',#}
{#                'X-CSRFToken': formData.get('csrfmiddlewaretoken') // Get token from form data#}
{#            }#}
{#        })#}
{#        .then(response => {#}
{#            if (!response.ok) {#}
{#                 // Provide more context on failure#}
{#                 return response.text().then(text => { throw new Error(`Preview Error (${response.status}): ${text.substring(0, 150)}`); });#}
{#            }#}
{#            return response.text(); // Expecting HTML fragment#}
{#        })#}
{#        .then(html => {#}
{#            // Inject the received HTML into the preview area#}
{#            // Add a wrapper for potential base styling/padding if needed#}
{#            resumePreviewContainer.innerHTML = `<div class="resume-preview-content p-2">${html}</div>`;#}
{#        })#}
{#        .catch(error => {#}
{#            console.error("Resume Preview fetch/processing error:", error);#}
{#            // Display a user-friendly error message inside the modal#}
{#            resumePreviewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full p-8 text-center">#}
{#                    <i class="fa-solid fa-circle-exclamation text-4xl text-red-500 mb-4"></i>#}
{#                    <p class="text-red-600 dark:text-red-400 mb-2 font-semibold">Failed to Load Preview</p>#}
{#                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">${error.message || 'An unknown error occurred.'}</p>#}
{#                    <button class="inline-flex items-center justify-center px-3 py-1.5 border border-indigo-600 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-indigo-300 dark:border-indigo-500 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-800" onclick="refreshResumePreview()">#}
{#                        <i class="fa-solid fa-sync-alt mr-2"></i> Try Again#}
{#                    </button>#}
{#                </div>`;#}
{#        });#}
{#    }#}
{##}
{#    // Initial setup on page load#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#        // Setup 'is_current' checkboxes#}
{#        document.querySelectorAll('input[type="checkbox"][name$="is_current"]').forEach(function(checkbox) {#}
{#            toggleEndDate(checkbox); // Set initial state#}
{#            checkbox.addEventListener('change', function() { toggleEndDate(this); }); // Add listener#}
{#        });#}
{##}
{#        // Setup preview button listeners#}
{#        const openModalBtn = document.getElementById('open-preview-modal');#}
{#        if (openModalBtn) openModalBtn.addEventListener('click', openResumePreviewModal);#}
{##}
{#        const refreshBtn = document.getElementById('refresh-preview');#}
{#        if (refreshBtn) refreshBtn.addEventListener('click', refreshResumePreview);#}
{#    });#}
{##}
{#    // --- Dynamic Form Row Functions ---#}
{#    // Keep ONLY if used by child templates (Experience, Skills, etc.)#}
{#    // Ensure HTMX is loaded via base_authenticated.html if these are used.#}
{#    // Ensure CSS classes like .form-row, .field-wrapper exist if selectors rely on them.#}
{#    // Ensure URLs like '/resumes/htmx/add-form-row/' are correctly configured.#}
{##}
{#    /*#}
{#    function addFormRow(formType, containerId, countFieldId) { ... }#}
{#    function removeFormRow(button, containerId, countFieldId) { ... }#}
{#    function updateFormRowIndex(row, newIndex) { ... }#}
{#    function addBulletPoint(button, parentType, parentIndex) { ... }#}
{#    */#}
{##}
{#</script>#}
{##}
{# Keep specific styles if needed, e.g., animations #}
{#<style>#}
{#    .highlight-new { animation: highlight-pulse 1.0s ease-out; }#}
{#    @keyframes highlight-pulse { 0%, 100% { background-color: transparent; } 50% { background-color: rgba(96, 165, 250, 0.15); } } /* blue-300 based */#}
{##}
{#    .fade-out { opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0; margin-top: 0; margin-bottom: 0; overflow: hidden; transition: all 0.3s ease-out; }#}
{#</style>#}
{#{% endblock %}#}
{##}
{#{% extends 'base_authenticated.html' %}#}
{#{% load resume_extras %}#}
{#{% load static %}#}
{#{% load widget_tweaks %}#}
{#{% block title %}Resume Builder - Step {{ step }} of {{ total_steps }}{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container mx-auto px-4 py-10">#}
{#    <!-- Progress indicator -->#}
{#    <div class="mb-10">#}
{#        <div class="flex justify-between items-center mb-2">#}
{#            <h2 class="text-2xl font-bold text-gray-800">Create Your Professional Resume</h2>#}
{#            <span class="text-sm text-white-500 dark:text-white-400">Step {{ step }} of {{ total_steps }}</span>#}
{#        </div>#}
{##}
{#        <!-- Progress bar -->#}
{#        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">#}
{#            <div class="bg-blue-700 h-2.5 rounded-full transition-all duration-500 ease-in-out" style="width: {{ step|floatformat:0|mul:100|div:total_steps }}%"></div>#}
{#        </div>#}
{##}
{#        <!-- Step navigation -->#}
{#        <div class="grid grid-cols-{{ total_steps }} gap-1 text-xs text-center">#}
{#            {% for i in total_steps|get_range %}#}
{#                <div class="flex flex-col items-center">#}
{#                    {% if i < step %}#}
{#                        <a href="{% url 'job_portal:resume_wizard' step=i %}" class="group text-center relative" title="Click to go back to step {{ i }}">#}
{#                            <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center mb-1 group-hover:bg-blue-500 transition-colors duration-200">#}
{#                                <span class="text-white">{{ i }}</span>#}
{#                            </div>#}
{#                            <span class="text-white-500 group-hover:text-blue-500 transition-colors duration-200 text-center w-full block">#}
{#                                {% if i == 1 %}Personal#}
{#                                {% elif i == 2 %}Summary#}
{#                                {% elif i == 3 %}Skills#}
{#                                {% elif i == 4 %}Experience#}
{#                                {% elif i == 5 %}Education#}
{#                                {% elif i == 6 %}Projects#}
{#                                {% elif i == 7 %}Certifications#}
{#                                {% elif i == 8 %}Languages#}
{#                                {% elif i == 9 %}Additional#}
{#                                {% endif %}#}
{#                            </span>#}
{#                            <div class="absolute opacity-0 group-hover:opacity-100 bg-blue-600 text-white text-xs rounded py-1 px-2 pointer-events-none transition-opacity duration-200 -translate-y-1 w-32 left-1/2 transform -translate-x-1/2 mt-1 z-10">#}
{#                                Return to this step#}
{#                            </div>#}
{#                        </a>#}
{#                    {% elif i == step %}#}
{#                        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center mb-1">#}
{#                            <span class="text-white">{{ i }}</span>#}
{#                        </div>#}
{#                        <span class="text-white-800 font-medium text-center w-full block">#}
{#                            {% if i == 1 %}Personal#}
{#                            {% elif i == 2 %}Summary#}
{#                            {% elif i == 3 %}Skills#}
{#                            {% elif i == 4 %}Experience#}
{#                            {% elif i == 5 %}Education#}
{#                            {% elif i == 6 %}Projects#}
{#                            {% elif i == 7 %}Certifications#}
{#                            {% elif i == 8 %}Languages#}
{#                            {% elif i == 9 %}Additional#}
{#                            {% endif %}#}
{#                        </span>#}
{#                    {% else %}#}
{#                        <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mb-1">#}
{#                            <span class="text-white">{{ i }}</span>#}
{#                        </div>#}
{#                        <span class="text-white-500 dark:text-white-800 text-center w-full block">#}
{#                            {% if i == 1 %}Personal#}
{#                            {% elif i == 2 %}Summary#}
{#                            {% elif i == 3 %}Skills#}
{#                            {% elif i == 4 %}Experience#}
{#                            {% elif i == 5 %}Education#}
{#                            {% elif i == 6 %}Projects#}
{#                            {% elif i == 7 %}Certifications#}
{#                            {% elif i == 8 %}Languages#}
{#                            {% elif i == 9 %}Additional#}
{#                            {% endif %}#}
{#                        </span>#}
{#                    {% endif %}#}
{#                </div>#}
{#            {% endfor %}#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Current Step Content -->#}
{#    <div class="card bg-base-100 shadow-xl rounded-xl border border-gray-100 dark:border-gray-700 overflow-hidden">#}
{#        <div class="card-body p-8">#}
{#            <h2 class="card-title text-xl md:text-2xl mb-6 pb-4 border-b border-gray-100 dark:border-gray-700">#}
{#                {% block step_icon %}#}
{#                    {% if step == 1 %}<i class="fa-solid fa-user-circle mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 2 %}<i class="fa-solid fa-briefcase mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 3 %}<i class="fa-solid fa-graduation-cap mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 4 %}<i class="fa-solid fa-code mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 5 %}<i class="fa-solid fa-diagram-project mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 6 %}<i class="fa-solid fa-certificate mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 7 %}<i class="fa-solid fa-language mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 8 %}<i class="fa-solid fa-puzzle-piece mr-3 text-primary opacity-80"></i>#}
{#                    {% elif step == 9 %}<i class="fa-solid fa-file-circle-plus mr-3 text-primary opacity-80"></i>#}
{#                    {% else %}<i class="fa-solid fa-clipboard-list mr-3 text-primary opacity-80"></i>#}
{#                    {% endif %}#}
{#                {% endblock %}#}
{#                {% block step_title %}{% endblock %}#}
{#            </h2>#}
{##}
{#            <!-- Step Content -->#}
{#            <div class="space-y-6">#}
{#                {% block step_content %}{% endblock %}#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Preview Button -->#}
{#    <div class="mt-10 text-center">#}
{#        <button id="open-preview-modal" type="button" class="btn btn-primary">#}
{#            <i class="fa-solid fa-eye mr-2"></i> Preview Your Resume#}
{#        </button>#}
{#    </div>#}
{##}
{#    <!-- Resume Preview Modal -->#}
{#    <div id="resumePreviewModal" class="modal">#}
{#        <div class="modal-box w-11/12 max-w-5xl p-0 overflow-hidden rounded-xl">#}
{#            <div class="bg-primary p-4 text-white flex justify-between items-center">#}
{#                <h3 class="font-bold text-lg flex items-center">#}
{#                    <i class="fa-solid fa-file-alt mr-2"></i>#}
{#                    <span>Resume Preview</span>#}
{#                </h3>#}
{#                <button class="btn btn-sm btn-circle btn-ghost text-white" onclick="closeResumePreviewModal()">#}
{#                    <i class="fa-solid fa-times"></i>#}
{#                </button>#}
{#            </div>#}
{##}
{#            <div id="resume-preview" class="h-[70vh] overflow-y-auto p-0 bg-white">#}
{#                <!-- Preview content will be loaded here -->#}
{#                <div class="flex flex-col justify-center items-center h-full text-gray-400">#}
{#                    <div class="w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4">#}
{#                        <i class="fa-solid fa-file-lines text-2xl"></i>#}
{#                    </div>#}
{#                    <p class="text-center max-w-md p-4">Your resume preview will update as you complete each section. Continue filling out the form to see your resume take shape.</p>#}
{#                    <button id="refresh-preview" class="btn btn-outline btn-primary btn-sm mt-4">#}
{#                        <i class="fa-solid fa-sync-alt mr-2"></i> Refresh Preview#}
{#                    </button>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="border-t border-gray-200 dark:border-gray-700 p-4 flex justify-end bg-base-100">#}
{#                <button class="btn btn-outline" onclick="closeResumePreviewModal()">#}
{#                    Close Preview#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{#        <div class="modal-backdrop bg-black/50" onclick="closeResumePreviewModal()"></div>#}
{#    </div>#}
{##}
{#    <!-- Navigation Buttons -->#}
{#    <div class="flex justify-between mt-8" >#}
{#        {% if step > 1 %}#}
{#        <a href="{% url 'job_portal:resume_wizard' step=step|add:'-1' %}" class="btn btn-primary" id="prev-step-btn">#}
{#            <i class="fa-solid fa-chevron-left mr-2 "></i> Previous Step#}
{#        </a>#}
{#        {% else %}#}
{#        <div></div> <!-- Empty div to maintain spacing -->#}
{#        {% endif %}#}
{##}
{#        {% if step < total_steps %}#}
{#        <button type="submit" form="resume-form" class="btn btn-primary" id="next-step-btn">#}
{#            Save & Continue <i class="fa-solid fa-chevron-right ml-2"></i>#}
{#        </button>#}
{#        {% else %}#}
{#        <button type="submit" form="resume-form" class="btn btn-success" id="complete-resume-btn">#}
{#            <i class="fa-solid fa-check mr-2"></i> Complete Resume#}
{#        </button>#}
{#        {% endif %}#}
{#    </div>#}
{#</div>#}
{#{% endblock %}#}
{##}
{#{% block extra_js %}#}
{#<!-- HTMX for dynamic form handling -->#}
{#<script src="https://unpkg.com/htmx.org@1.9.0"></script>#}
{##}
{#<script>#}
{#    // Function to toggle end date based on "is current" checkbox#}
{#    function toggleEndDate(checkbox) {#}
{#        const row = checkbox.closest('.form-row');#}
{#        const endDateField = row.querySelector('[name$="end_date"]');#}
{#        const endDateContainer = row.querySelector('.end-date-container');#}
{##}
{#        if (checkbox.checked) {#}
{#            endDateField.disabled = true;#}
{#            endDateField.value = '';#}
{#            if (endDateContainer) {#}
{#                endDateContainer.classList.add('opacity-50');#}
{#            }#}
{#        } else {#}
{#            endDateField.disabled = false;#}
{#            if (endDateContainer) {#}
{#                endDateContainer.classList.remove('opacity-50');#}
{#            }#}
{#        }#}
{#    }#}
{##}
{#    // Initialize "is current" checkboxes on page load#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#        // Initialize checkboxes#}
{#        document.querySelectorAll('input[type="checkbox"][name$="is_current"]').forEach(function(checkbox) {#}
{#            toggleEndDate(checkbox);#}
{#        });#}
{##}
{#        // Add animation class after page load#}
{#        setTimeout(() => {#}
{#            const progressBar = document.querySelector('.progress-bar');#}
{#            if (progressBar) {#}
{#                progressBar.classList.add('animate-progress');#}
{#            }#}
{#        }, 300);#}
{##}
{#        // Setup open modal button#}
{#        const openModalBtn = document.getElementById('open-preview-modal');#}
{#        if (openModalBtn) {#}
{#            openModalBtn.addEventListener('click', openResumePreviewModal);#}
{#        }#}
{##}
{#        // Setup refresh button#}
{#        const refreshBtn = document.getElementById('refresh-preview');#}
{#        if (refreshBtn) {#}
{#            refreshBtn.addEventListener('click', refreshResumePreview);#}
{#        }#}
{##}
{#        // Ensure the Previous Step button causes a full page reload#}
{#        const prevStepBtn = document.getElementById('prev-step-btn');#}
{#        if (prevStepBtn) {#}
{#            prevStepBtn.addEventListener('click', function(e) {#}
{#                e.preventDefault();#}
{#                const href = this.getAttribute('href');#}
{#                window.location.href = href;#}
{#            });#}
{#        }#}
{##}
{#        // Ensure the resume form submission causes a full page reload#}
{#        const resumeForm = document.getElementById('resume-form');#}
{#        if (resumeForm) {#}
{#            // We need to ensure HTMX doesn't interfere with form submission#}
{#            resumeForm.setAttribute('hx-boost', 'false');#}
{##}
{#            // For the next/save button, let's add a direct handler#}
{#            const nextButton = document.getElementById('next-step-btn');#}
{#            if (nextButton) {#}
{#                nextButton.addEventListener('click', function(e) {#}
{#                    // Prevent the default button behavior#}
{#                    e.preventDefault();#}
{##}
{#                    // Disable any HTMX features#}
{#                    if (typeof htmx !== 'undefined') {#}
{#                        htmx.config.globalViewTransitions = false;#}
{#                        resumeForm.setAttribute('hx-boost', 'false');#}
{#                        resumeForm.setAttribute('data-no-ajax', 'true');#}
{#                    }#}
{##}
{#                    // Ensure form is submitted with page reload#}
{#                    resumeForm.setAttribute('onsubmit', '');#}
{##}
{#                    // Submit the form to cause a full page reload#}
{#                    resumeForm.submit();#}
{#                });#}
{#            }#}
{##}
{#            // Handle the complete resume button similarly#}
{#            const completeButton = document.getElementById('complete-resume-btn');#}
{#            if (completeButton) {#}
{#                completeButton.addEventListener('click', function(e) {#}
{#                    e.preventDefault();#}
{##}
{#                    if (typeof htmx !== 'undefined') {#}
{#                        htmx.config.globalViewTransitions = false;#}
{#                        resumeForm.setAttribute('hx-boost', 'false');#}
{#                        resumeForm.setAttribute('data-no-ajax', 'true');#}
{#                    }#}
{##}
{#                    resumeForm.setAttribute('onsubmit', '');#}
{#                    resumeForm.submit();#}
{#                });#}
{#            }#}
{#        }#}
{#    });#}
{##}
{#    // Function to open the preview modal#}
{#    function openResumePreviewModal() {#}
{#        const modal = document.getElementById('resumePreviewModal');#}
{#        if (modal) {#}
{#            modal.classList.add('modal-open');#}
{#            document.body.style.overflow = 'hidden';#}
{#            // Load preview content#}
{#            refreshResumePreview();#}
{#        }#}
{#    }#}
{##}
{#    // Function to close the preview modal#}
{#    function closeResumePreviewModal() {#}
{#        const modal = document.getElementById('resumePreviewModal');#}
{#        if (modal) {#}
{#            modal.classList.remove('modal-open');#}
{#            document.body.style.overflow = 'auto';#}
{#        }#}
{#    }#}
{##}
{#    // Function to refresh resume preview#}
{#    function refreshResumePreview() {#}
{#        const previewContainer = document.getElementById('resume-preview');#}
{#        if (previewContainer) {#}
{#            // Show loading spinner#}
{#            previewContainer.innerHTML = `#}
{#                <div class="flex flex-col items-center justify-center h-full">#}
{#                    <span class="loading loading-spinner loading-lg text-primary mb-4"></span>#}
{#                    <p>Generating preview...</p>#}
{#                </div>#}
{#            `;#}
{##}
{#            // Get form data#}
{#            const form = document.getElementById('resume-form');#}
{#            let formData = new FormData();#}
{##}
{#            if (form) {#}
{#                formData = new FormData(form);#}
{#            }#}
{##}
{#            // Add all form fields to formData#}
{#            const allInputs = document.querySelectorAll('input, select, textarea');#}
{#            allInputs.forEach(input => {#}
{#                if (input.name && !formData.has(input.name)) {#}
{#                    if (input.type === 'checkbox') {#}
{#                        formData.append(input.name, input.checked ? 'on' : '');#}
{#                    } else if (input.type !== 'file' || input.files.length > 0) {#}
{#                        formData.append(input.name, input.value);#}
{#                    }#}
{#                }#}
{#            });#}
{##}
{#            // Process dynamic form data like experiences, education, skills, etc.#}
{#            try {#}
{#                // Process skill fields#}
{#                const skillRows = document.querySelectorAll('#skills-container .form-row');#}
{#                if (skillRows.length > 0) {#}
{#                    formData.append('skill_count', skillRows.length);#}
{#                }#}
{##}
{#                // Process experience fields#}
{#                const expRows = document.querySelectorAll('#experience-container .form-row');#}
{#                if (expRows.length > 0) {#}
{#                    formData.append('experience_count', expRows.length);#}
{#                    expRows.forEach((row, index) => {#}
{#                        // Process bullet points for each experience#}
{#                        const bulletRows = row.querySelectorAll('.bullet-point-row');#}
{#                        if (bulletRows.length > 0) {#}
{#                            formData.append(`bullet_count_${index}`, bulletRows.length);#}
{#                        }#}
{#                    });#}
{#                }#}
{##}
{#                // Process education fields#}
{#                const eduRows = document.querySelectorAll('#education-container .form-row');#}
{#                if (eduRows.length > 0) {#}
{#                    formData.append('education_count', eduRows.length);#}
{#                }#}
{##}
{#                // Process project fields#}
{#                const projRows = document.querySelectorAll('#projects-container .form-row');#}
{#                if (projRows.length > 0) {#}
{#                    formData.append('projects_count', projRows.length);#}
{#                    projRows.forEach((row, index) => {#}
{#                        // Process bullet points for each project#}
{#                        const bulletRows = row.querySelectorAll('.bullet-point-row');#}
{#                        if (bulletRows.length > 0) {#}
{#                            formData.append(`project_${index}_bullet_count`, bulletRows.length);#}
{#                        }#}
{#                    });#}
{#                }#}
{#            } catch (e) {#}
{#                console.error("Error preparing form data:", e);#}
{#            }#}
{##}
{#            // Fetch the preview from our endpoint#}
{#            fetch("{% url 'job_portal:preview_current_resume' %}", {#}
{#                method: 'POST',#}
{#                body: formData,#}
{#                headers: {#}
{#                    'X-Requested-With': 'XMLHttpRequest',#}
{#                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''#}
{#                }#}
{#            })#}
{#            .then(response => {#}
{#                if (!response.ok) {#}
{#                    throw new Error(`HTTP error! Status: ${response.status}`);#}
{#                }#}
{#                return response.text();#}
{#            })#}
{#            .then(html => {#}
{#                previewContainer.innerHTML = `<div class="p-4">${html}</div>`;#}
{#            })#}
{#            .catch(error => {#}
{#                console.error("Preview error:", error);#}
{#                previewContainer.innerHTML = `#}
{#                    <div class="flex flex-col items-center justify-center h-full p-8">#}
{#                        <p class="text-red-500 mb-2">Failed to load preview: ${error.message}</p>#}
{#                        <button class="btn btn-sm btn-outline btn-primary mt-4" onclick="refreshResumePreview()">#}
{#                            <i class="fa-solid fa-sync-alt mr-2"></i> Try Again#}
{#                        </button>#}
{#                    </div>#}
{#                `;#}
{#            });#}
{#        }#}
{#    }#}
{##}
{#    // Function to add a new form row#}
{#    function addFormRow(formType, container, countField) {#}
{#        const rows = document.querySelectorAll(`#${container} .form-row`);#}
{#        const index = rows.length;#}
{##}
{#        // Update the count field#}
{#        document.getElementById(countField).value = index + 1;#}
{##}
{#        // Show loading indicator#}
{#        const addButton = document.querySelector(`button[onclick="addFormRow('${formType}', '${container}', '${countField}')"]`);#}
{#        if (addButton) {#}
{#            const originalHTML = addButton.innerHTML;#}
{#            addButton.innerHTML = `<span class="loading loading-spinner loading-xs"></span> Adding...`;#}
{#            addButton.disabled = true;#}
{##}
{#            // Make HTMX request to add a new row#}
{#            htmx.ajax('GET', `/resumes/htmx/add-form-row/?form_type=${formType}&index=${index}`, {#}
{#                target: `#${container}`,#}
{#                swap: 'beforeend',#}
{#                complete: function() {#}
{#                    // Restore button#}
{#                    addButton.innerHTML = originalHTML;#}
{#                    addButton.disabled = false;#}
{##}
{#                    // Scroll to the new row with smooth animation#}
{#                    const newRow = document.querySelector(`#${container} .form-row:last-child`);#}
{#                    if (newRow) {#}
{#                        newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });#}
{#                        newRow.classList.add('highlight-new');#}
{#                        setTimeout(() => {#}
{#                            newRow.classList.remove('highlight-new');#}
{#                        }, 1500);#}
{#                    }#}
{#                }#}
{#            });#}
{#        }#}
{#    }#}
{##}
{#    // Function to remove a form row#}
{#    function removeFormRow(button, container, countField) {#}
{#        const row = button.closest('.form-row');#}
{##}
{#        // Add fade-out animation#}
{#        row.classList.add('fade-out');#}
{##}
{#        // Remove after animation completes#}
{#        setTimeout(() => {#}
{#            row.remove();#}
{##}
{#            // Update indexes of remaining rows#}
{#            const rows = document.querySelectorAll(`#${container} .form-row`);#}
{#            document.getElementById(countField).value = rows.length;#}
{##}
{#            // Update the indexes in the form fields#}
{#            rows.forEach((row, index) => {#}
{#                updateFormRowIndex(row, index);#}
{#            });#}
{#        }, 300);#}
{#    }#}
{##}
{#    // Function to update form field indexes#}
{#    function updateFormRowIndex(row, newIndex) {#}
{#        row.querySelectorAll('input, select, textarea').forEach(field => {#}
{#            const name = field.getAttribute('name');#}
{#            if (name) {#}
{#                // Extract the field name pattern (e.g., skill_name_X)#}
{#                const pattern = name.replace(/\_\d+($|\_)/, '_INDEX$1');#}
{#                // Replace INDEX with the new index#}
{#                const newName = pattern.replace('INDEX', newIndex);#}
{#                field.setAttribute('name', newName);#}
{##}
{#                // Also update id if present#}
{#                const id = field.getAttribute('id');#}
{#                if (id) {#}
{#                    const idPattern = id.replace(/\_\d+($|\_)/, '_INDEX$1');#}
{#                    const newId = idPattern.replace('INDEX', newIndex);#}
{#                    field.setAttribute('id', newId);#}
{#                }#}
{##}
{#                // Update for labels#}
{#                const labels = row.querySelectorAll(`label[for="${id}"]`);#}
{#                labels.forEach(label => {#}
{#                    label.setAttribute('for', newId);#}
{#                });#}
{#            }#}
{#        });#}
{#    }#}
{##}
{#    // Function to add a bullet point to an experience or project#}
{#    function addBulletPoint(button, parentType, parentIndex) {#}
{#        const bulletContainer = button.closest('.bullet-points-container').querySelector('.bullet-points');#}
{#        const bulletCount = bulletContainer.querySelectorAll('.bullet-point-row').length;#}
{##}
{#        // Show loading indicator#}
{#        const originalHTML = button.innerHTML;#}
{#        button.innerHTML = `<span class="loading loading-spinner loading-xs"></span>`;#}
{#        button.disabled = true;#}
{##}
{#        htmx.ajax('GET', `/resumes/htmx/add-form-row/?form_type=bullet_point&parent_index=${parentIndex}&index=${bulletCount}`, {#}
{#            target: bulletContainer,#}
{#            swap: 'beforeend',#}
{#            complete: function() {#}
{#                // Restore button#}
{#                button.innerHTML = originalHTML;#}
{#                button.disabled = false;#}
{##}
{#                // Scroll to new bullet point#}
{#                const newBullet = bulletContainer.querySelector('.bullet-point-row:last-child');#}
{#                if (newBullet) {#}
{#                    newBullet.scrollIntoView({ behavior: 'smooth', block: 'center' });#}
{#                    newBullet.classList.add('highlight-new');#}
{#                    setTimeout(() => {#}
{#                        newBullet.classList.remove('highlight-new');#}
{#                    }, 1500);#}
{#                }#}
{#            }#}
{#        });#}
{##}
{#        // Update hidden count field#}
{#        const countField = button.closest('.form-row').querySelector(`input[name="${parentType}_${parentIndex}_bullet_count"]`);#}
{#        countField.value = parseInt(countField.value) + 1;#}
{#    }#}
{#</script>#}
{##}
{#<style>#}
{#    /* Highlight animation for new elements */#}
{#    .highlight-new {#}
{#        animation: highlight-pulse 1.5s ease-in-out;#}
{#    }#}
{##}
{#    @keyframes highlight-pulse {#}
{#        0% { background-color: rgba(59, 130, 246, 0.1); }#}
{#        50% { background-color: rgba(59, 130, 246, 0.2); }#}
{#        100% { background-color: transparent; }#}
{#    }#}
{##}
{#    /* Fade out animation for removed elements */#}
{#    .fade-out {#}
{#        opacity: 0;#}
{#        transform: translateY(-10px);#}
{#        transition: opacity 0.3s ease, transform 0.3s ease;#}
{#    }#}
{##}
{#    /* Progress bar animation */#}
{#    .animate-progress {#}
{#        transition: width 1s ease-in-out;#}
{#    }#}
{##}
{#    /* Responsive grid for step indicators */#}
{#    @media screen and (max-width: 1024px) {#}
{#        .grid-cols-{{ total_steps }} {#}
{#            grid-template-columns: repeat(5, 1fr);#}
{#        }#}
{#    }#}
{##}
{#    @media screen and (max-width: 768px) {#}
{#        .grid-cols-{{ total_steps }} {#}
{#            grid-template-columns: repeat(3, 1fr);#}
{#        }#}
{#    }#}
{##}
{#    @media screen and (max-width: 640px) {#}
{#        .grid-cols-{{ total_steps }} {#}
{#            grid-template-columns: repeat(2, 1fr);#}
{#        }#}
{#    }#}
{##}
{#    /* Hide scrollbar for clean UI */#}
{#    .no-scrollbar::-webkit-scrollbar {#}
{#        display: none;#}
{#    }#}
{##}
{#    .no-scrollbar {#}
{#        -ms-overflow-style: none;#}
{#        scrollbar-width: none;#}
{#    }#}
{#</style>#}
{#{% endblock %}#}