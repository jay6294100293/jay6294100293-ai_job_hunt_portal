{% extends 'resumes/wizard_base.html' %}
{% load static %}

{% block step_title %}Work Experience{% endblock %}

{% block step_icon %}<i class="fa-solid fa-briefcase mr-3 text-primary opacity-80"></i>{% endblock %}

{% block step_content %}
<form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}" hx-boost="true">
    {% csrf_token %}

    <!-- Two Column Layout -->
    <div class="flex flex-col md:flex-row gap-6">
        <!-- Left Column: Experience Form -->
        <div class="w-full md:w-2/3">
            <!-- Hidden field to track number of experience entries -->
            <input type="hidden" id="experience_count" name="experience_count" value="{{ experiences|length }}">

            <!-- Experiences container -->
            <div id="experiences_container" class="space-y-6">
                {% for experience in experiences %}
                <div class="form-row bg-base-100 border border-gray-100 dark:border-gray-700 rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl experience-entry" data-index="{{ forloop.counter0 }}">
                    <!-- Header with Title and Status -->
                    <div class="flex justify-between items-center mb-5 pb-3 border-b border-gray-100 dark:border-gray-700">
                        <h3 class="text-lg font-medium flex items-center">
                            <span class="w-9 h-9 rounded-full bg-primary/15 flex items-center justify-center mr-3 shadow-sm">
                                <i class="fa-solid fa-briefcase text-primary text-sm"></i>
                            </span>
                            <span class="text-gray-800 dark:text-gray-800">Experience #<span class="experience-number font-semibold">{{ forloop.counter }}</span></span>
                        </h3>

                        <div class="flex items-center gap-3">
                            <div class="tooltip tooltip-left" data-tip="Required fields status">
                                <div class="experience-status w-3 h-3 rounded-full bg-error shadow-sm"></div>
                            </div>
                            <!-- Remove Experience Button -->
                            <button type="button" class="btn btn-ghost btn-sm text-error hover:bg-error/10"
                                    onclick="removeExperience(this, '{{ forloop.counter0 }}')">
                                <i class="fa-solid fa-trash-can mr-1"></i> Remove
                            </button>
                        </div>
                    </div>

                    <!-- Basic Information Section -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <!-- Job Title -->
                        <div class="form-control">
                            <label class="label" for="job_title_{{ forloop.counter0 }}">
                                <span class="label-text font-medium">Job Title</span>
                                <span class="label-text-alt text-error">*</span>
                            </label>
                            <div class="relative group">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fa-solid fa-id-badge text-gray-400 group-focus-within:text-primary transition-colors"></i>
                                </div>
                                <input type="text" id="job_title_{{ forloop.counter0 }}" name="job_title_{{ forloop.counter0 }}"
                                    class="input input-bordered w-full pl-10 focus:border-primary focus:ring-1 focus:ring-primary"
                                    value="{{ experience.job_title }}" required
                                    placeholder="e.g., Senior Software Engineer"
                                    oninput="updateExperienceStatus('{{ forloop.counter0 }}')">
                                <div id="job_title_spinner_{{ forloop.counter0 }}" class="htmx-indicator absolute right-3 top-1/2 transform -translate-y-1/2">
                                    <span class="loading loading-spinner loading-xs"></span>
                                </div>
                            </div>
                            <div id="job_title_suggestions_{{ forloop.counter0 }}" class="text-xs mt-1 flex flex-wrap gap-1"></div>
                        </div>

                        <!-- Employer -->
                        <div class="form-control">
                            <label class="label" for="employer_{{ forloop.counter0 }}">
                                <span class="label-text font-medium">Employer/Company</span>
                                <span class="label-text-alt text-error">*</span>
                            </label>
                            <div class="relative group">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fa-solid fa-building text-gray-400 group-focus-within:text-primary transition-colors"></i>
                                </div>
                                <input type="text" id="employer_{{ forloop.counter0 }}" name="employer_{{ forloop.counter0 }}"
                                    class="input input-bordered w-full pl-10 focus:border-primary focus:ring-1 focus:ring-primary"
                                    value="{{ experience.employer }}" required
                                    placeholder="e.g., Google, Microsoft"
                                    oninput="updateExperienceStatus('{{ forloop.counter0 }}')">
                                <div id="employer_spinner_{{ forloop.counter0 }}" class="htmx-indicator absolute right-3 top-1/2 transform -translate-y-1/2">
                                    <span class="loading loading-spinner loading-xs"></span>
                                </div>
                            </div>
                            <div id="employer_suggestions_{{ forloop.counter0 }}" class="text-xs mt-1 flex flex-wrap gap-1"></div>
                        </div>
                    </div>

                    <!-- Details Section -->
                    <div class="mt-6 p-4 rounded-lg border border-gray-100 dark:border-gray-700">
                        <!-- Location and Employment Type -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div class="form-control">
                                <label class="label" for="location_{{ forloop.counter0 }}">
                                    <span class="label-text font-medium">Location</span>
                                    <span class="label-text-alt text-error">*</span>
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fa-solid fa-map-marker-alt text-gray-400 group-focus-within:text-primary transition-colors"></i>
                                    </div>
                                    <input type="text" id="location_{{ forloop.counter0 }}" name="location_{{ forloop.counter0 }}"
                                        class="input input-bordered w-full pl-10 focus:border-primary focus:ring-1 focus:ring-primary"
                                        value="{{ experience.location }}"
                                        placeholder="San Francisco, CA or Remote" required
                                        oninput="updateExperienceStatus('{{ forloop.counter0 }}')">
                                    <div class="flex mt-1 items-center">
                                        <input type="checkbox" id="is_remote_{{ forloop.counter0 }}" name="is_remote_{{ forloop.counter0 }}"
                                            class="checkbox checkbox-xs checkbox-primary mr-2"
                                            {% if experience.is_remote %}checked{% endif %}
                                            onchange="toggleRemoteLocation('{{ forloop.counter0 }}')">
                                        <label for="is_remote_{{ forloop.counter0 }}" class="text-xs cursor-pointer">This was a remote position</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-control">
                                <label class="label" for="employment_type_{{ forloop.counter0 }}">
                                    <span class="label-text font-medium">Employment Type</span>
                                    <span class="label-text-alt text-gray-500">(Optional)</span>
                                </label>
                                <select id="employment_type_{{ forloop.counter0 }}" name="employment_type_{{ forloop.counter0 }}"
                                    class="select select-bordered w-full focus:border-primary">
                                    <option value="" {% if not experience.employment_type %}selected{% endif %}>Select employment type</option>
                                    <option value="Full-time" {% if experience.employment_type == "Full-time" %}selected{% endif %}>Full-time</option>
                                    <option value="Part-time" {% if experience.employment_type == "Part-time" %}selected{% endif %}>Part-time</option>
                                    <option value="Contract" {% if experience.employment_type == "Contract" %}selected{% endif %}>Contract</option>
                                    <option value="Internship" {% if experience.employment_type == "Internship" %}selected{% endif %}>Internship</option>
                                    <option value="Freelance" {% if experience.employment_type == "Freelance" %}selected{% endif %}>Freelance</option>
                                    <option value="Volunteer" {% if experience.employment_type == "Volunteer" %}selected{% endif %}>Volunteer</option>
                                </select>
                            </div>
                        </div>

                        <!-- Date Range -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">
                            <!-- Start Date -->
                            <div class="form-control">
                                <label class="label" for="start_date_{{ forloop.counter0 }}">
                                    <span class="label-text font-medium">Start Date</span>
                                    <span class="label-text-alt text-error">*</span>
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fa-solid fa-calendar-alt text-gray-400 group-focus-within:text-primary transition-colors"></i>
                                    </div>
                                    <input type="date" id="start_date_{{ forloop.counter0 }}" name="start_date_{{ forloop.counter0 }}"
                                        class="input input-bordered w-full pl-10 focus:border-primary focus:ring-1 focus:ring-primary"
                                        value="{{ experience.start_date|date:'Y-m-d' }}" required
                                        onchange="validateDates('{{ forloop.counter0 }}'); updateExperienceStatus('{{ forloop.counter0 }}')">
                                </div>
                                <div id="date_validation_{{ forloop.counter0 }}" class="text-xs mt-1 text-error"></div>
                            </div>

                            <!-- End Date / Current -->
                            <div class="form-control end-date-container">
                                <label class="label" for="end_date_{{ forloop.counter0 }}">
                                    <span class="label-text font-medium">End Date</span>
                                    <span class="label-text-alt text-gray-500">(Leave blank if current)</span>
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fa-solid fa-calendar-check text-gray-400 group-focus-within:text-primary transition-colors"></i>
                                    </div>
                                    <input type="date" id="end_date_{{ forloop.counter0 }}" name="end_date_{{ forloop.counter0 }}"
                                        class="input input-bordered w-full pl-10 focus:border-primary focus:ring-1 focus:ring-primary"
                                        value="{{ experience.end_date|date:'Y-m-d' }}"
                                        {% if experience.is_current %}disabled{% endif %}
                                        onchange="validateDates('{{ forloop.counter0 }}')">
                                </div>

                                <div class="form-control mt-2">
                                    <label class="cursor-pointer label justify-start gap-3 py-1">
                                        <input type="checkbox" id="is_current_{{ forloop.counter0 }}" name="is_current_{{ forloop.counter0 }}"
                                            class="checkbox checkbox-primary checkbox-sm"
                                            {% if experience.is_current %}checked{% endif %}
                                            onchange="toggleEndDate(this)">
                                        <span class="label-text">I currently work here</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bullet Points Section (Updated) -->
                    <div class="mt-6 bullet-points-container">
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex items-center">
                                <i class="fa-solid fa-list-ul text-primary mr-2"></i>
                                <span class="font-medium text-gray-800 dark:text-gray-700">Responsibilities and Achievements</span>
                                <span class="text-error ml-1">*</span>
                            </div>

{#                            <button type="button"#}
{#                                    class="btn btn-xs btn-primary text-white shadow-sm"#}
{#                                    onclick="openBulletGenerationModal('{{ forloop.counter0 }}')">#}
{#                                <i class="fa-solid fa-magic mr-1"></i> AI Generate#}
{#                            </button>#}
                        </div>

                        <span id="bullet_ai_indicator_{{ forloop.counter0 }}" class="htmx-indicator text-sm text-gray-600">
                            <span class="loading loading-spinner loading-sm text-primary"></span> Generating bullet points...
                        </span>

                        <!-- Hidden field to track number of bullet points -->
                        <input type="hidden" name="bullet_count_{{ forloop.counter0 }}"
                               value="{{ experience.bullet_points|length }}" class="bullet-count" id="bullet_count_{{ forloop.counter0 }}">

                        <div class="bullet-points space-y-2 p-2 bg-gradient-to-b from-white to-gray-50 dark:from-gray-500/10 dark:to-gray-800/10 rounded-lg border border-gray-100 dark:border-gray-700 shadow-inner" id="bullet_points_container_{{ forloop.counter0 }}">
                            {% for bullet in experience.bullet_points %}
                            {% include 'resumes/partials/bullet_point_form_row.html' with parent_index=forloop.parentloop.counter0 index=forloop.counter0 bullet_text=bullet.description %}
                            {% empty %}
                            <!-- Default bullet point if none exist -->
                            {% include 'resumes/partials/bullet_point_form_row.html' with parent_index=forloop.parentloop.counter0 index=0 %}
                            {% endfor %}
                        </div>

                        <div class="flex justify-end mt-3">
                            <button type="button" class="btn btn-primary btn-sm hover:shadow-md"
                                    hx-get="{% url 'job_portal:htmx_add_form_row' %}?form_type=bullet_point&parent_index={{ forloop.counter0 }}"
                                    hx-target="#bullet_points_container_{{ forloop.counter0 }}"
                                    hx-swap="beforeend">
                                <i class="fa-solid fa-plus mr-2"></i> Add Bullet Point
                            </button>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <details class="mt-5 collapse collapse-arrow bg-gray-50/50 dark:bg-gray-800/10 rounded-lg border border-gray-100 dark:border-gray-700">
                        <summary class="collapse-title font-medium text-gray-700 dark:text-gray-700">
                            Display Settings
                        </summary>
                        <div class="collapse-content">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Visibility</span>
                                    </label>
                                    <div class="flex items-center space-x-2">
                                        <input type="checkbox" id="is_visible_{{ forloop.counter0 }}" name="is_visible_{{ forloop.counter0 }}"
                                            class="toggle toggle-primary"
                                            {% if experience.is_visible|default:True %}checked{% endif %}>
                                        <label for="is_visible_{{ forloop.counter0 }}" class="text-sm cursor-pointer">
                                            Show this experience on resume
                                        </label>
                                    </div>
                                </div>

                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Display Order</span>
                                    </label>
                                    <div class="flex items-center space-x-2">
                                        <input type="number" id="display_order_{{ forloop.counter0 }}" name="display_order_{{ forloop.counter0 }}"
                                            class="input input-bordered w-20 focus:border-primary"
                                            value="{{ experience.display_order|default:forloop.counter0 }}" min="1">
                                        <span class="text-sm">Order in resume (lower numbers appear first)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- Hidden fields for Django form handling -->
                    <input type="hidden" name="experience_ids" value="{{ experience.id|default:'new' }}">
                </div>
                {% empty %}
                <!-- Empty state when no experiences are added yet -->
                <div class="bg-base-100 border border-gray-100 dark:border-gray-700 rounded-xl shadow p-8 text-center">
                    <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-briefcase text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">No Work Experience Added Yet</h3>
                    <p class="text-gray-500 max-w-md mx-auto mb-6">
                        Your work experience is one of the most important parts of your resume. Add your professional history to showcase your skills and accomplishments.
                    </p>
                    <button type="button" class="btn btn-primary"
                            onclick="addNewExperience()">
                        <i class="fa-solid fa-plus mr-2"></i> Add Your First Experience
                    </button>
                </div>
                {% endfor %}
            </div>

            <!-- Add Experience Button - Only shown if at least one experience exists -->
            {% if experiences %}
            <div class="flex justify-center mt-6" id="add-another-container">
                <button type="button" class="btn btn-primary add-another-btn"
                        onclick="addNewExperience()">
                    <i class="fa-solid fa-plus mr-2"></i> Add Another Experience
                </button>
            </div>
            {% endif %}
        </div>

        <!-- Right Column: Tips and Action Verbs -->
        <div class="w-full md:w-1/3 space-y-6">
            <!-- Tips Box -->
            <div class="bg-primary/5 border border-primary/10 rounded-lg p-4">
                <div class="flex items-start">
                    <div class="text-primary text-xl mr-4 mt-1">
                        <i class="fa-solid fa-lightbulb"></i>
                    </div>
                    <div>
                        <p class="text-base font-medium">Work Experience Tips</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">
                            <strong>Tips:</strong> Start with your most recent position. Use action verbs and quantify your achievements with specific numbers (e.g., "Increased sales by 25%" rather than "Improved sales").
                        </p>
                    </div>
                </div>
            </div>

            <!-- Bullet Tips -->
            <div class="bg-gray-500 dark:bg-gray-900/10 border border-amber-100 dark:border-gray-700 p-3 rounded-lg text-sm">
                <div class="flex items-start gap-2">
                    <i class="fa-solid fa-pen-fancy text-gray-500 mt-1"></i>
                    <div>
                        <p class="font-medium text-gray-800 dark:text-gray-900">Tips for effective bullet points:</p>
                        <ul class="list-disc ml-4 mt-1 space-y-1 text-gray-700 dark:text-gray-400">
                            <li>Start with strong action verbs (Led, Created, Developed)</li>
                            <li>Quantify your achievements when possible (%, $, #)</li>
                            <li>Focus on results, not just responsibilities</li>
                            <li>Keep each bullet to 1-2 lines</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Action Verbs Box -->
            <div class="bg-base-100 border border-gray-100 dark:border-gray-700 rounded-lg p-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-medium text-lg flex items-center">
                        <i class="fa-solid fa-bolt text-primary mr-2"></i>
                        Action Verbs
                    </h3>
                    <div class="flex items-center">
                        <span class="text-sm mr-2">Filter:</span>
                        <select id="verb-category" class="select select-sm select-bordered" onchange="filterVerbs()">
                            <option value="all">All</option>
                            <option value="leadership">Leadership</option>
                            <option value="achievement">Achievement</option>
                            <option value="technical">Technical</option>
                            <option value="communication">Communication</option>
                            <option value="analysis">Analysis</option>
                        </select>
                    </div>
                </div>

                <div id="action-verbs-container" class="grid grid-cols-2 gap-1 text-sm dark:text-gray-900 text-center font-semibold">
                    <!-- Leadership Verbs -->
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Led</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Managed</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Coordinated</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Directed</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Established</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Supervised</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Oversaw</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="leadership" onclick="copyVerb(this)">Guided</div>

                    <!-- Achievement Verbs -->
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Achieved</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Improved</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Increased</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Reduced</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Generated</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Delivered</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Exceeded</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="achievement" onclick="copyVerb(this)">Accelerated</div>

                    <!-- Technical Verbs -->
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Developed</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Implemented</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Created</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Designed</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Built</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Engineered</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Optimized</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="technical" onclick="copyVerb(this)">Programmed</div>

                    <!-- Communication Verbs -->
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Presented</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Negotiated</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Communicated</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Authored</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Persuaded</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Facilitated</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Influenced</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="communication" onclick="copyVerb(this)">Collaborated</div>

                    <!-- Analysis Verbs -->
                   <!-- Analysis Verbs -->
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Analyzed</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Evaluated</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Researched</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Identified</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Examined</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Assessed</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Diagnosed</div>
                    <div class="p-1 bg-white rounded border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-primary/5 transition-colors" data-category="analysis" onclick="copyVerb(this)">Investigated</div>
                </div>
                <p class="text-xs text-gray-500 mt-3">Click any verb to copy it to your clipboard or insert into the current bullet point</p>
            </div>
        </div>
    </div>

    <!-- Navigation Buttons -->
{#    <div class="flex justify-between mt-8">#}
{#        {% if step > 1 %}#}
{#        <a href="{% url 'job_portal:resume_wizard' step=step|add:'-1' %}" class="btn btn-outline btn-primary">#}
{#            <i class="fa-solid fa-chevron-left mr-2"></i> Previous Step#}
{#        </a>#}
{#        {% else %}#}
{#        <div></div> <!-- Empty div to maintain spacing -->#}
{#        {% endif %}#}
{##}
{#        {% if step < total_steps %}#}
{#        <button type="submit" id="continue-button" form="resume-form" class="btn btn-primary">#}
{#            Save & Continue <i class="fa-solid fa-chevron-right ml-2"></i>#}
{#        </button>#}
{#        {% else %}#}
{#        <button type="submit" id="complete-button" form="resume-form" class="btn btn-success">#}
{#            <i class="fa-solid fa-check mr-2"></i> Complete Resume#}
{#        </button>#}
{#        {% endif %}#}
{#    </div>#}
</form>

<!-- Modals for AI Bullet Point Generation and Enhancement -->
{% include 'resumes/partials/bullet_generation_modal.html' %}
{% include 'resumes/partials/bullet_enhancement_modal.html' %}

<!-- Modals for AI Bullet Point Generation and Enhancement -->
{% include 'resumes/partials/bullet_generation_modal.html' %}
{% include 'resumes/partials/bullet_enhancement_modal.html' %}

<!-- Script for modal handling -->
<script>
    // AI Bullet Point Generation Modal Functions
    function openBulletGenerationModal(parentIndex) {
        // Get the current values
        const jobTitle = document.getElementById(`job_title_${parentIndex}`).value;
        const employer = document.getElementById(`employer_${parentIndex}`).value;

        // Set values in the modal
        document.getElementById('job_title_modal').value = jobTitle;
        document.getElementById('employer_modal').value = employer;

        // Set the parent index
        const form = document.getElementById('bullet-generation-form');
        const hiddenInput = form.querySelector('input[name="parent_index"]');
        hiddenInput.value = parentIndex;

        // Count existing bullet points to determine if we need to add more
        const container = document.getElementById(`bullet_points_container_${parentIndex}`);
        const existingBullets = container.querySelectorAll('.bullet-point-row');
        const existingCount = existingBullets.length;

        // Show the modal
        document.getElementById('bullet-generation-modal').classList.add('modal-open');
    }

    // AI Bullet Enhancement Modal Functions
    function openEnhanceModal(parentIndex, bulletIndex) {
        // Get the current bullet text
        const bulletId = `bullet_${parentIndex}_${bulletIndex}`;
        const bulletText = document.getElementById(bulletId).value;

        // Set values in the modal
        document.getElementById('original_bullet_modal').value = bulletText;
        document.getElementById('parent_index_modal').value = parentIndex;
        document.getElementById('bullet_index_modal').value = bulletIndex;

        // Clear previous enhancement result
        document.getElementById('enhanced_bullet_result').innerHTML = '';
        document.getElementById('apply_enhancement_btn').disabled = true;

        // Show/hide ATS job container based on enhancement type
        document.querySelectorAll('input[name="enhancement_type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const atsContainer = document.getElementById('ats_job_container');
                if (this.value === 'ats') {
                    atsContainer.classList.remove('hidden');
                } else {
                    atsContainer.classList.add('hidden');
                }
            });
        });

        // Show the modal
        document.getElementById('bullet-enhancement-modal').classList.add('modal-open');
    }

    // Apply enhanced text to the original bullet point
    function applyEnhancement() {
        const parentIndex = document.getElementById('parent_index_modal').value;
        const bulletIndex = document.getElementById('bullet_index_modal').value;
        const enhancedText = document.getElementById('enhanced_bullet_result').textContent;

        if (enhancedText) {
            // Update the original bullet point text
            const bulletId = `bullet_${parentIndex}_${bulletIndex}`;
            document.getElementById(bulletId).value = enhancedText;

            // Trigger quality check
            checkBulletQuality(document.getElementById(bulletId));

            // Close the modal
            closeModal('bullet-enhancement-modal');

            // Show success message
            showToast('success', 'Enhancement applied successfully!');
        }
    }

    // Function to close modals
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('modal-open');
    }
    // Function to check if we need to add more bullet point rows to accommodate generated content
    function ensureBulletPointCapacity(parentIndex, requiredCount) {
        const container = document.getElementById(`bullet_points_container_${parentIndex}`);
        const currentCount = container.querySelectorAll('.bullet-point-row').length;

        if (requiredCount > currentCount) {
            const neededRows = requiredCount - currentCount;
            for (let i = 0; i < neededRows; i++) {
                // Add a new bullet point row
                addBulletPoint(parentIndex);
            }
        }

        // Update the bullet count field
        const countField = document.getElementById(`bullet_count_${parentIndex}`);
        if (countField) {
            countField.value = Math.max(currentCount, requiredCount);
        }
    }

    // Add a new bullet point
    function addBulletPoint(parentIndex) {
        // Find the container
        const container = document.getElementById(`bullet_points_container_${parentIndex}`);
        if (!container) {
            console.error(`Could not find bullet points container for experience ${parentIndex}`);
            return;
        }

        // Get the current number of bullet points
        const bulletCount = container.querySelectorAll('.bullet-point-row').length;

        // Check if we've reached the maximum of 5 bullet points
        if (bulletCount >= 5) {
            showToast('warning', 'Maximum of 5 bullet points allowed per experience');
            return;
        }

        // Update the bullet count field
        const countField = document.getElementById(`bullet_count_${parentIndex}`);
        if (countField) {
            countField.value = bulletCount + 1;
        }

        // Create a new row element
        const newRow = document.createElement('div');
        newRow.className = 'bullet-point-row flex items-start gap-3 group hover:bg-gray-50/80 dark:hover:bg-gray-800/20 p-2 rounded-md transition-colors';

        // Set the HTML content
        newRow.innerHTML = `
            <div class="mt-3 text-primary">•</div>
            <div class="form-control flex-1">
                <div class="relative">
                    <textarea class="textarea textarea-bordered w-full min-h-24 focus:border-primary focus:ring-1 focus:ring-primary pr-8"
                        id="bullet_${parentIndex}_${bulletCount}"
                        name="bullet_${parentIndex}_${bulletCount}"
                        placeholder="Describe your achievement with action verbs and measurable results (e.g., 'Increased customer satisfaction by 20% through implementation of new service protocols')"
                        onkeyup="checkBulletQuality(this)"
                        data-parent="${parentIndex}"
                        data-index="${bulletCount}"></textarea>
                </div>
                <div class="flex justify-between mt-1">
                    <div class="bullet-quality text-xs"></div>
                    <div class="text-xs char-counter text-gray-500">
                        <span class="current">0</span>/<span class="max">100-150 optimal</span>
                    </div>
                </div>
            </div>
            <div class="flex flex-col gap-2">
                <button type="button" class="btn btn-circle btn-outline btn-error btn-sm mt-3 opacity-70 hover:opacity-100 hover:bg-error hover:text-white transition-all"
                        onclick="removeBulletPoint(this, '${parentIndex}')">
                    <i class="fa-solid fa-times"></i>
                </button>
                <button type="button" class="btn btn-circle btn-outline btn-info btn-sm opacity-70 hover:opacity-100 hover:bg-info hover:text-white transition-all"
                        onclick="openEnhanceModal('${parentIndex}', '${bulletCount}')">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                </button>
                <span id="enhance_indicator_${parentIndex}_${bulletCount}" class="htmx-indicator">
                    <span class="loading loading-spinner loading-xs"></span>
                </span>
            </div>
        `;

        // Add the new row to the container
        container.appendChild(newRow);

        // Apply a highlight effect to show it's new
        newRow.classList.add('bg-primary-50');
        setTimeout(() => {
            newRow.classList.remove('bg-primary-50');
        }, 1000);

        // Focus the new textarea after a slight delay
        setTimeout(() => {
            const textarea = document.getElementById(`bullet_${parentIndex}_${bulletCount}`);
            if (textarea) {
                textarea.focus();
                // Initialize character count and quality check
                updateCharCount(textarea);
                checkBulletQuality(textarea);
            }
        }, 100);

        // Update experience validation status
        updateExperienceStatus(parentIndex);
    }

    // Remove a bullet point
    function removeBulletPoint(button, parentIndex) {
        const container = document.getElementById(`bullet_points_container_${parentIndex}`);
        if (!container) {
            console.error(`Could not find bullet points container for experience ${parentIndex}`);
            return;
        }

        const row = button.closest('.bullet-point-row');
        if (!row) {
            console.error('Could not find the bullet point row to remove');
            return;
        }

        // Don't remove if it's the only bullet point
        if (container.querySelectorAll('.bullet-point-row').length <= 1) {
            // Just clear the textarea
            const textarea = row.querySelector('textarea');
            if (textarea) {
                textarea.value = '';
                updateCharCount(textarea);
                checkBulletQuality(textarea);
            }
            return;
        }

        // Animation for removal
        row.style.transition = 'all 0.2s ease';
        row.style.opacity = '0';
        row.style.transform = 'translateX(10px)';

        setTimeout(() => {
            row.remove();

            // Renumber remaining bullet points
            container.querySelectorAll('.bullet-point-row').forEach((bullet, idx) => {
                const textarea = bullet.querySelector('textarea');
                if (textarea) {
                    // Update ID and name
                    textarea.id = `bullet_${parentIndex}_${idx}`;
                    textarea.name = `bullet_${parentIndex}_${idx}`;
                    textarea.dataset.index = idx;
                }
            });

            // Update bullet count
            const countField = document.getElementById(`bullet_count_${parentIndex}`);
            if (countField) {
                const newCount = container.querySelectorAll('.bullet-point-row').length;
                countField.value = newCount;
                console.log(`Updated bullet count to ${newCount} after removal`);
            } else {
                console.error(`Could not find bullet count field for experience ${parentIndex}`);
            }

            // Check experience validation
            updateExperienceStatus(parentIndex);
        }, 200);
    }
    // Check bullet point quality
    function checkBulletQuality(textarea) {
        updateCharCount(textarea);

        const text = textarea.value.trim();
        const qualityDiv = textarea.closest('.form-control').querySelector('.bullet-quality');

        if (!text) {
            qualityDiv.textContent = '';
            return;
        }

        // Check for action verbs at the beginning
        const startsWithActionVerb = /^(Achieved|Analyzed|Built|Coordinated|Created|Delivered|Designed|Developed|Established|Generated|Implemented|Improved|Increased|Launched|Led|Managed|Optimized|Reduced|Resolved|Spearheaded|Streamlined|Supervised|Trained|Transformed|Updated)/i.test(text);

        // Check for quantifiable results
        const hasQuantifiableResults = /(\d+%|\d+\s*percent|\$\d+|\d+\s*dollars|\d+\s*million|\d+\s*thousand|\d+\s*people|\d+\s*team)/i.test(text);

        // Character count
        const charCount = text.length;
        const idealLength = charCount >= 100 && charCount <= 150;

        // Calculate score
        let score = 0;
        if (startsWithActionVerb) score += 3;
        if (hasQuantifiableResults) score += 3;
        if (idealLength) score += 2;
        else if (charCount > 60 && charCount < 200) score += 1;

        // Display feedback based on score
        if (score >= 7) {
            qualityDiv.textContent = 'Excellent bullet point! ★★★★★';
            qualityDiv.className = 'bullet-quality text-xs text-success';
        } else if (score >= 5) {
            qualityDiv.textContent = 'Good bullet point ★★★★';
            qualityDiv.className = 'bullet-quality text-xs text-success';
        } else if (score >= 3) {
            qualityDiv.textContent = 'Decent bullet point ★★★';
            qualityDiv.className = 'bullet-quality text-xs text-warning';
        } else {
            qualityDiv.textContent = 'Consider improving this bullet point ★★';
            qualityDiv.className = 'bullet-quality text-xs text-error';
        }
    }

    // Update character count for textareas
    function updateCharCount(textarea) {
        const counter = textarea.closest('.form-control').querySelector('.char-counter .current');
        if (counter) {
            counter.textContent = textarea.value.length;
        }
    }

    // Update the experience validation status
    function updateExperienceStatus(index) {
        const entry = document.querySelector(`.experience-entry[data-index="${index}"]`);
        if (!entry) return false;

        const statusIndicator = entry.querySelector('.experience-status');
        const requiredFields = entry.querySelectorAll('input[required], select[required], textarea[required]');

        let isValid = true;
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
            }
        });

        // Also check date validation
        if (!validateDates(index)) {
            isValid = false;
        }

        // Check if at least one bullet point exists and has content
        const bulletContainer = entry.querySelector(`#bullet_points_container_${index}`);
        if (bulletContainer) {
            const bullets = bulletContainer.querySelectorAll('textarea');
            let hasBullet = false;

            bullets.forEach(bullet => {
                if (bullet.value.trim()) {
                    hasBullet = true;
                }
            });

            if (!hasBullet) {
                isValid = false;
            }
        }

        // Update status indicator
        if (statusIndicator) {
            if (isValid) {
                statusIndicator.classList.remove('bg-error');
                statusIndicator.classList.add('bg-success');
            } else {
                statusIndicator.classList.remove('bg-success');
                statusIndicator.classList.add('bg-error');
            }
        }

        return isValid;
    }

    // Validate dates function
    function validateDates(index) {
        const startDate = document.getElementById(`start_date_${index}`);
        const endDate = document.getElementById(`end_date_${index}`);
        const isCurrent = document.getElementById(`is_current_${index}`);
        const validationMsg = document.getElementById(`date_validation_${index}`);

        // Clear previous validation
        if (validationMsg) validationMsg.textContent = '';
        if (startDate) startDate.classList.remove('input-error');
        if (endDate) endDate.classList.remove('input-error');

        // Skip validation if current job or end date is empty
        if (!startDate || !endDate || (isCurrent && isCurrent.checked) || !endDate.value) {
            return true;
        }

        // Check if both dates are provided
        if (startDate.value && endDate.value) {
            const start = new Date(startDate.value);
            const end = new Date(endDate.value);

            // Check if end date is after start date
            if (end < start) {
                if (validationMsg) validationMsg.textContent = 'End date must be after start date';
                endDate.classList.add('input-error');
                return false;
            }

            // Check if end date is in the future
            const today = new Date();
            if (end > today) {
                if (validationMsg) validationMsg.textContent = 'End date cannot be in the future';
                endDate.classList.add('input-error');
                return false;
            }
        }

        return true;
    }
    // Show toast notification
    function showToast(type, message) {
        // Remove any existing toasts
        const existingToast = document.querySelector('.toast-notification');
        if (existingToast) {
            existingToast.remove();
        }

        // Create new toast
        const toast = document.createElement('div');
        toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 toast-notification transition-all duration-300 transform translate-y-0 opacity-100`;

        // Set style based on type
        if (type === 'success') {
            toast.classList.add('bg-success', 'text-white');
            toast.innerHTML = `<div class="flex items-center gap-2"><i class="fa-solid fa-check"></i> ${message}</div>`;
        } else if (type === 'error') {
            toast.classList.add('bg-error', 'text-white');
            toast.innerHTML = `<div class="flex items-center gap-2"><i class="fa-solid fa-exclamation-circle"></i> ${message}</div>`;
        } else if (type === 'info') {
            toast.classList.add('bg-info', 'text-white');
            toast.innerHTML = `<div class="flex items-center gap-2"><i class="fa-solid fa-info-circle"></i> ${message}</div>`;
        } else if (type === 'warning') {
            toast.classList.add('bg-warning', 'text-white');
            toast.innerHTML = `<div class="flex items-center gap-2"><i class="fa-solid fa-exclamation-triangle"></i> ${message}</div>`;
        }

        document.body.appendChild(toast);

        // Fade out after delay
        setTimeout(() => {
            toast.classList.replace('translate-y-0', 'translate-y-2');
            toast.classList.replace('opacity-100', 'opacity-0');
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 300);
        }, 3000);
    }

    // Document ready function with expanded event listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Enable apply button when enhancement is available
        const enhancementForm = document.getElementById('bullet-enhancement-form');
        if (enhancementForm) {
            enhancementForm.addEventListener('htmx:afterSwap', function() {
                document.getElementById('apply_enhancement_btn').disabled = false;
            });
        }

        // Toggle ATS job container when enhancement type changes
        document.querySelectorAll('input[name="enhancement_type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const atsContainer = document.getElementById('ats_job_container');
                if (this.value === 'ats') {
                    atsContainer.classList.remove('hidden');
                } else {
                    atsContainer.classList.add('hidden');
                }
            });
        });

        // Initialize form submission handler
        const resumeForm = document.getElementById('resume-form');
        if (resumeForm) {
            resumeForm.addEventListener('submit', function(e) {
                // Ensure the experience count is correctly set
                const experiences = document.querySelectorAll('.experience-entry');
                const countField = document.getElementById('experience_count');
                if (countField) {
                    countField.value = experiences.length;
                }

                // Ensure all bullet counts are correctly set for each experience
                experiences.forEach((experience, i) => {
                    const bulletContainer = experience.querySelector('.bullet-points');
                    if (bulletContainer) {
                        const bullets = bulletContainer.querySelectorAll('.bullet-point-row');
                        const bulletCountField = experience.querySelector(`input[name="bullet_count_${i}"]`);
                        if (bulletCountField) {
                            bulletCountField.value = bullets.length;
                            console.log(`Experience ${i}: Set bullet count to ${bullets.length}`);
                        }
                    }
                });
            });
        }

        // Initialize all experience entries
        document.querySelectorAll('.experience-entry').forEach(entry => {
            const index = entry.dataset.index;
            updateExperienceStatus(index);

            // Initialize character counters for all bullet points
            entry.querySelectorAll('.form-control textarea').forEach(textarea => {
                updateCharCount(textarea);
                checkBulletQuality(textarea);
            });
        });

        // Listen for HTMX events after bullet generation
        document.body.addEventListener('htmx:afterSwap', function(event) {
            if (event.detail.target.id && event.detail.target.id.startsWith('bullet_points_container_')) {
                const parentIndex = event.detail.target.id.split('_').pop();

                // Initialize quality checks on all newly added bullet points
                event.detail.target.querySelectorAll('textarea').forEach(textarea => {
                    updateCharCount(textarea);
                    checkBulletQuality(textarea);
                });

                // Update the parent experience status
                updateExperienceStatus(parentIndex);

                // Show success message
                showToast('success', 'Bullet points generated successfully!');
            }
        });
    });
</script>

<!-- Script for modal handling -->
{#<script>#}
{#    // AI Bullet Point Generation Modal Functions#}
{#    function openBulletGenerationModal(parentIndex) {#}
{#        // Get the current values#}
{#        const jobTitle = document.getElementById(`job_title_${parentIndex}`).value;#}
{#        const employer = document.getElementById(`employer_${parentIndex}`).value;#}
{##}
{#        // Set values in the modal#}
{#        document.getElementById('job_title_modal').value = jobTitle;#}
{#        document.getElementById('employer_modal').value = employer;#}
{##}
{#        // Set the parent index#}
{#        const form = document.getElementById('bullet-generation-form');#}
{#        const hiddenInput = form.querySelector('input[name="parent_index"]');#}
{#        hiddenInput.value = parentIndex;#}
{##}
{#        // Show the modal#}
{#        document.getElementById('bullet-generation-modal').classList.add('modal-open');#}
{#    }#}
{##}
{#    // AI Bullet Enhancement Modal Functions#}
{#    function openEnhanceModal(parentIndex, bulletIndex) {#}
{#        // Get the current bullet text#}
{#        const bulletId = `bullet_${parentIndex}_${bulletIndex}`;#}
{#        const bulletText = document.getElementById(bulletId).value;#}
{##}
{#        // Set values in the modal#}
{#        document.getElementById('original_bullet_modal').value = bulletText;#}
{#        document.getElementById('parent_index_modal').value = parentIndex;#}
{#        document.getElementById('bullet_index_modal').value = bulletIndex;#}
{##}
{#        // Clear previous enhancement result#}
{#        document.getElementById('enhanced_bullet_result').innerHTML = '';#}
{#        document.getElementById('apply_enhancement_btn').disabled = true;#}
{##}
{#        // Show/hide ATS job container based on enhancement type#}
{#        document.querySelectorAll('input[name="enhancement_type"]').forEach(radio => {#}
{#            radio.addEventListener('change', function() {#}
{#                const atsContainer = document.getElementById('ats_job_container');#}
{#                if (this.value === 'ats') {#}
{#                    atsContainer.classList.remove('hidden');#}
{#                } else {#}
{#                    atsContainer.classList.add('hidden');#}
{#                }#}
{#            });#}
{#        });#}
{##}
{#        // Show the modal#}
{#        document.getElementById('bullet-enhancement-modal').classList.add('modal-open');#}
{#    }#}
{##}
{#    // Apply enhanced text to the original bullet point#}
{#    function applyEnhancement() {#}
{#        const parentIndex = document.getElementById('parent_index_modal').value;#}
{#        const bulletIndex = document.getElementById('bullet_index_modal').value;#}
{#        const enhancedText = document.getElementById('enhanced_bullet_result').textContent;#}
{##}
{#        if (enhancedText) {#}
{#            // Update the original bullet point text#}
{#            const bulletId = `bullet_${parentIndex}_${bulletIndex}`;#}
{#            document.getElementById(bulletId).value = enhancedText;#}
{##}
{#            // Trigger quality check#}
{#            checkBulletQuality(document.getElementById(bulletId));#}
{##}
{#            // Close the modal#}
{#            closeModal('bullet-enhancement-modal');#}
{##}
{#            // Show success message#}
{#            showToast('success', 'Enhancement applied successfully!');#}
{#        }#}
{#    }#}
{##}
{#    // Function to close modals#}
{#    function closeModal(modalId) {#}
{#        document.getElementById(modalId).classList.remove('modal-open');#}
{#    }#}
{##}
{#    // Listen for form submit on enhancement form to enable apply button#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#        // Enable apply button when enhancement is available#}
{#        document.getElementById('bullet-enhancement-form').addEventListener('htmx:afterSwap', function() {#}
{#            document.getElementById('apply_enhancement_btn').disabled = false;#}
{#        });#}
{##}
{#        // Toggle ATS job container when enhancement type changes#}
{#        document.querySelectorAll('input[name="enhancement_type"]').forEach(radio => {#}
{#            radio.addEventListener('change', function() {#}
{#                const atsContainer = document.getElementById('ats_job_container');#}
{#                if (this.value === 'ats') {#}
{#                    atsContainer.classList.remove('hidden');#}
{#                } else {#}
{#                    atsContainer.classList.add('hidden');#}
{#                }#}
{#            });#}
{#        });#}
{#    });#}
{#</script>#}
{% endblock %}
