{# templates/resumes/wizard_steps/certifications.html #}
{% extends "resumes/wizard_base.html" %}
{% load widget_tweaks static i18n %}

{% block extra_head %}
    {{ block.super }}
    {# Link to your specific JavaScript for handling formsets if not already in resume_wizard.js #}
    {# e.g., <script src="{% static 'js/certifications_formset.js' %}" defer></script> #}
{% endblock %}

{% block wizard_content %}
<form method="post" novalidate id="certifications-formset-container">
    {% csrf_token %}
    {{ form.management_form }} {# CertificationFormSet management form #}

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
        <div>
            <h2 class="text-xl font-semibold text-slate-800 dark:text-slate-100 mb-1">{{ current_step_display }}</h2>
            <p class="text-sm text-slate-600 dark:text-slate-400">
                List any professional certifications, licenses, or relevant courses you've completed.
            </p>
        </div>
        <button type="button" id="add-certification-form" class="btn-secondary-outline text-sm w-full sm:w-auto flex-shrink-0">
            <i class="fas fa-plus mr-1.5"></i> Add Certification
        </button>
    </div>

    {% if form.non_form_errors %}
        <div class="mb-4 p-3 bg-red-100 dark:bg-red-800/30 border border-red-300 dark:border-red-600 text-red-700 dark:text-red-300 rounded-md text-sm">
            {% for error in form.non_form_errors %}
                <p>{{ error }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <div id="certification-forms" class="space-y-8">
        {% for cert_form in form %} {# Iterating through each Certification form in the FormSet #}
            <div class="certification-form bg-slate-50 dark:bg-slate-800/60 p-5 rounded-lg shadow-md border border-slate-200 dark:border-slate-700 relative" data-certification-form-index="{{ forloop.counter0 }}">
                {% if cert_form.instance.pk %}{{ cert_form.id }}{% endif %}

                <div class="flex justify-between items-start mb-4 pb-3 border-b border-slate-200 dark:border-slate-700">
                    <h3 class="text-lg font-medium text-primary-700 dark:text-primary-400 flex items-center">
                        <i class="fas fa-certificate mr-2"></i>
                        Certification #<span class="certification-form-counter">{{ forloop.counter }}</span>
                    </h3>
                     <div class="flex items-center space-x-2">
                        {% if cert_form.DELETE %}
                            <div class="flex items-center">
                                {% render_field cert_form.DELETE class+="form-checkbox-sm text-red-600 focus:ring-red-500 delete-certification-checkbox" data_form_index=forloop.counter0 %}
                                <label for="{{ cert_form.DELETE.id_for_label }}" class="ml-1.5 text-xs text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 cursor-pointer">
                                    Delete
                                </label>
                            </div>
                        {% endif %}
                        <button type="button" class="remove-certification-form btn-icon-danger btn-xs" title="Remove this certification">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>

                {% for hidden_field in cert_form.hidden_fields %}
                     {% if hidden_field.name != 'id' %}{{ hidden_field }}{% endif %}
                {% endfor %}

                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-5 gap-y-4">
                    <div class="md:col-span-2">
                        <label for="{{ cert_form.name.id_for_label }}" class="form-label">Certification Name <span class="text-red-500">*</span></label>
                        {% render_field cert_form.name class+="form-input" placeholder="e.g., Certified Scrum Master, AWS Certified Solutions Architect" %}
                        {% for error in cert_form.name.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                    </div>

                    <div>
                        <label for="{{ cert_form.issuing_organization.id_for_label }}" class="form-label">Issuing Organization (Optional)</label>
                        {% render_field cert_form.issuing_organization class+="form-input" placeholder="e.g., Scrum Alliance, Amazon Web Services" %}
                        {% for error in cert_form.issuing_organization.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                    </div>
                     <div>
                        <label for="{{ cert_form.credential_id.id_for_label }}" class="form-label">Credential ID (Optional)</label>
                        {% render_field cert_form.credential_id class+="form-input" placeholder="e.g., 12345ABC" %}
                        {% for error in cert_form.credential_id.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                    </div>

                    <div class="grid grid-cols-2 gap-x-4">
                        <div>
                            <label for="{{ cert_form.issue_date.id_for_label }}" class="form-label">Issue Date (Optional)</label>
                            {% render_field cert_form.issue_date type="month" class+="form-input" %}
                            {% for error in cert_form.issue_date.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                        </div>
                        <div>
                            <label for="{{ cert_form.expiration_date.id_for_label }}" class="form-label">Expiration Date (Optional)</label>
                            {% render_field cert_form.expiration_date type="month" class+="form-input" %}
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Leave blank if it doesn't expire.</p>
                            {% for error in cert_form.expiration_date.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                        </div>
                    </div>
                     <div>
                        <label for="{{ cert_form.score.id_for_label }}" class="form-label">Score / Grade (Optional)</label>
                        {% render_field cert_form.score class+="form-input" placeholder="e.g., 95%, Pass" %}
                        {% for error in cert_form.score.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                    </div>
                    <div class="md:col-span-2">
                        <label for="{{ cert_form.link.id_for_label }}" class="form-label">Credential URL (Optional)</label>
                        {% render_field cert_form.link type="url" class+="form-input" placeholder="e.g., https://credential.net/verify/123" %}
                        {% for error in cert_form.link.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                    </div>
                    <div class="md:col-span-2">
                        <label for="{{ cert_form.description.id_for_label }}" class="form-label">Description (Optional)</label>
                        {% render_field cert_form.description class+="form-input" rows="3" placeholder="Briefly describe the certification or what you learned." %}
                        {% for error in cert_form.description.errors %} <p class="form-error-text">{{ error }}</p> {% endfor %}
                    </div>
                </div>

                {% if cert_form.non_field_errors %}
                    <div class="mt-3 p-2 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700/60 rounded-md text-sm text-red-600 dark:text-red-300">
                        {% for error in cert_form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div> {# End .certification-form #}
        {% endfor %}
    </div> {# End #certification-forms #}

    <div id="empty-certification-form" class="hidden">
        {% include "resumes/partials/form_rows/certification_form_row.html" with cert_form=form.empty_form formset_prefix=form.prefix is_empty_form=True certification_index="__prefix__" %}
    </div>

    {# Navigation Buttons #}
    <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 flex flex-col-reverse sm:flex-row justify-between items-center gap-3">
        <div>
            {% if prev_step_url %}
                <a href="{{ prev_step_url }}" class="btn-neutral w-full sm:w-auto">
                    <i class="fas fa-arrow-left mr-2"></i> Previous Step
                </a>
            {% else %}
                <span class="btn-disabled w-full sm:w-auto text-center">
                    <i class="fas fa-arrow-left mr-2"></i> Previous Step
                </span>
            {% endif %}
        </div>
        <div class="flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-3 w-full sm:w-auto">
            <button type="submit" name="action" value="save_and_exit" class="btn-secondary w-full sm:w-auto">
                <i class="fas fa-save mr-1.5"></i> Save & Exit Wizard
            </button>
            <button type="submit" name="action" value="save_and_continue" class="btn-primary w-full sm:w-auto">
                Save & Continue <i class="fas fa-arrow-right ml-1.5"></i>
            </button>
        </div>
    </div>
</form>
{% endblock wizard_content %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeSimpleFormset({
        formsetContainerId: 'certifications-formset-container',
        formsContainerId: 'certification-forms',
        addButtonId: 'add-certification-form',
        emptyFormTemplateId: 'empty-certification-form',
        formsetPrefix: '{{ form.prefix }}', // Django formset prefix
        itemContainerClass: 'certification-form', // Matches class in certification_form_row.html
        itemCounterClass: 'certification-form-counter',
        removeButtonClass: 'remove-certification-form',
        itemDataAttributePrefix: 'certification'
    });
});
</script>
{% endblock %}

{#{% extends 'resumes/wizard_base.html' %}#}
{#{% load static %}#}
{#{% load widget_tweaks %} {# Ensure widget_tweaks is loaded if used #}
{##}
{#{% block step_title %}Certifications & Credentials{% endblock %}#}
{##}
{#{% block step_icon %}<i class="fa-solid fa-certificate mr-3 text-primary-600 dark:text-primary-400 text-2xl"></i>{% endblock %} {# Adjusted icon color and size #}
{##}
{#{% block step_content %}#}
{#<form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}">#}
{#    {% csrf_token %}#}
{##}
    {# *** Management Form Tag Added *** #}
{#    {{ formset.management_form }}#}
    {# ******************************** #}
{##}
    {# *** Info Box Styling *** #}
{#    <div class="bg-primary-50 dark:bg-primary-950/20 border-2 border-primary-200 dark:border-primary-600 rounded-lg p-5 mb-8"> {# Replaced bg-primary/5, border border-primary/10, added border-2 and specific primary shades #}
{#        <div class="flex items-start">#}
{#            <div class="text-primary-600 dark:text-primary-400 text-xl mr-4 mt-1 flex-shrink-0"> {# Adjusted text-primary to specific primary color, added flex-shrink-0 #}
{#                <i class="fa-solid fa-lightbulb"></i>#}
{#            </div>#}
{#            <div>#}
{#                <p class="text-base text-gray-800 dark:text-gray-200"> {# Adjusted text color #}
{#                    Add professional certifications, licenses, or training programs you've completed.#}
{#                    These help demonstrate your specialized knowledge and commitment to professional development.#}
{#                </p>#}
{#                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">#}
{#                    <strong>Pro tip:</strong> Include expiration dates for time-limited certifications and credential links when available to allow verification.#}
{#                </p>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div id="certifications_container" class="space-y-6"> {# Adjusted space-y #}
{#        {% for form in formset.forms %}#}
{#        <div class="form-row bg-white dark:bg-gray-800 border-2 border-primary-200 dark:border-primary-700 rounded-lg shadow-md p-6 transition-all duration-300 hover:shadow-lg" id="{{ form.prefix }}-row"> {# Replaced bg-base-100, border border-gray-100, rounded-xl with Tailwind classes, added border-2 and primary shades #}
{#             {% if formset.can_delete %}#}
                 {# The delete input is hidden, JS handles marking for deletion #}
{#                 <div class="hidden">{{ form.DELETE }}</div>#}
{#             {% endif %}#}
{##}
{#             <div class="flex justify-between items-center mb-5 pb-4 border-b border-gray-200 dark:border-gray-700"> {# Adjusted padding-bottom and border color #}
{#                  <h3 class="text-lg font-semibold flex items-center text-gray-900 dark:text-white"> {# Adjusted font-medium to font-semibold, adjusted text color #}
{#                       <span class="w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center mr-3 flex-shrink-0"> {# Replaced bg-primary/10 with bg-primary-100 #}
{#                           <i class="fa-solid fa-award text-primary-600 dark:text-primary-400 text-sm"></i> {# Adjusted text-primary to specific primary color #}
{#                       </span>#}
{#                       Certification #{{ forloop.counter }}#}
{#                  </h3>#}
{#                   {% if formset.can_delete %}#}
                  {# *** Styled Remove Button with Tailwind Classes *** #}
{#                  <button type="button" class="inline-flex items-center text-sm text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400 font-medium"#}
{#                          onclick="deleteForm(this, '{{ formset.prefix }}')"> {# Ensure deleteForm JS works #}
{#                       <i class="fa-solid fa-trash-can mr-1"></i> Remove#}
{#                  </button>#}
{#                   {% endif %}#}
{#             </div>#}
{##}
{#             <div class="grid grid-cols-1 md:grid-cols-2 gap-5">#}
{#                 <div class="form-field"> {# Use a generic class for form field container #}
{#                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.name.id_for_label }}"> {# Styled label #}
{#                           Certification Name#}
{#                      </label>#}
{#                      <div class="relative">#}
{#                           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-award text-gray-400 dark:text-gray-500"></i></div> {# Adjusted icon color #}
                           {# *** Apply Tailwind Classes to Input using widget_tweaks *** #}
{#                           {% render_field form.name class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="e.g., AWS Certified Solutions Architect" %}#}
{#                      </div>#}
{#                      {% if form.name.errors %}<div class="text-red-600 dark:text-red-500 text-xs mt-1">{{ form.name.errors|first }}</div>{% endif %} {# Styled error text #}
{#                 </div>#}
{##}
{#                 <div class="form-field"> {# Use a generic class for form field container #}
{#                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.institute.id_for_label }}"> {# Styled label #}
{#                           Issuing Organization <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span> {# Styled optional text #}
{#                      </label>#}
{#                      <div class="relative">#}
{#                           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-building-columns text-gray-400 dark:text-gray-500"></i></div> {# Adjusted icon color #}
{#                           {% render_field form.institute class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="e.g., Amazon Web Services" %}#}
{#                      </div>#}
{#                      {% if form.institute.errors %><div class="text-red-600 dark:text-red-500 text-xs mt-1">{{ form.institute.errors|first }}</div>{% endif %} {# Styled error text #}
{#                 </div>#}
{#             </div>#}
{##}
             {# Dates, Score, Link, Description fields... #}
             {# Ensure these fields also don't have unnecessary 'required' attributes #}
{#             <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                 <div class="form-field"> {# Use a generic class for form field container #}
{#                     <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.completion_date.id_for_label }}"><span class="label-text font-medium">Date Earned</span> <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label> {# Styled label and optional text #}
{#                     <div class="relative">#}
{#                          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-calendar-alt text-gray-400 dark:text-gray-500"></i></div> {# Adjusted icon color #}
{#                          {% render_field form.completion_date type="date" class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" %}#}
{#                     </div>#}
{#                     {% if form.completion_date.errors %}<div class="text-red-600 dark:text-red-500 text-xs mt-1">{{ form.completion_date.errors|first }}</div>{% endif %} {# Styled error text #}
{#                 </div>#}
{#                 <div class="form-field"> {# Use a generic class for form field container #}
{#                     <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.expiration_date.id_for_label }}"><span class="label-text font-medium">Expiration Date</span> <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label> {# Styled label and optional text #}
{#                      <div class="relative">#}
{#                           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-hourglass-end text-gray-400 dark:text-gray-500"></i></div> {# Adjusted icon color #}
{#                           {% render_field form.expiration_date type="date" class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" %}#}
{#                      </div>#}
{#                     {% if form.expiration_date.errors %}<div class="text-red-600 dark:text-red-500 text-xs mt-1">{{ form.expiration_date.errors|first }}</div>{% endif %} {# Styled error text #}
{#                 </div>#}
{#             </div>#}
{#              <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                  <div class="form-field"> {# Use a generic class for form field container #}
{#                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.score.id_for_label }}"><span class="label-text font-medium">Score/Grade</span> <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label> {# Styled label and optional text #}
{#                       <div class="relative">#}
{#                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-star text-gray-400 dark:text-gray-500"></i></div> {# Adjusted icon color #}
{#                            {% render_field form.score class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="e.g., 95%" %}#}
{#                       </div>#}
{#                      {% if form.score.errors %}<div class="text-red-600 dark:text-red-500 text-xs mt-1">{{ form.score.errors|first }}</div>{% endif %} {# Styled error text #}
{#                  </div>#}
{#                   <div class="form-field"> {# Use a generic class for form field container #}
{#                       <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.link.id_for_label }}"><span class="label-text font-medium">Credential URL</span> <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label> {# Styled label and optional text #}
{#                        <div class="relative">#}
{#                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-link text-gray-400 dark:text-gray-500"></i></div> {# Adjusted icon color #}
{#                            {% render_field form.link type="url" class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="https://credential.example.com" %}#}
{#                        </div>#}
{#                       {% if form.link.errors %}<div class="text-red-600 dark:text-red-500 text-xs mt-1">{{ form.link.errors|first }}</div>{% endif %} {# Styled error text #}
{#                   </div>#}
{#              </div>#}
{#               <div class="form-field mt-5"> {# Use a generic class for form field container #}
{#                   <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.description.id_for_label }}"><span class="label-text font-medium">Description</span> <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label> {# Styled label and optional text #}
{#                    <div class="relative">#}
{#                         {% render_field form.description class="block w-full border-gray-300 rounded-md shadow-sm p-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm min-h-24 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="Brief description..." %} {# Styled textarea #}
{#                    </div>#}
{#                   {% if form.description.errors %}<div class="text-red-600 dark:text-red-500 text-xs mt-1">{{ form.description.errors|first }}</div>{% endif %} {# Styled error text #}
{#               </div>#}
{##}
{#        </div> {# End form-row #}
{#        {% empty %}#}
        {# *** Empty State Styling *** #}
{#         <div id="certs-empty-state" class="bg-white dark:bg-gray-800 border-2 border-primary-200 dark:border-primary-700 rounded-lg shadow p-8 text-center"> {# Replaced bg-base-100, border border-gray-100, rounded-xl with Tailwind classes, added border-2 and primary shades #}
{#              <div class="w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center mx-auto mb-4 flex-shrink-0"> {# Replaced bg-primary/10 with bg-primary-100 #}
{#                  <i class="fa-solid fa-award text-primary-600 dark:text-primary-400 text-2xl"></i> {# Adjusted text-primary to specific primary color #}
{#              </div>#}
{#              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Certifications Added Yet</h3> {# Adjusted font-medium to font-semibold, adjusted text color #}
{#              <p class="text-gray-600 dark:text-gray-400 max-w-md mx-auto mb-6"> {# Adjusted text color #}
{#                   This section is optional. Add relevant certifications to showcase your qualifications.#}
{#              </p>#}
              {# *** Styled Add Button with Tailwind Classes *** #}
{#              <button type="button" class="inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 text-base font-medium dark:bg-primary-700 dark:hover:bg-primary-800 dark:focus:ring-primary-600 add-another-btn" onclick="addForm(this, '{{ formset.prefix }}')"> {# Added add-another-btn class #}
{#                  <i class="fa-solid fa-plus mr-2"></i> Add Your First Certification#}
{#              </button>#}
{#         </div>#}
{#        {% endfor %}#}
{#    </div> {# End certifications_container #}
{##}
    {# Template for adding new forms #}
    {# *** Updated Template Styling to Match Live Forms *** #}
{#    <template id="{{ formset.prefix }}-form-template">#}
{#         <div class="form-row bg-white dark:bg-gray-800 border-2 border-primary-200 dark:border-primary-700 rounded-lg shadow-md p-6 transition-all duration-300 hover:shadow-lg" id="{{ formset.prefix }}-__prefix__-row">#}
{#              {% with form=formset.empty_form %} {# Use empty_form for template structure #}
{#              <div class="hidden"><input type="checkbox" name="{{ form.prefix }}-DELETE" id="id_{{ form.prefix }}-DELETE"></div>#}
{#              <div class="flex justify-between items-center mb-5 pb-4 border-b border-gray-200 dark:border-gray-700">#}
{#                  <h3 class="text-lg font-semibold flex items-center text-gray-900 dark:text-white">#}
{#                       <span class="w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center mr-3 flex-shrink-0">#}
{#                           <i class="fa-solid fa-award text-primary-600 dark:text-primary-400 text-sm"></i>#}
{#                       </span>#}
{#                      New Certification#}
{#                  </h3>#}
{#                  <button type="button" class="inline-flex items-center text-sm text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400 font-medium" onclick="deleteForm(this, '{{ formset.prefix }}')">Remove</button>#}
{#              </div>#}
{#               <div class="grid grid-cols-1 md:grid-cols-2 gap-5">#}
{#                   <div class="form-field">#}
{#                       <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.name.id_for_label }}">Certification Name</label>#}
{#                       <div class="relative">#}
{#                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-award text-gray-400 dark:text-gray-500"></i></div>#}
{#                            {% render_field form.name class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="e.g., AWS Certified Solutions Architect" %}#}
{#                       </div>#}
{#                   </div>#}
{#                   <div class="form-field">#}
{#                       <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.institute.id_for_label }}">Issuing Organization <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label>#}
{#                       <div class="relative">#}
{#                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-building-columns text-gray-400 dark:text-gray-500"></i></div>#}
{#                            {% render_field form.institute class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="e.g., Amazon Web Services" %}#}
{#                       </div>#}
{#                   </div>#}
{#               </div>#}
{#               <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                   <div class="form-field">#}
{#                       <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.completion_date.id_for_label }}">Date Earned <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label>#}
{#                        <div class="relative">#}
{#                             <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-calendar-alt text-gray-400 dark:text-gray-500"></i></div>#}
{#                             {% render_field form.completion_date type="date" class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" %}#}
{#                         </div>#}
{#                   </div>#}
{#                   <div class="form-field">#}
{#                       <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.expiration_date.id_for_label }}">Expiration Date <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label>#}
{#                       <div class="relative">#}
{#                           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-hourglass-end text-gray-400 dark:text-gray-500"></i></div>#}
{#                           {% render_field form.expiration_date type="date" class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" %}#}
{#                       </div>#}
{#                   </div>#}
{#                </div>#}
{#                 <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                     <div class="form-field">#}
{#                         <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.score.id_for_label }}">Score/Grade <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label>#}
{#                          <div class="relative">#}
{#                               <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-star text-gray-400 dark:text-gray-500"></i></div>#}
{#                               {% render_field form.score class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="e.g., 95%" %}#}
{#                           </div>#}
{#                       </div>#}
{#                    <div class="form-field">#}
{#                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.link.id_for_label }}">Credential URL <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label>#}
{#                        <div class="relative">#}
{#                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-link text-gray-400 dark:text-gray-500"></i></div>#}
{#                             {% render_field form.link type="url" class="block w-full border-gray-300 rounded-md shadow-sm pl-10 pr-3 py-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="https://credential.example.com" %}#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="form-field mt-5">#}
{#                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="{{ form.description.id_for_label }}">Description <span class="text-gray-500 dark:text-gray-400 font-normal">(Optional)</span></label>#}
{#                    <div class="relative">#}
{#                        {% render_field form.description class="block w-full border-gray-300 rounded-md shadow-sm p-2 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm min-h-24 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 dark:focus:ring-primary-600 dark:focus:border-primary-600" placeholder="Brief description..." %}#}
{#                    </div>#}
{#                </div>#}
{#              {% endwith %}#}
{#         </div>#}
{#    </template>#}
{##}
    {# Add Certification button (Always show, but JS might hide empty state) #}
    {# *** Styled Add Another Button with Tailwind Classes *** #}
{#    <div class="flex justify-center mt-8">#}
{#        <button type="button" class="inline-flex items-center justify-center px-6 py-3 border border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400 rounded-md shadow-sm bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 text-base font-medium add-another-btn" onclick="addForm(this, '{{ formset.prefix }}')">#}
{#             <i class="fa-solid fa-plus mr-2"></i> Add Another Certification#}
{#        </button>#}
{#    </div>#}
{##}
{#</form>#}
{##}
{# Ensure necessary JS functions (addForm, deleteForm) are available #}
{#<script>#}
{#    // Basic JS (ensure these are robust in your actual implementation)#}
{#    if (typeof addForm !== 'function') {#}
{#         function addForm(button, prefix) {#}
{#             console.warn("addForm function not fully defined. Using basic example.");#}
{#             const formContainer = document.getElementById(prefix + '_container'); // Use correct container ID#}
{#             const totalFormsInput = document.getElementById('id_' + prefix + '-TOTAL_FORMS');#}
{#             const template = document.getElementById(prefix + '-form-template');#}
{#             if (!formContainer || !totalFormsInput || !template) { console.error("Missing elements for addForm"); return; }#}
{#             const formNum = parseInt(totalFormsInput.value);#}
{#             let newFormHtml = template.innerHTML.replace(/__prefix__/g, formNum);#}
{#             const tempDiv = document.createElement('div');#}
{#             tempDiv.innerHTML = newFormHtml.trim(); // Use trim() to remove potential whitespace#}
{#             const newFormElement = tempDiv.firstElementChild;#}
{#             newFormElement.id = prefix + '-' + formNum + '-row'; // Assign correct ID to new form row#}
{##}
{#             const emptyState = document.getElementById(prefix + '-empty-state'); // Use correct empty state ID#}
{#             if(emptyState) emptyState.classList.add('hidden'); // Hide empty state#}
{#             formContainer.appendChild(newFormElement);#}
{#             totalFormsInput.value = formNum + 1;#}
{##}
{#             // Show 'Add Another' button if it was hidden by empty state logic (if any)#}
{#             const addAnotherButton = document.querySelector('.add-another-btn'); // Adjust selector if needed#}
{#              if(addAnotherButton) addAnotherButton.style.display = 'inline-flex'; // Use appropriate display style#}
{#         }#}
{#     }#}
{#     if (typeof deleteForm !== 'function') {#}
{#         function deleteForm(button, prefix) {#}
{#             console.warn("deleteForm function not fully defined. Using basic example.");#}
{#             const formRow = button.closest('.form-row');#}
{#             if (!formRow) { console.error("Could not find form-row"); return; }#}
{##}
{#             const deleteInput = formRow.querySelector('input[name$="-DELETE"]');#}
{#             if (deleteInput) {#}
{#                 deleteInput.checked = true;#}
{#                 formRow.style.display = 'none'; // Hide the form visually#}
{#             } else {#}
{#                  // If no DELETE input, assume it's an extra form from the template#}
{#                  formRow.remove();#}
{#             }#}
{##}
{#             // Check if remaining forms are all hidden (or none left) to show empty state#}
{#             const container = document.getElementById(prefix + '_container'); // Use correct container ID#}
{#             if (!container) { console.error("Could not find form container"); return; }#}
{##}
{#             const visibleForms = container.querySelectorAll('.form-row:not([style*="display: none"])');#}
{#             const emptyState = document.getElementById(prefix + '-empty-state'); // Use correct empty state ID#}
{##}
{#             // Also count forms that were originally there but are now marked for deletion#}
{#             const totalFormsInput = document.getElementById('id_' + prefix + '-TOTAL_FORMS');#}
{#             const initialForms = totalFormsInput ? parseInt(totalFormsInput.getAttribute('value')) : 0; // Get initial total#}
{##}
{#             // Count forms that are NOT the empty form template and are NOT marked for deletion#}
{#             const actualForms = container.querySelectorAll('.form-row').length;#}
{#             let undeletedForms = 0;#}
{#             container.querySelectorAll('.form-row').forEach(row => {#}
{#                 const deleteCheckbox = row.querySelector('input[name$="-DELETE"]');#}
{#                 if (!deleteCheckbox || !deleteCheckbox.checked) {#}
{#                     undeletedForms++;#}
{#                 }#}
{#             });#}
{##}
{##}
{#             if(undeletedForms === 0 && emptyState) {#}
{#                 emptyState.classList.remove('hidden');#}
{#                 const addAnotherButton = document.querySelector('.add-another-btn'); // Hide 'Add Another' if empty#}
{#                  if(addAnotherButton) addAnotherButton.style.display = 'none';#}
{#             } else {#}
{#                  if(emptyState) emptyState.classList.add('hidden'); // Ensure empty state is hidden if forms exist#}
{#                  const addAnotherButton = document.querySelector('.add-another-btn'); // Ensure 'Add Another' button is visible#}
{#                   if(addAnotherButton) addAnotherButton.style.display = 'inline-flex'; // Use appropriate display style#}
{#             }#}
{#         }#}
{#     }#}
{##}
{#     // Initial check for empty state on load#}
{#     document.addEventListener('DOMContentLoaded', function() {#}
{#         const prefix = '{{ formset.prefix }}'; // Get the formset prefix#}
{#         const container = document.getElementById(prefix + '_container');#}
{#         const emptyState = document.getElementById(prefix + '-empty-state');#}
{#         if (container && emptyState) {#}
{#             // Count forms that are NOT the empty form template and are NOT marked for deletion#}
{#             let undeletedForms = 0;#}
{#              container.querySelectorAll('.form-row').forEach(row => {#}
{#                  const deleteCheckbox = row.querySelector('input[name$="-DELETE"]');#}
{#                  if (!deleteCheckbox || !deleteCheckbox.checked) {#}
{#                      undeletedForms++;#}
{#                  }#}
{#              });#}
{##}
{#             if (undeletedForms > 0) {#}
{#                 emptyState.classList.add('hidden');#}
{#                 // Ensure 'Add Another' button is visible if forms exist on load#}
{#                 const addAnotherButton = document.querySelector('.add-another-btn');#}
{#                 if(addAnotherButton) addAnotherButton.style.display = 'inline-flex'; // Use appropriate display style#}
{#             } else {#}
{#                 emptyState.classList.remove('hidden');#}
{#                  // Hide 'Add Another' button if initially empty#}
{#                  const addAnotherButton = document.querySelector('.add-another-btn');#}
{#                  if(addAnotherButton) addAnotherButton.style.display = 'none';#}
{#             }#}
{#         }#}
{#     });#}
{#</script>#}
{#{% endblock %}#}
{##}
{#{% extends 'resumes/wizard_base.html' %}#}
{#{% load static %}#}
{#{% load widget_tweaks %} {# Ensure widget_tweaks is loaded if used #}
{##}
{#{% block step_title %}Certifications & Credentials{% endblock %}#}
{##}
{#{% block step_icon %}<i class="fa-solid fa-certificate mr-3 text-primary opacity-80"></i>{% endblock %}#}
{##}
{#{% block step_content %}#}
{#<form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}">#}
{#    {% csrf_token %}#}
{##}
    {# *** Management Form Tag Added *** #}
{#    {{ formset.management_form }}#}
    {# ******************************** #}
{##}
{#    <div class="bg-primary/5 border border-primary/10 rounded-lg p-5 mb-8">#}
        {# *** Original Info Box Content Restored *** #}
{#        <div class="flex items-start">#}
{#            <div class="text-primary text-xl mr-4 mt-1">#}
{#                <i class="fa-solid fa-lightbulb"></i>#}
{#            </div>#}
{#            <div>#}
{#                <p class="text-base">#}
{#                    Add professional certifications, licenses, or training programs you've completed.#}
{#                    These help demonstrate your specialized knowledge and commitment to professional development.#}
{#                </p>#}
{#                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">#}
{#                    <strong>Pro tip:</strong> Include expiration dates for time-limited certifications and credential links when available to allow verification.#}
{#                </p>#}
{#            </div>#}
{#        </div>#}
        {# *************************************** #}
{#    </div>#}
{##}
{#    <div id="certifications_container" class="space-y-8">#}
{#        {% for form in formset.forms %}#}
{#        <div class="form-row bg-base-100 border border-gray-100 dark:border-gray-700 rounded-xl shadow-md p-6 transition-all duration-300 hover:shadow-lg" id="{{ form.prefix }}-row">#}
{#             {% if formset.can_delete %}#}
{#                 <div class="hidden">{{ form.DELETE }}</div>#}
{#             {% endif %}#}
{##}
{#             <div class="flex justify-between items-center mb-5 pb-3 border-b border-gray-100 dark:border-gray-700">#}
{#                  <h3 class="text-lg font-medium flex items-center">#}
{#                       <span class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3">#}
{#                           <i class="fa-solid fa-award text-primary text-sm"></i>#}
{#                       </span>#}
{#                       Certification #{{ forloop.counter }}#}
{#                  </h3>#}
{#                   {% if formset.can_delete %}#}
{#                  <button type="button" class="btn btn-ghost btn-sm text-error formset-delete-btn"#}
{#                          onclick="deleteForm(this, '{{ formset.prefix }}')"> {# Ensure deleteForm JS works #}
{#                       <i class="fa-solid fa-trash-can mr-1"></i> Remove#}
{#                  </button>#}
{#                   {% endif %}#}
{#             </div>#}
{##}
{#             <div class="grid grid-cols-1 md:grid-cols-2 gap-5">#}
{#                 <div class="form-control">#}
{#                      <label class="label" for="{{ form.name.id_for_label }}">#}
{#                           <span class="label-text font-medium">Certification Name</span>#}
                           {# *** Asterisk Removed *** #}
                           {# <span class="label-text-alt text-error">*</span> #}
{#                      </label>#}
{#                      <div class="relative">#}
{#                           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-award text-gray-400"></i></div>#}
                           {# *** required Attribute Removed *** #}
{#                           {% render_field form.name class+="input input-bordered w-full pl-10" placeholder="e.g., AWS Certified Solutions Architect" %}#}
{#                      </div>#}
{#                      {% if form.name.errors %}<div class="text-error text-xs mt-1">{{ form.name.errors|first }}</div>{% endif %}#}
{#                 </div>#}
{##}
{#                 <div class="form-control">#}
{#                      <label class="label" for="{{ form.institute.id_for_label }}">#}
{#                           <span class="label-text font-medium">Issuing Organization</span>#}
{#                           <span class="label-text-alt text-gray-500">(Optional)</span>#}
{#                      </label>#}
{#                      <div class="relative">#}
{#                           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-building-columns text-gray-400"></i></div>#}
{#                           {% render_field form.institute class+="input input-bordered w-full pl-10" placeholder="e.g., Amazon Web Services" %}#}
{#                      </div>#}
{#                      {% if form.institute.errors %}<div class="text-error text-xs mt-1">{{ form.institute.errors|first }}</div>{% endif %}#}
{#                 </div>#}
{#             </div>#}
{##}
             {# Dates, Score, Link, Description fields... #}
             {# Ensure these fields also don't have unnecessary 'required' attributes #}
{#             <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                 <div class="form-control">#}
{#                     <label class="label" for="{{ form.completion_date.id_for_label }}"><span class="label-text font-medium">Date Earned</span> <span class="label-text-alt">(Optional)</span></label>#}
{#                     <div class="relative">#}
{#                          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-calendar-alt text-gray-400"></i></div>#}
{#                          {% render_field form.completion_date type="date" class+="input input-bordered w-full pl-10" %}#}
{#                     </div>#}
{#                     {% if form.completion_date.errors %}<div class="text-error text-xs mt-1">{{ form.completion_date.errors|first }}</div>{% endif %}#}
{#                 </div>#}
{#                 <div class="form-control">#}
{#                     <label class="label" for="{{ form.expiration_date.id_for_label }}"><span class="label-text font-medium">Expiration Date</span> <span class="label-text-alt">(Optional)</span></label>#}
{#                      <div class="relative">#}
{#                           <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-hourglass-end text-gray-400"></i></div>#}
{#                           {% render_field form.expiration_date type="date" class+="input input-bordered w-full pl-10" %}#}
{#                      </div>#}
{#                     {% if form.expiration_date.errors %}<div class="text-error text-xs mt-1">{{ form.expiration_date.errors|first }}</div>{% endif %}#}
{#                 </div>#}
{#             </div>#}
{#              <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                  <div class="form-control">#}
{#                      <label class="label" for="{{ form.score.id_for_label }}"><span class="label-text font-medium">Score/Grade</span> <span class="label-text-alt">(Optional)</span></label>#}
{#                       <div class="relative">#}
{#                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-star text-gray-400"></i></div>#}
{#                            {% render_field form.score class+="input input-bordered w-full pl-10" placeholder="e.g., 95%" %}#}
{#                       </div>#}
{#                      {% if form.score.errors %}<div class="text-error text-xs mt-1">{{ form.score.errors|first }}</div>{% endif %}#}
{#                  </div>#}
{#                   <div class="form-control">#}
{#                       <label class="label" for="{{ form.link.id_for_label }}"><span class="label-text font-medium">Credential URL</span> <span class="label-text-alt">(Optional)</span></label>#}
{#                        <div class="relative">#}
{#                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fa-solid fa-link text-gray-400"></i></div>#}
{#                            {% render_field form.link type="url" class+="input input-bordered w-full pl-10" placeholder="https://credential.example.com" %}#}
{#                        </div>#}
{#                       {% if form.link.errors %}<div class="text-error text-xs mt-1">{{ form.link.errors|first }}</div>{% endif %}#}
{#                   </div>#}
{#              </div>#}
{#               <div class="form-control mt-5">#}
{#                   <label class="label" for="{{ form.description.id_for_label }}"><span class="label-text font-medium">Description</span> <span class="label-text-alt">(Optional)</span></label>#}
{#                    <div class="relative">#}
{#                         {% render_field form.description class+="textarea textarea-bordered w-full min-h-24" placeholder="Brief description..." %}#}
{#                    </div>#}
{#                   {% if form.description.errors %}<div class="text-error text-xs mt-1">{{ form.description.errors|first }}</div>{% endif %}#}
{#               </div>#}
{##}
{#        </div> {# End form-row #}
{#        {% empty %}#}
{#         <div class="bg-base-100 border border-gray-100 dark:border-gray-700 rounded-xl shadow p-8 text-center" id="certs-empty-state">#}
{#              <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">#}
{#                  <i class="fa-solid fa-award text-primary text-2xl"></i>#}
{#              </div>#}
{#              <h3 class="text-lg font-medium mb-2">No Certifications Added Yet</h3>#}
{#              <p class="text-gray-500 max-w-md mx-auto mb-6">#}
{#                   This section is optional. Add relevant certifications to showcase your qualifications.#}
{#              </p>#}
{#              <button type="button" class="btn btn-primary add-another-btn" onclick="addForm(this, '{{ formset.prefix }}')">#}
{#                  <i class="fa-solid fa-plus mr-2"></i> Add a Certification#}
{#              </button>#}
{#         </div>#}
{#        {% endfor %}#}
{#    </div> {# End certifications_container #}
{##}
    {# Template for adding new forms #}
{#    <template id="{{ formset.prefix }}-form-template">#}
{#         <div class="form-row bg-base-100 border border-gray-100 dark:border-gray-700 rounded-xl shadow-md p-6" id="{{ formset.prefix }}-__prefix__-row">#}
{#              {% with form=formset.empty_form %} {# Use empty_form for template structure #}
{#              <div class="hidden"><input type="checkbox" name="{{ form.prefix }}-DELETE" id="id_{{ form.prefix }}-DELETE"></div>#}
{#              <div class="flex justify-between items-center mb-5 pb-3 border-b"><h3>New Certification</h3><button type="button" onclick="deleteForm(this, '{{ formset.prefix }}')">Remove</button></div>#}
{#               <div class="grid grid-cols-1 md:grid-cols-2 gap-5">#}
{#                   <div><label>Name</label>{% render_field form.name class+="input input-bordered w-full" %}</div>#}
{#                   <div><label>Institute</label>{% render_field form.institute class+="input input-bordered w-full" %}</div>#}
{#               </div>#}
{#               <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                   <div><label>Date Earned</label>{% render_field form.completion_date type="date" class+="input input-bordered w-full" %}</div>#}
{#                   <div><label>Expiration Date</label>{% render_field form.expiration_date type="date" class+="input input-bordered w-full" %}</div>#}
{#                </div>#}
{#                 <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                     <div><label>Score</label>{% render_field form.score class+="input input-bordered w-full" %}</div>#}
{#                     <div><label>Link</label>{% render_field form.link type="url" class+="input input-bordered w-full" %}</div>#}
{#                 </div>#}
{#                <div class="mt-5"><label>Description</label>{% render_field form.description class+="textarea textarea-bordered w-full" %}</div>#}
{#              {% endwith %}#}
{#         </div>#}
{#    </template>#}
{##}
    {# Add Certification button (Always show, but JS might hide empty state) #}
{#    <div class="flex justify-center mt-8">#}
{#        <button type="button" class="btn btn-primary add-another-btn" onclick="addForm(this, '{{ formset.prefix }}')">#}
{#             <i class="fa-solid fa-plus mr-2"></i> Add Another Certification#}
{#        </button>#}
{#    </div>#}
{##}
{#</form>#}
{##}
{# Ensure necessary JS functions (addForm, deleteForm) are available #}
{#<script>#}
{#    // Basic JS (ensure these are robust in your actual implementation)#}
{#    if (typeof addForm !== 'function') {#}
{#         function addForm(button, prefix) {#}
{#             console.warn("addForm function not fully defined. Using basic example.");#}
{#             const formContainer = document.getElementById('certifications_container'); // Target specific container#}
{#             const totalFormsInput = document.getElementById('id_' + prefix + '-TOTAL_FORMS');#}
{#             const template = document.getElementById(prefix + '-form-template');#}
{#             if (!formContainer || !totalFormsInput || !template) { console.error("Missing elements for addForm"); return; }#}
{#             const formNum = parseInt(totalFormsInput.value);#}
{#             let newFormHtml = template.innerHTML.replace(/__prefix__/g, formNum);#}
{#             const tempDiv = document.createElement('div');#}
{#             tempDiv.innerHTML = newFormHtml;#}
{#             const newFormElement = tempDiv.firstElementChild;#}
{#             const emptyState = document.getElementById('certs-empty-state');#}
{#             if(emptyState) emptyState.classList.add('hidden'); // Hide empty state#}
{#             formContainer.appendChild(newFormElement);#}
{#             totalFormsInput.value = formNum + 1;#}
{##}
{#             // Show 'Add Another' button if it was hidden by empty state logic (if any)#}
{#             const addAnotherButton = document.querySelector('.add-another-btn'); // Adjust selector if needed#}
{#              if(addAnotherButton) addAnotherButton.style.display = 'flex'; // Or 'block', 'inline-flex' etc.#}
{#         }#}
{#     }#}
{#     if (typeof deleteForm !== 'function') {#}
{#         function deleteForm(button, prefix) {#}
{#             console.warn("deleteForm function not fully defined. Using basic example.");#}
{#             const formRow = button.closest('.form-row');#}
{#             const deleteInput = formRow.querySelector('input[name$="-DELETE"]');#}
{#             if (deleteInput) {#}
{#                 deleteInput.checked = true;#}
{#                 formRow.style.display = 'none'; // Hide the form visually#}
{#             } else {#}
{#                  formRow.remove(); // Remove if no DELETE field (likely extra form)#}
{#             }#}
{#             // Check if remaining forms are all hidden (or none left) to show empty state#}
{#             const container = document.getElementById('certifications_container');#}
{#             const visibleForms = container.querySelectorAll('.form-row:not([style*="display: none"])');#}
{#             const emptyState = document.getElementById('certs-empty-state');#}
{#             if(visibleForms.length === 0 && emptyState) {#}
{#                 emptyState.classList.remove('hidden');#}
{#                 const addAnotherButton = document.querySelector('.add-another-btn'); // Hide 'Add Another' if empty#}
{#                  if(addAnotherButton) addAnotherButton.style.display = 'none';#}
{#             }#}
{#         }#}
{#     }#}
{##}
{#     // Initial check for empty state on load#}
{#     document.addEventListener('DOMContentLoaded', function() {#}
{#         const container = document.getElementById('certifications_container');#}
{#         const emptyState = document.getElementById('certs-empty-state');#}
{#         if (container && emptyState) {#}
{#             const visibleForms = container.querySelectorAll('.form-row:not([style*="display: none"])');#}
{#             if (visibleForms.length > 0) {#}
{#                 emptyState.classList.add('hidden');#}
{#             } else {#}
{#                 emptyState.classList.remove('hidden');#}
{#                 // Hide 'Add Another' button if initially empty#}
{#                  const addAnotherButton = document.querySelector('.add-another-btn');#}
{#                  if(addAnotherButton) addAnotherButton.style.display = 'none';#}
{#             }#}
{#         }#}
{#     });#}
{#</script>#}
{#{% endblock %}#}
{##}
{##}
{#{% extends 'resumes/wizard_base.html' %}#}
{#{% load static %}#}
{##}
{#{% block step_title %}Certifications & Credentials{% endblock %}#}
{##}
{#{% block step_icon %}<i class="fa-solid fa-certificate mr-3 text-primary opacity-80"></i>{% endblock %}#}
{##}
{#{% block step_content %}#}
{#<form id="resume-form" method="post" action="{% url 'job_portal:resume_wizard' step=step %}" hx-boost="true">#}
{#    {% csrf_token %}#}
{##}
{#    <div class="bg-primary/5 border border-primary/10 rounded-lg p-5 mb-8">#}
{#        <div class="flex items-start">#}
{#            <div class="text-primary text-xl mr-4 mt-1">#}
{#                <i class="fa-solid fa-lightbulb"></i>#}
{#            </div>#}
{#            <div>#}
{#                <p class="text-base">#}
{#                    Add professional certifications, licenses, or training programs you've completed.#}
{#                    These help demonstrate your specialized knowledge and commitment to professional development.#}
{#                </p>#}
{#                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">#}
{#                    <strong>Pro tip:</strong> Include expiration dates for time-limited certifications and credential links when available to allow verification.#}
{#                </p>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Hidden field to track number of certification entries -->#}
{#    <input type="hidden" id="certification_count" name="certification_count" value="{{ certifications|length }}">#}
{##}
{#    <!-- Certifications container -->#}
{#    <div id="certifications_container" class="space-y-8">#}
{#        {% for certification in certifications %}#}
{#        <div class="form-row bg-base-100 border border-gray-100 dark:border-gray-700 rounded-xl shadow-md p-6 transition-all duration-300 hover:shadow-lg">#}
{#            <div class="flex justify-between items-center mb-5 pb-3 border-b border-gray-100 dark:border-gray-700">#}
{#                <h3 class="text-lg font-medium flex items-center">#}
{#                    <span class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3">#}
{#                        <i class="fa-solid fa-award text-primary text-sm"></i>#}
{#                    </span>#}
{#                    Certification #{{ forloop.counter }}#}
{#                </h3>#}
{##}
{#                <!-- Remove Certification Button - Moved to header -->#}
{#                <button type="button" class="btn btn-ghost btn-sm text-error"#}
{#                        onclick="removeFormRow(this, 'certifications_container', 'certification_count')">#}
{#                    <i class="fa-solid fa-trash-can mr-1"></i> Remove#}
{#                </button>#}
{#            </div>#}
{##}
{#            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">#}
{#                <!-- Certification Name -->#}
{#                <div class="form-control">#}
{#                    <label class="label" for="name_{{ forloop.counter0 }}">#}
{#                        <span class="label-text font-medium">Certification Name</span>#}
{#                        <span class="label-text-alt text-error">*</span>#}
{#                    </label>#}
{#                    <input type="text" id="name_{{ forloop.counter0 }}" name="name_{{ forloop.counter0 }}"#}
{#                        class="input input-bordered w-full" value="{{ certification.name }}" required#}
{#                        placeholder="e.g., AWS Certified Solutions Architect">#}
{#                </div>#}
{##}
{#                <!-- Issuing Institute -->#}
{#                <div class="form-control">#}
{#                    <label class="label" for="institute_{{ forloop.counter0 }}">#}
{#                        <span class="label-text font-medium">Issuing Organization</span>#}
{#                        <span class="label-text-alt text-gray-500">(Optional)</span>#}
{#                    </label>#}
{#                    <input type="text" id="institute_{{ forloop.counter0 }}" name="institute_{{ forloop.counter0 }}"#}
{#                        class="input input-bordered w-full" value="{{ certification.institute }}"#}
{#                        placeholder="e.g., Amazon Web Services">#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                <!-- Completion Date -->#}
{#                <div class="form-control">#}
{#                    <label class="label" for="completion_date_{{ forloop.counter0 }}">#}
{#                        <span class="label-text font-medium">Date Earned</span>#}
{#                        <span class="label-text-alt text-gray-500">(Optional)</span>#}
{#                    </label>#}
{#                    <div class="relative">#}
{#                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">#}
{#                            <i class="fa-solid fa-calendar-alt text-gray-400"></i>#}
{#                        </div>#}
{#                        <input type="date" id="completion_date_{{ forloop.counter0 }}" name="completion_date_{{ forloop.counter0 }}"#}
{#                            class="input input-bordered w-full pl-10" value="{{ certification.completion_date|date:'Y-m-d' }}">#}
{#                    </div>#}
{#                </div>#}
{##}
{#                <!-- Expiration Date -->#}
{#                <div class="form-control">#}
{#                    <label class="label" for="expiration_date_{{ forloop.counter0 }}">#}
{#                        <span class="label-text font-medium">Expiration Date</span>#}
{#                        <span class="label-text-alt text-gray-500">(Optional)</span>#}
{#                    </label>#}
{#                    <div class="relative">#}
{#                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">#}
{#                            <i class="fa-solid fa-hourglass-end text-gray-400"></i>#}
{#                        </div>#}
{#                        <input type="date" id="expiration_date_{{ forloop.counter0 }}" name="expiration_date_{{ forloop.counter0 }}"#}
{#                            class="input input-bordered w-full pl-10" value="{{ certification.expiration_date|date:'Y-m-d' }}">#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-5">#}
{#                <!-- Score/Grade -->#}
{#                <div class="form-control">#}
{#                    <label class="label" for="score_{{ forloop.counter0 }}">#}
{#                        <span class="label-text font-medium">Score/Grade</span>#}
{#                        <span class="label-text-alt text-gray-500">(Optional)</span>#}
{#                    </label>#}
{#                    <div class="relative">#}
{#                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">#}
{#                            <i class="fa-solid fa-star text-gray-400"></i>#}
{#                        </div>#}
{#                        <input type="text" id="score_{{ forloop.counter0 }}" name="score_{{ forloop.counter0 }}"#}
{#                            class="input input-bordered w-full pl-10" value="{{ certification.score }}"#}
{#                            placeholder="e.g., 95%, A+, 750/900">#}
{#                    </div>#}
{#                </div>#}
{##}
{#                <!-- Credential Link -->#}
{#                <div class="form-control">#}
{#                    <label class="label" for="link_{{ forloop.counter0 }}">#}
{#                        <span class="label-text font-medium">Credential URL</span>#}
{#                        <span class="label-text-alt text-gray-500">(Optional)</span>#}
{#                    </label>#}
{#                    <div class="relative">#}
{#                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">#}
{#                            <i class="fa-solid fa-link text-gray-400"></i>#}
{#                        </div>#}
{#                        <input type="url" id="link_{{ forloop.counter0 }}" name="link_{{ forloop.counter0 }}"#}
{#                            class="input input-bordered w-full pl-10" value="{{ certification.link }}"#}
{#                            placeholder="https://credential.example.com/verify/12345">#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <!-- Description -->#}
{#            <div class="form-control mt-5">#}
{#                <label class="label" for="description_{{ forloop.counter0 }}">#}
{#                    <span class="label-text font-medium">Description</span>#}
{#                    <span class="label-text-alt text-gray-500">(Optional)</span>#}
{#                </label>#}
{#                <div class="relative">#}
{#                    <textarea id="description_{{ forloop.counter0 }}" name="description_{{ forloop.counter0 }}"#}
{#                        class="textarea textarea-bordered w-full min-h-24"#}
{#                        placeholder="Describe what the certification covered and how it relates to your skills or career goals.">{{ certification.description }}</textarea>#}
{#                </div>#}
{#                <span class="text-xs text-gray-500 mt-1">Briefly describe skills acquired or topics covered in this certification.</span>#}
{#            </div>#}
{#        </div>#}
{#        {% empty %}#}
{#        <!-- Empty state when no certifications are added yet -->#}
{#        <div class="bg-base-100 border border-gray-100 dark:border-gray-700 rounded-xl shadow p-8 text-center">#}
{#            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">#}
{#                <i class="fa-solid fa-award text-primary text-2xl"></i>#}
{#            </div>#}
{#            <h3 class="text-lg font-medium mb-2">No Certifications Added Yet</h3>#}
{#            <p class="text-gray-500 max-w-md mx-auto mb-6">#}
{#                Highlight your professional certifications and credentials to demonstrate your expertise and commitment to continuous learning.#}
{#            </p>#}
{#            <button type="button" class="btn btn-primary"#}
{#                    onclick="addFormRow('certification', 'certifications_container', 'certification_count')">#}
{#                <i class="fa-solid fa-plus mr-2"></i> Add Your First Certification#}
{#            </button>#}
{#        </div>#}
{#        {% endfor %}#}
{#    </div>#}
{##}
{#    <!-- Add Certification Button - Only shown if at least one certification exists -->#}
{#    {% if certifications %}#}
{#    <div class="flex justify-center mt-8">#}
{#        <button type="button" class="btn btn-outline btn-primary"#}
{#                onclick="addFormRow('certification', 'certifications_container', 'certification_count')">#}
{#            <i class="fa-solid fa-plus mr-2"></i> Add Another Certification#}
{#        </button>#}
{#    </div>#}
{#    {% endif %}#}
{#</form>#}
{#{% endblock %}#}